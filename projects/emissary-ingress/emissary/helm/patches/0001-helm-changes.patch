From 73eae4f91dc74b45bbbb6f5341b1e59c9cb546a1 Mon Sep 17 00:00:00 2001
From: jonahjon <jonahjones094@gmail.com>
Date: Fri, 12 Aug 2022 12:13:36 -0700
Subject: [PATCH] helm changes

Signed-off-by: jonahjon <jonahjones094@gmail.com>
---
 charts/emissary-ingress/.gitignore            |    4 -
 .../{Chart.yaml.in => Chart.yaml}             |   31 +-
 .../ci.in/tests/manifests/backend.yaml        |   14 +-
 .../emissary-ingress/crds/emissary-crds.yaml  | 3996 +++++++++++++++++
 charts/emissary-ingress/readme.tpl            |   10 +-
 charts/emissary-ingress/templates/NOTES.txt   |   14 +-
 .../emissary-ingress/templates/_helpers.tpl   |   18 +-
 .../templates/admin-service.yaml              |    4 +-
 .../templates/ambassador-agent.yaml           |  277 --
 charts/emissary-ingress/templates/config.yaml |    2 +-
 .../templates/deployment-apiext.yaml          |   66 +
 .../templates/deployment-canary.yaml          |    4 +-
 .../templates/deployment.yaml                 |   14 +-
 .../templates/exporter-config.yaml            |    2 +-
 charts/emissary-ingress/templates/hpa.yaml    |    2 +-
 .../emissary-ingress/templates/listener.yaml  |    8 +-
 charts/emissary-ingress/templates/module.yaml |    4 +-
 .../emissary-ingress/templates/namespace.yaml |    2 +-
 charts/emissary-ingress/templates/pdb.yaml    |    2 +-
 .../templates/podsecuritypolicy.yaml          |    2 +-
 charts/emissary-ingress/templates/rbac.yaml   |    8 +-
 .../emissary-ingress/templates/resolvers.yaml |    8 +-
 .../templates/service-canary.yaml             |    6 +-
 .../emissary-ingress/templates/service.yaml   |    6 +-
 .../templates/serviceaccount.yaml             |    2 +-
 .../templates/servicemonitor.yaml             |    4 +-
 .../{values.yaml.in => values.yaml}           |   32 +-
 27 files changed, 4148 insertions(+), 394 deletions(-)
 rename charts/emissary-ingress/{Chart.yaml.in => Chart.yaml} (52%)
 create mode 100644 charts/emissary-ingress/crds/emissary-crds.yaml
 delete mode 100644 charts/emissary-ingress/templates/ambassador-agent.yaml
 create mode 100644 charts/emissary-ingress/templates/deployment-apiext.yaml
 rename charts/emissary-ingress/{values.yaml.in => values.yaml} (93%)

diff --git a/charts/emissary-ingress/.gitignore b/charts/emissary-ingress/.gitignore
index d19c5dc9a..42b472400 100644
--- a/charts/emissary-ingress/.gitignore
+++ b/charts/emissary-ingress/.gitignore
@@ -1,7 +1,3 @@
-# Generated from .in files
-/Chart.yaml
-/values.yaml
-
 # Generated from values.yaml by kubepack.dev/chart-doc-gen
 /README.md
 
diff --git a/charts/emissary-ingress/Chart.yaml.in b/charts/emissary-ingress/Chart.yaml
similarity index 52%
rename from charts/emissary-ingress/Chart.yaml.in
rename to charts/emissary-ingress/Chart.yaml
index b974e5198..bab4360f7 100644
--- a/charts/emissary-ingress/Chart.yaml.in
+++ b/charts/emissary-ingress/Chart.yaml
@@ -1,13 +1,8 @@
 apiVersion: v1
-appVersion: @version@
+appVersion: v3.0.0-cbf68a7dd53dda13c681af3e19660a5605050839
 description: A Helm chart for Emissary Ingress
-name: emissary-ingress
-version: @chartVersion@
-icon: https://www.getambassador.io/images/logo.png
 home: https://www.getambassador.io/
-sources:
-- https://github.com/datawire/ambassador
-- https://github.com/prometheus/statsd_exporter
+icon: https://www.getambassador.io/images/logo.png
 keywords:
 - api gateway
 - ambassador
@@ -16,12 +11,16 @@ keywords:
 - emissary
 - emissary ingress
 maintainers:
-- name: flydiverny
-  email: markus@maga.se
-- name: kflynn
-  email: flynn@datawire.io
-- name: nbkrause
-  email: nkrause@datawire.io
-- name: lukeshu
-  email: lukeshu@datawire.io
-engine: gotpl
+- email: markus@maga.se
+  name: flydiverny
+- email: flynn@datawire.io
+  name: kflynn
+- email: nkrause@datawire.io
+  name: nbkrause
+- email: lukeshu@datawire.io
+  name: lukeshu
+name: emissary
+sources:
+- https://github.com/datawire/ambassador
+- https://github.com/prometheus/statsd_exporter
+version: 3.0.0-cbf68a7dd53dda13c681af3e19660a5605050839
diff --git a/charts/emissary-ingress/ci.in/tests/manifests/backend.yaml b/charts/emissary-ingress/ci.in/tests/manifests/backend.yaml
index b2d9205df..2a23de707 100644
--- a/charts/emissary-ingress/ci.in/tests/manifests/backend.yaml
+++ b/charts/emissary-ingress/ci.in/tests/manifests/backend.yaml
@@ -2,38 +2,38 @@
 apiVersion: getambassador.io/v1
 kind: Mapping
 metadata:
-  name: quote-backend
+  name:.Release.Namespace | default .Values.defaultNamespace | quote-backend
 spec:
   prefix: /backend/
-  service: quote
+  service:.Release.Namespace | default .Values.defaultNamespace | quote
 ---
 apiVersion: v1
 kind: Service
 metadata:
-  name: quote
+  name:.Release.Namespace | default .Values.defaultNamespace | quote
 spec:
   ports:
   - name: http
     port: 80
     targetPort: 8080
   selector:
-    app: quote
+    app:.Release.Namespace | default .Values.defaultNamespace | quote
 ---
 apiVersion: apps/v1
 kind: Deployment
 metadata:
-  name: quote
+  name:.Release.Namespace | default .Values.defaultNamespace | quote
 spec:
   replicas: 1
   selector:
     matchLabels:
-      app: quote
+      app:.Release.Namespace | default .Values.defaultNamespace | quote
   strategy:
     type: RollingUpdate
   template:
     metadata:
       labels:
-        app: quote
+        app:.Release.Namespace | default .Values.defaultNamespace | quote
     spec:
       containers:
       - name: backend
diff --git a/charts/emissary-ingress/crds/emissary-crds.yaml b/charts/emissary-ingress/crds/emissary-crds.yaml
new file mode 100644
index 000000000..8e5f321d8
--- /dev/null
+++ b/charts/emissary-ingress/crds/emissary-crds.yaml
@@ -0,0 +1,3996 @@
+# GENERATED FILE: edits made by hand will not be preserved.
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    controller-gen.kubebuilder.io/version: 3.0.0-cbf68a7dd53dda13c681af3e19660a5605050839
+  labels:
+    app.kubernetes.io/instance: emissary-apiext
+    app.kubernetes.io/managed-by: kubectl_apply_-f_emissary-apiext.yaml
+    app.kubernetes.io/name: emissary-apiext
+    app.kubernetes.io/part-of: emissary-apiext
+  name: authservices.getambassador.io
+spec:
+  conversion:
+    strategy: Webhook
+    webhook:
+      clientConfig:
+        service:
+          name: emissary-apiext
+          namespace: emissary-system
+      conversionReviewVersions:
+      - v1beta1
+  group: getambassador.io
+  names:
+    categories:
+    - ambassador-crds
+    kind: AuthService
+    listKind: AuthServiceList
+    plural: authservices
+    singular: authservice
+  preserveUnknownFields: false
+  scope: Namespaced
+  versions:
+  - name: v2
+    schema:
+      openAPIV3Schema:
+        description: AuthService is the Schema for the authservices API
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: AuthServiceSpec defines the desired state of AuthService
+            properties:
+              add_auth_headers:
+                additionalProperties:
+                  type: string
+                type: object
+              add_linkerd_headers:
+                type: boolean
+              allow_request_body:
+                type: boolean
+              allowed_authorization_headers:
+                items:
+                  type: string
+                type: array
+              allowed_request_headers:
+                items:
+                  type: string
+                type: array
+              auth_service:
+                type: string
+              failure_mode_allow:
+                type: boolean
+              include_body:
+                properties:
+                  allow_partial:
+                    type: boolean
+                  max_bytes:
+                    description: These aren't pointer types because they are required.
+                    type: integer
+                required:
+                - allow_partial
+                - max_bytes
+                type: object
+              path_prefix:
+                type: string
+              proto:
+                enum:
+                - http
+                - grpc
+                type: string
+              protocol_version:
+                enum:
+                - v2
+                - v3
+                type: string
+              status_on_error:
+                description: Why isn't this just an int??
+                properties:
+                  code:
+                    type: integer
+                type: object
+              timeout_ms:
+                type: integer
+              v3CircuitBreakers:
+                items:
+                  properties:
+                    max_connections:
+                      type: integer
+                    max_pending_requests:
+                      type: integer
+                    max_requests:
+                      type: integer
+                    max_retries:
+                      type: integer
+                    priority:
+                      enum:
+                      - default
+                      - high
+                      type: string
+                  type: object
+                type: array
+              v3StatsName:
+                type: string
+            required:
+            - auth_service
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+  - name: v3alpha1
+    schema:
+      openAPIV3Schema:
+        description: AuthService is the Schema for the authservices API
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: AuthServiceSpec defines the desired state of AuthService
+            properties:
+              add_auth_headers:
+                additionalProperties:
+                  type: string
+                type: object
+              add_linkerd_headers:
+                type: boolean
+              allow_request_body:
+                description: 'TODO(lukeshu): In v3alpha2, drop allow_request_body
+                  in favor of include_body. allow_request_body has been deprecated
+                  for a long time.'
+                type: boolean
+              allowed_authorization_headers:
+                items:
+                  type: string
+                type: array
+              allowed_request_headers:
+                items:
+                  type: string
+                type: array
+              ambassador_id:
+                description: "AmbassadorID declares which Ambassador instances should
+                  pay attention to this resource. If no value is provided, the default
+                  is: \n    ambassador_id:    - \"default\" \n TODO(lukeshu): In v3alpha2,
+                  consider renaming all of the `ambassador_id` (singular) fields to
+                  `ambassador_ids` (plural)."
+                items:
+                  type: string
+                type: array
+              auth_service:
+                description: 'TODO(lukeshu): In v3alpha2, consider renameing `auth_service`
+                  to just `service`, for consistency with the other resource types.'
+                type: string
+              circuit_breakers:
+                items:
+                  properties:
+                    max_connections:
+                      type: integer
+                    max_pending_requests:
+                      type: integer
+                    max_requests:
+                      type: integer
+                    max_retries:
+                      type: integer
+                    priority:
+                      enum:
+                      - default
+                      - high
+                      type: string
+                  type: object
+                type: array
+              failure_mode_allow:
+                type: boolean
+              include_body:
+                properties:
+                  allow_partial:
+                    type: boolean
+                  max_bytes:
+                    description: These aren't pointer types because they are required.
+                    type: integer
+                required:
+                - allow_partial
+                - max_bytes
+                type: object
+              path_prefix:
+                type: string
+              proto:
+                enum:
+                - http
+                - grpc
+                type: string
+              protocol_version:
+                description: ProtocolVersion is the envoy api transport protocol version
+                enum:
+                - v2
+                - v3
+                type: string
+              stats_name:
+                type: string
+              status_on_error:
+                description: 'TODO(lukeshu): In v3alpha2, consider getting rid of
+                  this struct type in favor of just using an int (i.e. `statusOnError:
+                  500` instead of the current `statusOnError: { code: 500 }`).'
+                properties:
+                  code:
+                    type: integer
+                type: object
+              timeout_ms:
+                description: 'TODO(lukeshu): In v3alpha2, change all of the `{foo}_ms`/`MillisecondDuration`
+                  fields to `{foo}`/`metav1.Duration`.'
+                type: integer
+              tls:
+                type: string
+              v2ExplicitTLS:
+                description: V2ExplicitTLS controls some vanity/stylistic elements
+                  when converting from v3alpha1 to v2.  The values in an V2ExplicitTLS
+                  should not in any way affect the runtime operation of Emissary;
+                  except that it may affect internal names in the Envoy config, which
+                  may in turn affect stats names.  But it should not affect any end-user
+                  observable behavior.
+                properties:
+                  serviceScheme:
+                    description: "ServiceScheme specifies how to spell and capitalize
+                      the scheme-part of the service URL. \n Acceptable values are
+                      \"http://\" (case-insensitive), \"https://\" (case-insensitive),
+                      or \"\".  The value is used if it agrees with whether or not
+                      this resource enables TLS origination, or if something else
+                      in the resource overrides the scheme."
+                    pattern: ^([hH][tT][tT][pP][sS]?://)?$
+                    type: string
+                  tls:
+                    description: "TLS controls whether and how to represent the \"tls\"
+                      field when its value could be implied by the \"service\" field.
+                      \ In v2, there were a lot of different ways to spell an \"empty\"
+                      value, and this field specifies which way to spell it (and will
+                      therefore only be used if the value will indeed be empty). \n
+                      \ | Value        | Representation                        | Meaning
+                      of representation          |  |--------------+---------------------------------------+------------------------------------|
+                      \ | \"\"           | omit the field                        |
+                      defer to service (no TLSContext)   |  | \"null\"       | store
+                      an explicit \"null\" in the field | defer to service (no TLSContext)
+                      \  |  | \"string\"     | store an empty string in the field
+                      \   | defer to service (no TLSContext)   |  | \"bool:false\"
+                      | store a Boolean \"false\" in the field  | defer to service
+                      (no TLSContext)   |  | \"bool:true\"  | store a Boolean \"true\"
+                      in the field   | originate TLS (no TLSContext)      | \n If
+                      the meaning of the representation contradicts anything else
+                      (if a TLSContext is to be used, or in the case of \"bool:true\"
+                      if TLS is not to be originated), then this field is ignored."
+                    enum:
+                    - ""
+                    - "null"
+                    - bool:true
+                    - bool:false
+                    - string
+                    type: string
+                type: object
+            required:
+            - auth_service
+            type: object
+        type: object
+    served: true
+    storage: false
+  - name: v1
+    schema:
+      openAPIV3Schema:
+        description: AuthService is the Schema for the authservices API
+        type: object
+        x-kubernetes-preserve-unknown-fields: true
+    served: false
+    storage: false
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    controller-gen.kubebuilder.io/version: 3.0.0-cbf68a7dd53dda13c681af3e19660a5605050839
+  labels:
+    app.kubernetes.io/instance: emissary-apiext
+    app.kubernetes.io/managed-by: kubectl_apply_-f_emissary-apiext.yaml
+    app.kubernetes.io/name: emissary-apiext
+    app.kubernetes.io/part-of: emissary-apiext
+  name: consulresolvers.getambassador.io
+spec:
+  conversion:
+    strategy: Webhook
+    webhook:
+      clientConfig:
+        service:
+          name: emissary-apiext
+          namespace: emissary-system
+      conversionReviewVersions:
+      - v1beta1
+  group: getambassador.io
+  names:
+    categories:
+    - ambassador-crds
+    kind: ConsulResolver
+    listKind: ConsulResolverList
+    plural: consulresolvers
+    singular: consulresolver
+  preserveUnknownFields: false
+  scope: Namespaced
+  versions:
+  - name: v2
+    schema:
+      openAPIV3Schema:
+        description: ConsulResolver is the Schema for the ConsulResolver API
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: ConsulResolver tells Ambassador to use Consul to resolve
+              services. In addition to the AmbassadorID, it needs information about
+              which Consul server and DC to use.
+            properties:
+              address:
+                type: string
+              datacenter:
+                type: string
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+  - name: v3alpha1
+    schema:
+      openAPIV3Schema:
+        description: ConsulResolver is the Schema for the ConsulResolver API
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: ConsulResolver tells Ambassador to use Consul to resolve
+              services. In addition to the AmbassadorID, it needs information about
+              which Consul server and DC to use.
+            properties:
+              address:
+                type: string
+              ambassador_id:
+                description: "AmbassadorID declares which Ambassador instances should
+                  pay attention to this resource. If no value is provided, the default
+                  is: \n    ambassador_id:    - \"default\" \n TODO(lukeshu): In v3alpha2,
+                  consider renaming all of the `ambassador_id` (singular) fields to
+                  `ambassador_ids` (plural)."
+                items:
+                  type: string
+                type: array
+              datacenter:
+                type: string
+            type: object
+        type: object
+    served: true
+    storage: false
+  - name: v1
+    schema:
+      openAPIV3Schema:
+        description: ConsulResolver is the Schema for the ConsulResolver API
+        type: object
+        x-kubernetes-preserve-unknown-fields: true
+    served: false
+    storage: false
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    controller-gen.kubebuilder.io/version: 3.0.0-cbf68a7dd53dda13c681af3e19660a5605050839
+  labels:
+    app.kubernetes.io/instance: emissary-apiext
+    app.kubernetes.io/managed-by: kubectl_apply_-f_emissary-apiext.yaml
+    app.kubernetes.io/name: emissary-apiext
+    app.kubernetes.io/part-of: emissary-apiext
+  name: devportals.getambassador.io
+spec:
+  conversion:
+    strategy: Webhook
+    webhook:
+      clientConfig:
+        service:
+          name: emissary-apiext
+          namespace: emissary-system
+      conversionReviewVersions:
+      - v1beta1
+  group: getambassador.io
+  names:
+    categories:
+    - ambassador-crds
+    kind: DevPortal
+    listKind: DevPortalList
+    plural: devportals
+    singular: devportal
+  preserveUnknownFields: false
+  scope: Namespaced
+  versions:
+  - name: v2
+    schema:
+      openAPIV3Schema:
+        description: "DevPortal is the Schema for the DevPortals API \n DevPortal
+          resources specify the `what` and `how` is shown in a DevPortal: \n * `what`
+          is in a DevPortal can be controlled with   - a `selector`, that can be used
+          for filtering `Mappings`.   - a `docs` listing of (services, url) * `how`
+          is a pointer to some `contents` (a checkout of a Git repository   with go-templates/markdown/css).
+          \n Multiple `DevPortal`s can exist in the cluster, and the Dev Portal server
+          will show them at different endpoints. A `DevPortal` resource with a special
+          name, `ambassador`, will be used for configuring the default Dev Portal
+          (served at `/docs/` by default)."
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: DevPortalSpec defines the desired state of DevPortal
+            properties:
+              content:
+                description: Content specifies where the content shown in the DevPortal
+                  come from
+                properties:
+                  branch:
+                    type: string
+                  dir:
+                    type: string
+                  url:
+                    type: string
+                type: object
+              default:
+                description: Default must be true when this is the default DevPortal
+                type: boolean
+              docs:
+                description: Docs is a static docs definition
+                items:
+                  description: 'DevPortalDocsSpec is a static documentation definition:
+                    instead of using a Selector for finding documentation for services,
+                    users can provide a static list of <service>:<URL> tuples. These
+                    services will be shown in the Dev Portal with the documentation
+                    obtained from this URL.'
+                  properties:
+                    service:
+                      description: Service is the service being documented
+                      type: string
+                    timeout_ms:
+                      description: Timeout specifies the amount of time devportal
+                        will wait for the downstream service to report an openapi
+                        spec back
+                      type: integer
+                    url:
+                      description: URL is the URL used for obtaining docs
+                      type: string
+                  type: object
+                type: array
+              naming_scheme:
+                description: Describes how to display "services" in the DevPortal.
+                  Default namespace.name
+                enum:
+                - namespace.name
+                - name.prefix
+                type: string
+              preserve_servers:
+                description: Configures this DevPortal to use server definitions from
+                  the openAPI doc instead of rewriting them based on the url used
+                  for the connection.
+                type: boolean
+              search:
+                description: DevPortalSearchSpec allows configuration over search
+                  functionality for the DevPortal
+                properties:
+                  enabled:
+                    type: boolean
+                  type:
+                    description: 'Type of search. "title-only" does a fuzzy search
+                      over openapi and page titles "all-content" will fuzzy search
+                      over all openapi and page content. "title-only" is the default.
+                      warning:  using all-content may incur a larger memory footprint'
+                    enum:
+                    - title-only
+                    - all-content
+                    type: string
+                type: object
+              selector:
+                description: Selector is used for choosing what is shown in the DevPortal
+                properties:
+                  matchLabels:
+                    additionalProperties:
+                      type: string
+                    description: MatchLabels specifies the list of labels that must
+                      be present in Mappings for being present in this DevPortal.
+                    type: object
+                  matchNamespaces:
+                    description: MatchNamespaces is a list of namespaces that will
+                      be included in this DevPortal.
+                    items:
+                      type: string
+                    type: array
+                type: object
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+  - name: v3alpha1
+    schema:
+      openAPIV3Schema:
+        description: "DevPortal is the Schema for the DevPortals API \n DevPortal
+          resources specify the `what` and `how` is shown in a DevPortal: \n * `what`
+          is in a DevPortal can be controlled with   - a `selector`, that can be used
+          for filtering `Mappings`.   - a `docs` listing of (services, url) * `how`
+          is a pointer to some `contents` (a checkout of a Git repository   with go-templates/markdown/css).
+          \n Multiple `DevPortal`s can exist in the cluster, and the Dev Portal server
+          will show them at different endpoints. A `DevPortal` resource with a special
+          name, `ambassador`, will be used for configuring the default Dev Portal
+          (served at `/docs/` by default)."
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: DevPortalSpec defines the desired state of DevPortal
+            properties:
+              ambassador_id:
+                description: "AmbassadorID declares which Ambassador instances should
+                  pay attention to this resource. If no value is provided, the default
+                  is: \n    ambassador_id:    - \"default\" \n TODO(lukeshu): In v3alpha2,
+                  consider renaming all of the `ambassador_id` (singular) fields to
+                  `ambassador_ids` (plural)."
+                items:
+                  type: string
+                type: array
+              content:
+                description: Content specifies where the content shown in the DevPortal
+                  come from
+                properties:
+                  branch:
+                    type: string
+                  dir:
+                    type: string
+                  url:
+                    type: string
+                type: object
+              default:
+                description: Default must be true when this is the default DevPortal
+                type: boolean
+              docs:
+                description: Docs is a static docs definition
+                items:
+                  description: 'DevPortalDocsSpec is a static documentation definition:
+                    instead of using a Selector for finding documentation for services,
+                    users can provide a static list of <service>:<URL> tuples. These
+                    services will be shown in the Dev Portal with the documentation
+                    obtained from this URL.'
+                  properties:
+                    service:
+                      description: Service is the service being documented
+                      type: string
+                    timeout_ms:
+                      description: Timeout specifies the amount of time devportal
+                        will wait for the downstream service to report an openapi
+                        spec back
+                      type: integer
+                    url:
+                      description: URL is the URL used for obtaining docs
+                      type: string
+                  type: object
+                type: array
+              naming_scheme:
+                description: Describes how to display "services" in the DevPortal.
+                  Default namespace.name
+                enum:
+                - namespace.name
+                - name.prefix
+                type: string
+              preserve_servers:
+                description: Configures this DevPortal to use server definitions from
+                  the openAPI doc instead of rewriting them based on the url used
+                  for the connection.
+                type: boolean
+              search:
+                description: DevPortalSearchSpec allows configuration over search
+                  functionality for the DevPortal
+                properties:
+                  enabled:
+                    type: boolean
+                  type:
+                    description: 'Type of search. "title-only" does a fuzzy search
+                      over openapi and page titles "all-content" will fuzzy search
+                      over all openapi and page content. "title-only" is the default.
+                      warning:  using all-content may incur a larger memory footprint'
+                    enum:
+                    - title-only
+                    - all-content
+                    type: string
+                type: object
+              selector:
+                description: Selector is used for choosing what is shown in the DevPortal
+                properties:
+                  matchLabels:
+                    additionalProperties:
+                      type: string
+                    description: MatchLabels specifies the list of labels that must
+                      be present in Mappings for being present in this DevPortal.
+                    type: object
+                  matchNamespaces:
+                    description: MatchNamespaces is a list of namespaces that will
+                      be included in this DevPortal.
+                    items:
+                      type: string
+                    type: array
+                type: object
+            type: object
+        type: object
+    served: true
+    storage: false
+  - name: v1
+    schema:
+      openAPIV3Schema:
+        description: DevPortal is the Schema for the DevPortals API
+        type: object
+        x-kubernetes-preserve-unknown-fields: true
+    served: false
+    storage: false
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    controller-gen.kubebuilder.io/version: 3.0.0-cbf68a7dd53dda13c681af3e19660a5605050839
+  labels:
+    app.kubernetes.io/instance: emissary-apiext
+    app.kubernetes.io/managed-by: kubectl_apply_-f_emissary-apiext.yaml
+    app.kubernetes.io/name: emissary-apiext
+    app.kubernetes.io/part-of: emissary-apiext
+  name: hosts.getambassador.io
+spec:
+  conversion:
+    strategy: Webhook
+    webhook:
+      clientConfig:
+        service:
+          name: emissary-apiext
+          namespace: emissary-system
+      conversionReviewVersions:
+      - v1beta1
+  group: getambassador.io
+  names:
+    categories:
+    - ambassador-crds
+    kind: Host
+    listKind: HostList
+    plural: hosts
+    singular: host
+  preserveUnknownFields: false
+  scope: Namespaced
+  versions:
+  - additionalPrinterColumns:
+    - jsonPath: .spec.hostname
+      name: Hostname
+      type: string
+    - jsonPath: .status.state
+      name: State
+      type: string
+    - jsonPath: .status.phaseCompleted
+      name: Phase Completed
+      type: string
+    - jsonPath: .status.phasePending
+      name: Phase Pending
+      type: string
+    - jsonPath: .metadata.creationTimestamp
+      name: Age
+      type: date
+    name: v2
+    schema:
+      openAPIV3Schema:
+        description: Host is the Schema for the hosts API
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: HostSpec defines the desired state of Host
+            properties:
+              acmeProvider:
+                description: Specifies whether/who to talk ACME with to automatically
+                  manage the $tlsSecret.
+                properties:
+                  authority:
+                    description: Specifies who to talk ACME with to get certs. Defaults
+                      to Let's Encrypt; if "none" (case-insensitive), do not try to
+                      do ACME for this Host.
+                    type: string
+                  email:
+                    type: string
+                  privateKeySecret:
+                    description: "Specifies the Kubernetes Secret to use to store
+                      the private key of the ACME account (essentially, where to store
+                      the auto-generated password for the auto-created ACME account).
+                      \ You should not normally need to set this--the default value
+                      is based on a combination of the ACME authority being registered
+                      wit and the email address associated with the account. \n Note
+                      that this is a native-Kubernetes-style core.v1.LocalObjectReference,
+                      not an Ambassador-style `{name}.{namespace}` string.  Because
+                      we're opinionated, it does not support referencing a Secret
+                      in another namespace (because most native Kubernetes resources
+                      don't support that), but if we ever abandon that opinion and
+                      decide to support non-local references it, it would be by adding
+                      a `namespace:` field by changing it from a core.v1.LocalObjectReference
+                      to a core.v1.SecretReference, not by adopting the `{name}.{namespace}`
+                      notation."
+                    properties:
+                      name:
+                        description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
+                          TODO: Add other useful fields. apiVersion, kind, uid?'
+                        type: string
+                    type: object
+                  registration:
+                    description: This is normally set automatically
+                    type: string
+                type: object
+              hostname:
+                description: Hostname by which the Ambassador can be reached.
+                type: string
+              previewUrl:
+                description: Configuration for the Preview URL feature of Service
+                  Preview. Defaults to preview URLs not enabled.
+                properties:
+                  enabled:
+                    description: Is the Preview URL feature enabled?
+                    type: boolean
+                  type:
+                    description: What type of Preview URL is allowed?
+                    enum:
+                    - Path
+                    type: string
+                type: object
+              requestPolicy:
+                description: Request policy definition.
+                properties:
+                  insecure:
+                    properties:
+                      action:
+                        enum:
+                        - Redirect
+                        - Reject
+                        - Route
+                        type: string
+                      additionalPort:
+                        type: integer
+                    type: object
+                type: object
+              selector:
+                description: Selector by which we can find further configuration.
+                  Defaults to hostname=$hostname
+                properties:
+                  matchExpressions:
+                    description: matchExpressions is a list of label selector requirements.
+                      The requirements are ANDed.
+                    items:
+                      description: A label selector requirement is a selector that
+                        contains values, a key, and an operator that relates the key
+                        and values.
+                      properties:
+                        key:
+                          description: key is the label key that the selector applies
+                            to.
+                          type: string
+                        operator:
+                          description: operator represents a key's relationship to
+                            a set of values. Valid operators are In, NotIn, Exists
+                            and DoesNotExist.
+                          type: string
+                        values:
+                          description: values is an array of string values. If the
+                            operator is In or NotIn, the values array must be non-empty.
+                            If the operator is Exists or DoesNotExist, the values
+                            array must be empty. This array is replaced during a strategic
+                            merge patch.
+                          items:
+                            type: string
+                          type: array
+                      required:
+                      - key
+                      - operator
+                      type: object
+                    type: array
+                  matchLabels:
+                    additionalProperties:
+                      type: string
+                    description: matchLabels is a map of {key,value} pairs. A single
+                      {key,value} in the matchLabels map is equivalent to an element
+                      of matchExpressions, whose key field is "key", the operator
+                      is "In", and the values array contains only "value". The requirements
+                      are ANDed.
+                    type: object
+                type: object
+              tls:
+                description: TLS configuration.  It is not valid to specify both `tlsContext`
+                  and `tls`.
+                properties:
+                  alpn_protocols:
+                    type: string
+                  ca_secret:
+                    type: string
+                  cacert_chain_file:
+                    type: string
+                  cert_chain_file:
+                    type: string
+                  cert_required:
+                    type: boolean
+                  cipher_suites:
+                    items:
+                      type: string
+                    type: array
+                  ecdh_curves:
+                    items:
+                      type: string
+                    type: array
+                  max_tls_version:
+                    type: string
+                  min_tls_version:
+                    type: string
+                  private_key_file:
+                    type: string
+                  redirect_cleartext_from:
+                    type: integer
+                  sni:
+                    type: string
+                  v3CRLSecret:
+                    type: string
+                type: object
+              tlsContext:
+                description: "Name of the TLSContext the Host resource is linked with.
+                  It is not valid to specify both `tlsContext` and `tls`. \n Note
+                  that this is a native-Kubernetes-style core.v1.LocalObjectReference,
+                  not an Ambassador-style `{name}.{namespace}` string.  Because we're
+                  opinionated, it does not support referencing a Secret in another
+                  namespace (because most native Kubernetes resources don't support
+                  that), but if we ever abandon that opinion and decide to support
+                  non-local references it, it would be by adding a `namespace:` field
+                  by changing it from a core.v1.LocalObjectReference to a core.v1.SecretReference,
+                  not by adopting the `{name}.{namespace}` notation."
+                properties:
+                  name:
+                    description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
+                      TODO: Add other useful fields. apiVersion, kind, uid?'
+                    type: string
+                type: object
+              tlsSecret:
+                description: "Name of the Kubernetes secret into which to save generated
+                  certificates.  If ACME is enabled (see $acmeProvider), then the
+                  default is $hostname; otherwise the default is \"\".  If the value
+                  is \"\", then we do not do TLS for this Host. \n Note that this
+                  is a native-Kubernetes-style core.v1.LocalObjectReference, not an
+                  Ambassador-style `{name}.{namespace}` string.  Because we're opinionated,
+                  it does not support referencing a Secret in another namespace (because
+                  most native Kubernetes resources don't support that), but if we
+                  ever abandon that opinion and decide to support non-local references
+                  it, it would be by adding a `namespace:` field by changing it from
+                  a core.v1.LocalObjectReference to a core.v1.SecretReference, not
+                  by adopting the `{name}.{namespace}` notation."
+                properties:
+                  name:
+                    description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
+                      TODO: Add other useful fields. apiVersion, kind, uid?'
+                    type: string
+                type: object
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+          status:
+            description: HostStatus defines the observed state of Host
+            properties:
+              errorBackoff:
+                type: string
+              errorReason:
+                description: errorReason, errorTimestamp, and errorBackoff are valid
+                  when state==Error.
+                type: string
+              errorTimestamp:
+                format: date-time
+                type: string
+              phaseCompleted:
+                description: phaseCompleted and phasePending are valid when state==Pending
+                  or state==Error.
+                enum:
+                - NA
+                - DefaultsFilled
+                - ACMEUserPrivateKeyCreated
+                - ACMEUserRegistered
+                - ACMECertificateChallenge
+                type: string
+              phasePending:
+                description: phaseCompleted and phasePending are valid when state==Pending
+                  or state==Error.
+                enum:
+                - NA
+                - DefaultsFilled
+                - ACMEUserPrivateKeyCreated
+                - ACMEUserRegistered
+                - ACMECertificateChallenge
+                type: string
+              state:
+                description: The first value listed in the Enum marker becomes the
+                  "zero" value, and it would be great if "Pending" could be the default
+                  value; but it's Important that the "zero" value be able to be shown
+                  as empty/omitted from display, and we really do want `kubectl get
+                  hosts` to say "Pending" in the "STATE" column, and not leave the
+                  column empty.
+                enum:
+                - Initial
+                - Pending
+                - Ready
+                - Error
+                type: string
+              tlsCertificateSource:
+                enum:
+                - Unknown
+                - None
+                - Other
+                - ACME
+                type: string
+            type: object
+        type: object
+    served: true
+    storage: true
+    subresources:
+      status: {}
+  - additionalPrinterColumns:
+    - jsonPath: .spec.hostname
+      name: Hostname
+      type: string
+    - jsonPath: .status.state
+      name: State
+      type: string
+    - jsonPath: .status.phaseCompleted
+      name: Phase Completed
+      type: string
+    - jsonPath: .status.phasePending
+      name: Phase Pending
+      type: string
+    - jsonPath: .metadata.creationTimestamp
+      name: Age
+      type: date
+    name: v3alpha1
+    schema:
+      openAPIV3Schema:
+        description: Host is the Schema for the hosts API
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: HostSpec defines the desired state of Host
+            properties:
+              acmeProvider:
+                description: Specifies whether/who to talk ACME with to automatically
+                  manage the $tlsSecret.
+                properties:
+                  authority:
+                    description: Specifies who to talk ACME with to get certs. Defaults
+                      to Let's Encrypt; if "none" (case-insensitive), do not try to
+                      do ACME for this Host.
+                    type: string
+                  email:
+                    type: string
+                  privateKeySecret:
+                    description: "Specifies the Kubernetes Secret to use to store
+                      the private key of the ACME account (essentially, where to store
+                      the auto-generated password for the auto-created ACME account).
+                      \ You should not normally need to set this--the default value
+                      is based on a combination of the ACME authority being registered
+                      wit and the email address associated with the account. \n Note
+                      that this is a native-Kubernetes-style core.v1.LocalObjectReference,
+                      not an Ambassador-style `{name}.{namespace}` string.  Because
+                      we're opinionated, it does not support referencing a Secret
+                      in another namespace (because most native Kubernetes resources
+                      don't support that), but if we ever abandon that opinion and
+                      decide to support non-local references it, it would be by adding
+                      a `namespace:` field by changing it from a core.v1.LocalObjectReference
+                      to a core.v1.SecretReference, not by adopting the `{name}.{namespace}`
+                      notation."
+                    properties:
+                      name:
+                        description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
+                          TODO: Add other useful fields. apiVersion, kind, uid?'
+                        type: string
+                    type: object
+                  registration:
+                    description: This is normally set automatically
+                    type: string
+                type: object
+              ambassador_id:
+                description: Common to all Ambassador objects (and optional).
+                items:
+                  type: string
+                type: array
+              hostname:
+                description: Hostname by which the Ambassador can be reached.
+                type: string
+              mappingSelector:
+                description: Selector for Mappings we'll associate with this Host.
+                  At the moment, Selector and MappingSelector are synonyms, but that
+                  will change soon.
+                properties:
+                  matchExpressions:
+                    description: matchExpressions is a list of label selector requirements.
+                      The requirements are ANDed.
+                    items:
+                      description: A label selector requirement is a selector that
+                        contains values, a key, and an operator that relates the key
+                        and values.
+                      properties:
+                        key:
+                          description: key is the label key that the selector applies
+                            to.
+                          type: string
+                        operator:
+                          description: operator represents a key's relationship to
+                            a set of values. Valid operators are In, NotIn, Exists
+                            and DoesNotExist.
+                          type: string
+                        values:
+                          description: values is an array of string values. If the
+                            operator is In or NotIn, the values array must be non-empty.
+                            If the operator is Exists or DoesNotExist, the values
+                            array must be empty. This array is replaced during a strategic
+                            merge patch.
+                          items:
+                            type: string
+                          type: array
+                      required:
+                      - key
+                      - operator
+                      type: object
+                    type: array
+                  matchLabels:
+                    additionalProperties:
+                      type: string
+                    description: matchLabels is a map of {key,value} pairs. A single
+                      {key,value} in the matchLabels map is equivalent to an element
+                      of matchExpressions, whose key field is "key", the operator
+                      is "In", and the values array contains only "value". The requirements
+                      are ANDed.
+                    type: object
+                type: object
+              previewUrl:
+                description: Configuration for the Preview URL feature of Service
+                  Preview. Defaults to preview URLs not enabled.
+                properties:
+                  enabled:
+                    description: Is the Preview URL feature enabled?
+                    type: boolean
+                  type:
+                    description: What type of Preview URL is allowed?
+                    enum:
+                    - Path
+                    type: string
+                type: object
+              requestPolicy:
+                description: Request policy definition.
+                properties:
+                  insecure:
+                    properties:
+                      action:
+                        enum:
+                        - Redirect
+                        - Reject
+                        - Route
+                        type: string
+                      additionalPort:
+                        type: integer
+                    type: object
+                type: object
+              selector:
+                description: "DEPRECATED: Selector by which we can find further configuration.
+                  Use MappingSelector instead. \n TODO(lukeshu): In v3alpha2, figure
+                  out how to get rid of HostSpec.DeprecatedSelector."
+                properties:
+                  matchExpressions:
+                    description: matchExpressions is a list of label selector requirements.
+                      The requirements are ANDed.
+                    items:
+                      description: A label selector requirement is a selector that
+                        contains values, a key, and an operator that relates the key
+                        and values.
+                      properties:
+                        key:
+                          description: key is the label key that the selector applies
+                            to.
+                          type: string
+                        operator:
+                          description: operator represents a key's relationship to
+                            a set of values. Valid operators are In, NotIn, Exists
+                            and DoesNotExist.
+                          type: string
+                        values:
+                          description: values is an array of string values. If the
+                            operator is In or NotIn, the values array must be non-empty.
+                            If the operator is Exists or DoesNotExist, the values
+                            array must be empty. This array is replaced during a strategic
+                            merge patch.
+                          items:
+                            type: string
+                          type: array
+                      required:
+                      - key
+                      - operator
+                      type: object
+                    type: array
+                  matchLabels:
+                    additionalProperties:
+                      type: string
+                    description: matchLabels is a map of {key,value} pairs. A single
+                      {key,value} in the matchLabels map is equivalent to an element
+                      of matchExpressions, whose key field is "key", the operator
+                      is "In", and the values array contains only "value". The requirements
+                      are ANDed.
+                    type: object
+                type: object
+              tls:
+                description: TLS configuration.  It is not valid to specify both `tlsContext`
+                  and `tls`.
+                properties:
+                  alpn_protocols:
+                    type: string
+                  ca_secret:
+                    type: string
+                  cacert_chain_file:
+                    type: string
+                  cert_chain_file:
+                    type: string
+                  cert_required:
+                    type: boolean
+                  cipher_suites:
+                    items:
+                      type: string
+                    type: array
+                  crl_secret:
+                    type: string
+                  ecdh_curves:
+                    items:
+                      type: string
+                    type: array
+                  max_tls_version:
+                    type: string
+                  min_tls_version:
+                    type: string
+                  private_key_file:
+                    type: string
+                  redirect_cleartext_from:
+                    type: integer
+                  sni:
+                    type: string
+                type: object
+              tlsContext:
+                description: "Name of the TLSContext the Host resource is linked with.
+                  It is not valid to specify both `tlsContext` and `tls`. \n Note
+                  that this is a native-Kubernetes-style core.v1.LocalObjectReference,
+                  not an Ambassador-style `{name}.{namespace}` string.  Because we're
+                  opinionated, it does not support referencing a Secret in another
+                  namespace (because most native Kubernetes resources don't support
+                  that), but if we ever abandon that opinion and decide to support
+                  non-local references it, it would be by adding a `namespace:` field
+                  by changing it from a core.v1.LocalObjectReference to a core.v1.SecretReference,
+                  not by adopting the `{name}.{namespace}` notation."
+                properties:
+                  name:
+                    description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
+                      TODO: Add other useful fields. apiVersion, kind, uid?'
+                    type: string
+                type: object
+              tlsSecret:
+                description: "Name of the Kubernetes secret into which to save generated
+                  certificates.  If ACME is enabled (see $acmeProvider), then the
+                  default is $hostname; otherwise the default is \"\".  If the value
+                  is \"\", then we do not do TLS for this Host. \n Note that this
+                  is a native-Kubernetes-style core.v1.LocalObjectReference, not an
+                  Ambassador-style `{name}.{namespace}` string.  Because we're opinionated,
+                  it does not support referencing a Secret in another namespace (because
+                  most native Kubernetes resources don't support that), but if we
+                  ever abandon that opinion and decide to support non-local references
+                  it, it would be by adding a `namespace:` field by changing it from
+                  a core.v1.LocalObjectReference to a core.v1.SecretReference, not
+                  by adopting the `{name}.{namespace}` notation."
+                properties:
+                  name:
+                    description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
+                      TODO: Add other useful fields. apiVersion, kind, uid?'
+                    type: string
+                type: object
+            type: object
+          status:
+            description: HostStatus defines the observed state of Host
+            properties:
+              errorBackoff:
+                type: string
+              errorReason:
+                description: errorReason, errorTimestamp, and errorBackoff are valid
+                  when state==Error.
+                type: string
+              errorTimestamp:
+                format: date-time
+                type: string
+              phaseCompleted:
+                description: phaseCompleted and phasePending are valid when state==Pending
+                  or state==Error.
+                enum:
+                - NA
+                - DefaultsFilled
+                - ACMEUserPrivateKeyCreated
+                - ACMEUserRegistered
+                - ACMECertificateChallenge
+                type: string
+              phasePending:
+                description: phaseCompleted and phasePending are valid when state==Pending
+                  or state==Error.
+                enum:
+                - NA
+                - DefaultsFilled
+                - ACMEUserPrivateKeyCreated
+                - ACMEUserRegistered
+                - ACMECertificateChallenge
+                type: string
+              state:
+                description: The first value listed in the Enum marker becomes the
+                  "zero" value, and it would be great if "Pending" could be the default
+                  value; but it's Important that the "zero" value be able to be shown
+                  as empty/omitted from display, and we really do want `kubectl get
+                  hosts` to say "Pending" in the "STATE" column, and not leave the
+                  column empty.
+                enum:
+                - Initial
+                - Pending
+                - Ready
+                - Error
+                type: string
+              tlsCertificateSource:
+                enum:
+                - Unknown
+                - None
+                - Other
+                - ACME
+                type: string
+            type: object
+        type: object
+    served: true
+    storage: false
+    subresources:
+      status: {}
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    controller-gen.kubebuilder.io/version: 3.0.0-cbf68a7dd53dda13c681af3e19660a5605050839
+  labels:
+    app.kubernetes.io/instance: emissary-apiext
+    app.kubernetes.io/managed-by: kubectl_apply_-f_emissary-apiext.yaml
+    app.kubernetes.io/name: emissary-apiext
+    app.kubernetes.io/part-of: emissary-apiext
+  name: kubernetesendpointresolvers.getambassador.io
+spec:
+  conversion:
+    strategy: Webhook
+    webhook:
+      clientConfig:
+        service:
+          name: emissary-apiext
+          namespace: emissary-system
+      conversionReviewVersions:
+      - v1beta1
+  group: getambassador.io
+  names:
+    categories:
+    - ambassador-crds
+    kind: KubernetesEndpointResolver
+    listKind: KubernetesEndpointResolverList
+    plural: kubernetesendpointresolvers
+    singular: kubernetesendpointresolver
+  preserveUnknownFields: false
+  scope: Namespaced
+  versions:
+  - name: v2
+    schema:
+      openAPIV3Schema:
+        description: KubernetesEndpointResolver is the Schema for the kubernetesendpointresolver
+          API
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: KubernetesEndpointResolver tells Ambassador to use Kubernetes
+              Endpoints resources to resolve services. It actually has no spec other
+              than the AmbassadorID.
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+  - name: v3alpha1
+    schema:
+      openAPIV3Schema:
+        description: KubernetesEndpointResolver is the Schema for the kubernetesendpointresolver
+          API
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: KubernetesEndpointResolver tells Ambassador to use Kubernetes
+              Endpoints resources to resolve services. It actually has no spec other
+              than the AmbassadorID.
+            properties:
+              ambassador_id:
+                description: "AmbassadorID declares which Ambassador instances should
+                  pay attention to this resource. If no value is provided, the default
+                  is: \n    ambassador_id:    - \"default\" \n TODO(lukeshu): In v3alpha2,
+                  consider renaming all of the `ambassador_id` (singular) fields to
+                  `ambassador_ids` (plural)."
+                items:
+                  type: string
+                type: array
+            type: object
+        type: object
+    served: true
+    storage: false
+  - name: v1
+    schema:
+      openAPIV3Schema:
+        description: KubernetesEndpointResolver is the Schema for the kubernetesendpointresolver
+          API
+        type: object
+        x-kubernetes-preserve-unknown-fields: true
+    served: false
+    storage: false
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    controller-gen.kubebuilder.io/version: 3.0.0-cbf68a7dd53dda13c681af3e19660a5605050839
+  labels:
+    app.kubernetes.io/instance: emissary-apiext
+    app.kubernetes.io/managed-by: kubectl_apply_-f_emissary-apiext.yaml
+    app.kubernetes.io/name: emissary-apiext
+    app.kubernetes.io/part-of: emissary-apiext
+  name: kubernetesserviceresolvers.getambassador.io
+spec:
+  conversion:
+    strategy: Webhook
+    webhook:
+      clientConfig:
+        service:
+          name: emissary-apiext
+          namespace: emissary-system
+      conversionReviewVersions:
+      - v1beta1
+  group: getambassador.io
+  names:
+    categories:
+    - ambassador-crds
+    kind: KubernetesServiceResolver
+    listKind: KubernetesServiceResolverList
+    plural: kubernetesserviceresolvers
+    singular: kubernetesserviceresolver
+  preserveUnknownFields: false
+  scope: Namespaced
+  versions:
+  - name: v2
+    schema:
+      openAPIV3Schema:
+        description: KubernetesServiceResolver is the Schema for the kubernetesserviceresolver
+          API
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: KubernetesServiceResolver tells Ambassador to use Kubernetes
+              Service resources to resolve services. It actually has no spec other
+              than the AmbassadorID.
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+  - name: v3alpha1
+    schema:
+      openAPIV3Schema:
+        description: KubernetesServiceResolver is the Schema for the kubernetesserviceresolver
+          API
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: KubernetesServiceResolver tells Ambassador to use Kubernetes
+              Service resources to resolve services. It actually has no spec other
+              than the AmbassadorID.
+            properties:
+              ambassador_id:
+                description: "AmbassadorID declares which Ambassador instances should
+                  pay attention to this resource. If no value is provided, the default
+                  is: \n    ambassador_id:    - \"default\" \n TODO(lukeshu): In v3alpha2,
+                  consider renaming all of the `ambassador_id` (singular) fields to
+                  `ambassador_ids` (plural)."
+                items:
+                  type: string
+                type: array
+            type: object
+        type: object
+    served: true
+    storage: false
+  - name: v1
+    schema:
+      openAPIV3Schema:
+        description: KubernetesServiceResolver is the Schema for the kubernetesserviceresolver
+          API
+        type: object
+        x-kubernetes-preserve-unknown-fields: true
+    served: false
+    storage: false
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    controller-gen.kubebuilder.io/version: 3.0.0-cbf68a7dd53dda13c681af3e19660a5605050839
+  labels:
+    app.kubernetes.io/instance: emissary-apiext
+    app.kubernetes.io/managed-by: kubectl_apply_-f_emissary-apiext.yaml
+    app.kubernetes.io/name: emissary-apiext
+    app.kubernetes.io/part-of: emissary-apiext
+  name: listeners.getambassador.io
+spec:
+  group: getambassador.io
+  names:
+    categories:
+    - ambassador-crds
+    kind: Listener
+    listKind: ListenerList
+    plural: listeners
+    singular: listener
+  preserveUnknownFields: false
+  scope: Namespaced
+  versions:
+  - additionalPrinterColumns:
+    - jsonPath: .spec.port
+      name: Port
+      type: string
+    - jsonPath: .spec.protocol
+      name: Protocol
+      type: string
+    - jsonPath: .spec.protocolStack
+      name: Stack
+      type: string
+    - jsonPath: .spec.statsPrefix
+      name: StatsPrefix
+      type: string
+    - jsonPath: .spec.securityModel
+      name: Security
+      type: string
+    - jsonPath: .spec.l7Depth
+      name: L7Depth
+      type: string
+    name: v3alpha1
+    schema:
+      openAPIV3Schema:
+        description: Listener is the Schema for the hosts API
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: ListenerSpec defines the desired state of this Port
+            properties:
+              ambassador_id:
+                description: "AmbassadorID declares which Ambassador instances should
+                  pay attention to this resource. If no value is provided, the default
+                  is: \n    ambassador_id:    - \"default\" \n TODO(lukeshu): In v3alpha2,
+                  consider renaming all of the `ambassador_id` (singular) fields to
+                  `ambassador_ids` (plural)."
+                items:
+                  type: string
+                type: array
+              hostBinding:
+                description: HostBinding allows restricting which Hosts will be used
+                  for this Listener.
+                properties:
+                  namespace:
+                    description: NamespaceBindingType defines we we specify which
+                      namespaces to look for Hosts in.
+                    properties:
+                      from:
+                        description: NamespaceFromType defines how we evaluate a NamespaceBindingType.
+                        enum:
+                        - SELF
+                        - ALL
+                        - SELECTOR
+                        type: string
+                    type: object
+                  selector:
+                    description: A label selector is a label query over a set of resources.
+                      The result of matchLabels and matchExpressions are ANDed. An
+                      empty label selector matches all objects. A null label selector
+                      matches no objects.
+                    properties:
+                      matchExpressions:
+                        description: matchExpressions is a list of label selector
+                          requirements. The requirements are ANDed.
+                        items:
+                          description: A label selector requirement is a selector
+                            that contains values, a key, and an operator that relates
+                            the key and values.
+                          properties:
+                            key:
+                              description: key is the label key that the selector
+                                applies to.
+                              type: string
+                            operator:
+                              description: operator represents a key's relationship
+                                to a set of values. Valid operators are In, NotIn,
+                                Exists and DoesNotExist.
+                              type: string
+                            values:
+                              description: values is an array of string values. If
+                                the operator is In or NotIn, the values array must
+                                be non-empty. If the operator is Exists or DoesNotExist,
+                                the values array must be empty. This array is replaced
+                                during a strategic merge patch.
+                              items:
+                                type: string
+                              type: array
+                          required:
+                          - key
+                          - operator
+                          type: object
+                        type: array
+                      matchLabels:
+                        additionalProperties:
+                          type: string
+                        description: matchLabels is a map of {key,value} pairs. A
+                          single {key,value} in the matchLabels map is equivalent
+                          to an element of matchExpressions, whose key field is "key",
+                          the operator is "In", and the values array contains only
+                          "value". The requirements are ANDed.
+                        type: object
+                    type: object
+                type: object
+              l7Depth:
+                description: L7Depth specifies how many layer 7 load balancers are
+                  between us and the edge of the network.
+                format: int32
+                type: integer
+              port:
+                description: Port is the network port. Only one Listener can use a
+                  given port.
+                format: int32
+                maximum: 65535
+                minimum: 1
+                type: integer
+              protocol:
+                description: Protocol is a shorthand for certain predefined stacks.
+                  Exactly one of Protocol or ProtocolStack must be supplied.
+                enum:
+                - HTTP
+                - HTTPS
+                - HTTPPROXY
+                - HTTPSPROXY
+                - TCP
+                - TLS
+                - UDP
+                type: string
+              protocolStack:
+                description: ProtocolStack explicitly specifies the protocol stack
+                  to set up. Exactly one of Protocol or ProtocolStack must be supplied.
+                items:
+                  description: ProtocolStackElement defines specific layers that may
+                    be combined in a protocol stack for processing connections to
+                    a port.
+                  enum:
+                  - HTTP
+                  - PROXY
+                  - TLS
+                  - TCP
+                  - UDP
+                  type: string
+                type: array
+              securityModel:
+                description: SecurityModel specifies how to determine whether connections
+                  to this port are secure or insecure.
+                enum:
+                - XFP
+                - SECURE
+                - INSECURE
+                type: string
+              statsPrefix:
+                description: 'StatsPrefix specifies the prefix for statistics sent
+                  by Envoy about this Listener. The default depends on the protocol:
+                  "ingress-http", "ingress-https", "ingress-tls-$port", or "ingress-$port".'
+                type: string
+            required:
+            - hostBinding
+            - port
+            - securityModel
+            type: object
+        type: object
+    served: true
+    storage: true
+    subresources: {}
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    controller-gen.kubebuilder.io/version: 3.0.0-cbf68a7dd53dda13c681af3e19660a5605050839
+  labels:
+    app.kubernetes.io/instance: emissary-apiext
+    app.kubernetes.io/managed-by: kubectl_apply_-f_emissary-apiext.yaml
+    app.kubernetes.io/name: emissary-apiext
+    app.kubernetes.io/part-of: emissary-apiext
+  name: logservices.getambassador.io
+spec:
+  conversion:
+    strategy: Webhook
+    webhook:
+      clientConfig:
+        service:
+          name: emissary-apiext
+          namespace: emissary-system
+      conversionReviewVersions:
+      - v1beta1
+  group: getambassador.io
+  names:
+    categories:
+    - ambassador-crds
+    kind: LogService
+    listKind: LogServiceList
+    plural: logservices
+    singular: logservice
+  preserveUnknownFields: false
+  scope: Namespaced
+  versions:
+  - name: v2
+    schema:
+      openAPIV3Schema:
+        description: LogService is the Schema for the logservices API
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: LogServiceSpec defines the desired state of LogService
+            properties:
+              driver:
+                enum:
+                - tcp
+                - http
+                type: string
+              driver_config:
+                properties:
+                  additional_log_headers:
+                    items:
+                      properties:
+                        during_request:
+                          type: boolean
+                        during_response:
+                          type: boolean
+                        during_trailer:
+                          type: boolean
+                        header_name:
+                          type: string
+                      type: object
+                    type: array
+                type: object
+              flush_interval_byte_size:
+                type: integer
+              flush_interval_time:
+                type: integer
+              grpc:
+                type: boolean
+              service:
+                type: string
+              v3ProtocolVersion:
+                enum:
+                - v2
+                - v3
+                type: string
+              v3StatsName:
+                type: string
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+  - name: v3alpha1
+    schema:
+      openAPIV3Schema:
+        description: LogService is the Schema for the logservices API
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: LogServiceSpec defines the desired state of LogService
+            properties:
+              ambassador_id:
+                description: "AmbassadorID declares which Ambassador instances should
+                  pay attention to this resource. If no value is provided, the default
+                  is: \n    ambassador_id:    - \"default\" \n TODO(lukeshu): In v3alpha2,
+                  consider renaming all of the `ambassador_id` (singular) fields to
+                  `ambassador_ids` (plural)."
+                items:
+                  type: string
+                type: array
+              driver:
+                enum:
+                - tcp
+                - http
+                type: string
+              driver_config:
+                properties:
+                  additional_log_headers:
+                    items:
+                      properties:
+                        during_request:
+                          type: boolean
+                        during_response:
+                          type: boolean
+                        during_trailer:
+                          type: boolean
+                        header_name:
+                          type: string
+                      type: object
+                    type: array
+                type: object
+              flush_interval_byte_size:
+                type: integer
+              flush_interval_time:
+                description: 'TODO(lukeshu): In v3alpha2, change all of the `{foo}s`/`SecondDuration`
+                  fields to `{foo}`/`metav1.Duration`.'
+                type: integer
+              grpc:
+                description: 'TODO(lukeshu): In v3alpha2, drop this LogService.spec.grpc.  Due
+                  to sloppy implementation it is required to be present, and required
+                  to be ''true''.  It is silly to have a required field with only
+                  one valid value, we should just remove the thing.'
+                type: boolean
+              protocol_version:
+                description: ProtocolVersion is the envoy api transport protocol version
+                enum:
+                - v2
+                - v3
+                type: string
+              service:
+                type: string
+              stats_name:
+                type: string
+            type: object
+        type: object
+    served: true
+    storage: false
+  - name: v1
+    schema:
+      openAPIV3Schema:
+        description: LogService is the Schema for the logservices API
+        type: object
+        x-kubernetes-preserve-unknown-fields: true
+    served: false
+    storage: false
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    controller-gen.kubebuilder.io/version: 3.0.0-cbf68a7dd53dda13c681af3e19660a5605050839
+  labels:
+    app.kubernetes.io/instance: emissary-apiext
+    app.kubernetes.io/managed-by: kubectl_apply_-f_emissary-apiext.yaml
+    app.kubernetes.io/name: emissary-apiext
+    app.kubernetes.io/part-of: emissary-apiext
+  name: mappings.getambassador.io
+spec:
+  conversion:
+    strategy: Webhook
+    webhook:
+      clientConfig:
+        service:
+          name: emissary-apiext
+          namespace: emissary-system
+      conversionReviewVersions:
+      - v1beta1
+  group: getambassador.io
+  names:
+    categories:
+    - ambassador-crds
+    kind: Mapping
+    listKind: MappingList
+    plural: mappings
+    singular: mapping
+  preserveUnknownFields: false
+  scope: Namespaced
+  versions:
+  - additionalPrinterColumns:
+    - jsonPath: .spec.host
+      name: Source Host
+      type: string
+    - jsonPath: .spec.prefix
+      name: Source Prefix
+      type: string
+    - jsonPath: .spec.service
+      name: Dest Service
+      type: string
+    - jsonPath: .status.state
+      name: State
+      type: string
+    - jsonPath: .status.reason
+      name: Reason
+      type: string
+    name: v2
+    schema:
+      openAPIV3Schema:
+        description: Mapping is the Schema for the mappings API
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: MappingSpec defines the desired state of Mapping
+            properties:
+              add_linkerd_headers:
+                type: boolean
+              add_request_headers:
+                type: object
+                x-kubernetes-preserve-unknown-fields: true
+              add_response_headers:
+                type: object
+                x-kubernetes-preserve-unknown-fields: true
+              allow_upgrade:
+                description: "A case-insensitive list of the non-HTTP protocols to
+                  allow \"upgrading\" to from HTTP via the \"Connection: upgrade\"
+                  mechanism[1].  After the upgrade, Ambassador does not interpret
+                  the traffic, and behaves similarly to how it does for TCPMappings.
+                  \n [1]: https://tools.ietf.org/html/rfc7230#section-6.7 \n For example,
+                  if your upstream service supports WebSockets, you would write \n
+                  \   allow_upgrade:    - websocket \n Or if your upstream service
+                  supports upgrading from HTTP to SPDY (as the Kubernetes apiserver
+                  does for `kubectl exec` functionality), you would write \n    allow_upgrade:
+                  \   - spdy/3.1"
+                items:
+                  type: string
+                type: array
+              auth_context_extensions:
+                additionalProperties:
+                  type: string
+                type: object
+              auto_host_rewrite:
+                type: boolean
+              bypass_auth:
+                type: boolean
+              bypass_error_response_overrides:
+                description: If true, bypasses any `error_response_overrides` set
+                  on the Ambassador module.
+                type: boolean
+              case_sensitive:
+                type: boolean
+              circuit_breakers:
+                items:
+                  properties:
+                    max_connections:
+                      type: integer
+                    max_pending_requests:
+                      type: integer
+                    max_requests:
+                      type: integer
+                    max_retries:
+                      type: integer
+                    priority:
+                      enum:
+                      - default
+                      - high
+                      type: string
+                  type: object
+                type: array
+              cluster_idle_timeout_ms:
+                type: integer
+              cluster_max_connection_lifetime_ms:
+                type: integer
+              cluster_tag:
+                type: string
+              connect_timeout_ms:
+                type: integer
+              cors:
+                properties:
+                  credentials:
+                    type: boolean
+                  max_age:
+                    type: string
+                type: object
+                x-kubernetes-preserve-unknown-fields: true
+              dns_type:
+                type: string
+              docs:
+                description: DocsInfo provides some extra information about the docs
+                  for the Mapping (used by the Dev Portal)
+                properties:
+                  display_name:
+                    type: string
+                  ignored:
+                    type: boolean
+                  path:
+                    type: string
+                  timeout_ms:
+                    type: integer
+                  url:
+                    type: string
+                type: object
+              enable_ipv4:
+                type: boolean
+              enable_ipv6:
+                type: boolean
+              envoy_override:
+                description: UntypedDict is relatively opaque as a Go type, but it
+                  preserves its contents in a roundtrippable way.
+                type: object
+                x-kubernetes-preserve-unknown-fields: true
+              error_response_overrides:
+                description: Error response overrides for this Mapping. Replaces all
+                  of the `error_response_overrides` set on the Ambassador module,
+                  if any.
+                items:
+                  description: A response rewrite for an HTTP error response
+                  properties:
+                    body:
+                      description: The new response body
+                      properties:
+                        content_type:
+                          description: The content type to set on the error response
+                            body when using text_format or text_format_source. Defaults
+                            to 'text/plain'.
+                          type: string
+                        json_format:
+                          additionalProperties:
+                            type: string
+                          description: 'A JSON response with content-type: application/json.
+                            The values can contain format text like in text_format.'
+                          type: object
+                        text_format:
+                          description: A format string representing a text response
+                            body. Content-Type can be set using the `content_type`
+                            field below.
+                          type: string
+                        text_format_source:
+                          description: A format string sourced from a file on the
+                            Ambassador container. Useful for larger response bodies
+                            that should not be placed inline in configuration.
+                          properties:
+                            filename:
+                              description: The name of a file on the Ambassador pod
+                                that contains a format text string.
+                              type: string
+                          type: object
+                      type: object
+                    on_status_code:
+                      description: The status code to match on -- not a pointer because
+                        it's required.
+                      maximum: 599
+                      minimum: 400
+                      type: integer
+                  required:
+                  - body
+                  - on_status_code
+                  type: object
+                minItems: 1
+                type: array
+              grpc:
+                type: boolean
+              headers:
+                type: object
+                x-kubernetes-preserve-unknown-fields: true
+              host:
+                type: string
+              host_redirect:
+                type: boolean
+              host_regex:
+                type: boolean
+              host_rewrite:
+                type: string
+              idle_timeout_ms:
+                type: integer
+              keepalive:
+                properties:
+                  idle_time:
+                    type: integer
+                  interval:
+                    type: integer
+                  probes:
+                    type: integer
+                type: object
+              labels:
+                additionalProperties:
+                  description: A MappingLabelGroupsArray is an array of MappingLabelGroups.
+                    I know, complex.
+                  items:
+                    description: 'A MappingLabelGroup is a single element of a MappingLabelGroupsArray:
+                      a second map, where the key is a human-readable name that identifies
+                      the group.'
+                    maxProperties: 1
+                    minProperties: 1
+                    type: object
+                    x-kubernetes-preserve-unknown-fields: true
+                  type: array
+                description: A DomainMap is the overall Mapping.spec.Labels type.
+                  It maps domains (kind of like namespaces for Mapping labels) to
+                  arrays of label groups.
+                type: object
+              load_balancer:
+                properties:
+                  cookie:
+                    properties:
+                      name:
+                        type: string
+                      path:
+                        type: string
+                      ttl:
+                        type: string
+                    required:
+                    - name
+                    type: object
+                  header:
+                    type: string
+                  policy:
+                    enum:
+                    - round_robin
+                    - ring_hash
+                    - maglev
+                    - least_request
+                    type: string
+                  source_ip:
+                    type: boolean
+                required:
+                - policy
+                type: object
+              method:
+                type: string
+              method_regex:
+                type: boolean
+              modules:
+                items:
+                  description: UntypedDict is relatively opaque as a Go type, but
+                    it preserves its contents in a roundtrippable way.
+                  type: object
+                  x-kubernetes-preserve-unknown-fields: true
+                type: array
+              outlier_detection:
+                type: string
+              path_redirect:
+                description: Path replacement to use when generating an HTTP redirect.
+                  Used with `host_redirect`.
+                type: string
+              precedence:
+                type: integer
+              prefix:
+                type: string
+              prefix_exact:
+                type: boolean
+              prefix_redirect:
+                description: Prefix rewrite to use when generating an HTTP redirect.
+                  Used with `host_redirect`.
+                type: string
+              prefix_regex:
+                type: boolean
+              priority:
+                type: string
+              query_parameters:
+                type: object
+                x-kubernetes-preserve-unknown-fields: true
+              redirect_response_code:
+                description: The response code to use when generating an HTTP redirect.
+                  Defaults to 301. Used with `host_redirect`.
+                enum:
+                - 301
+                - 302
+                - 303
+                - 307
+                - 308
+                type: integer
+              regex_headers:
+                additionalProperties:
+                  type: string
+                type: object
+              regex_query_parameters:
+                additionalProperties:
+                  type: string
+                type: object
+              regex_redirect:
+                description: Prefix regex rewrite to use when generating an HTTP redirect.
+                  Used with `host_redirect`.
+                properties:
+                  pattern:
+                    type: string
+                  substitution:
+                    type: string
+                type: object
+              regex_rewrite:
+                properties:
+                  pattern:
+                    type: string
+                  substitution:
+                    type: string
+                type: object
+              resolver:
+                type: string
+              respect_dns_ttl:
+                type: boolean
+              retry_policy:
+                properties:
+                  num_retries:
+                    type: integer
+                  per_try_timeout:
+                    type: string
+                  retry_on:
+                    enum:
+                    - 5xx
+                    - gateway-error
+                    - connect-failure
+                    - retriable-4xx
+                    - refused-stream
+                    - retriable-status-codes
+                    type: string
+                type: object
+              rewrite:
+                type: string
+              service:
+                type: string
+              shadow:
+                type: boolean
+              timeout_ms:
+                description: The timeout for requests that use this Mapping. Overrides
+                  `cluster_request_timeout_ms` set on the Ambassador Module, if it
+                  exists.
+                type: integer
+              use_websocket:
+                description: 'use_websocket is deprecated, and is equivlaent to setting
+                  `allow_upgrade: ["websocket"]`'
+                type: boolean
+              v3StatsName:
+                type: string
+              weight:
+                type: integer
+            required:
+            - prefix
+            - service
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+          status:
+            description: MappingStatus defines the observed state of Mapping
+            properties:
+              reason:
+                type: string
+              state:
+                enum:
+                - ""
+                - Inactive
+                - Running
+                type: string
+            type: object
+        type: object
+    served: true
+    storage: true
+    subresources:
+      status: {}
+  - additionalPrinterColumns:
+    - jsonPath: .spec.host
+      name: Source Host
+      type: string
+    - jsonPath: .spec.prefix
+      name: Source Prefix
+      type: string
+    - jsonPath: .spec.service
+      name: Dest Service
+      type: string
+    - jsonPath: .status.state
+      name: State
+      type: string
+    - jsonPath: .status.reason
+      name: Reason
+      type: string
+    name: v3alpha1
+    schema:
+      openAPIV3Schema:
+        description: Mapping is the Schema for the mappings API
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: MappingSpec defines the desired state of Mapping
+            properties:
+              add_linkerd_headers:
+                type: boolean
+              add_request_headers:
+                additionalProperties:
+                  properties:
+                    append:
+                      type: boolean
+                    v2Representation:
+                      enum:
+                      - ""
+                      - string
+                      - "null"
+                      type: string
+                    value:
+                      type: string
+                  type: object
+                type: object
+              add_response_headers:
+                additionalProperties:
+                  properties:
+                    append:
+                      type: boolean
+                    v2Representation:
+                      enum:
+                      - ""
+                      - string
+                      - "null"
+                      type: string
+                    value:
+                      type: string
+                  type: object
+                type: object
+              allow_upgrade:
+                description: "A case-insensitive list of the non-HTTP protocols to
+                  allow \"upgrading\" to from HTTP via the \"Connection: upgrade\"
+                  mechanism[1].  After the upgrade, Ambassador does not interpret
+                  the traffic, and behaves similarly to how it does for TCPMappings.
+                  \n [1]: https://tools.ietf.org/html/rfc7230#section-6.7 \n For example,
+                  if your upstream service supports WebSockets, you would write \n
+                  \   allow_upgrade:    - websocket \n Or if your upstream service
+                  supports upgrading from HTTP to SPDY (as the Kubernetes apiserver
+                  does for `kubectl exec` functionality), you would write \n    allow_upgrade:
+                  \   - spdy/3.1"
+                items:
+                  type: string
+                type: array
+              ambassador_id:
+                description: "AmbassadorID declares which Ambassador instances should
+                  pay attention to this resource. If no value is provided, the default
+                  is: \n    ambassador_id:    - \"default\" \n TODO(lukeshu): In v3alpha2,
+                  consider renaming all of the `ambassador_id` (singular) fields to
+                  `ambassador_ids` (plural)."
+                items:
+                  type: string
+                type: array
+              auth_context_extensions:
+                additionalProperties:
+                  type: string
+                type: object
+              auto_host_rewrite:
+                type: boolean
+              bypass_auth:
+                type: boolean
+              bypass_error_response_overrides:
+                description: If true, bypasses any `error_response_overrides` set
+                  on the Ambassador module.
+                type: boolean
+              case_sensitive:
+                type: boolean
+              circuit_breakers:
+                items:
+                  properties:
+                    max_connections:
+                      type: integer
+                    max_pending_requests:
+                      type: integer
+                    max_requests:
+                      type: integer
+                    max_retries:
+                      type: integer
+                    priority:
+                      enum:
+                      - default
+                      - high
+                      type: string
+                  type: object
+                type: array
+              cluster_idle_timeout_ms:
+                description: 'TODO(lukeshu): In v3alpha2, change all of the `{foo}_ms`/`MillisecondDuration`
+                  fields to `{foo}`/`metav1.Duration`.'
+                type: integer
+              cluster_max_connection_lifetime_ms:
+                description: 'TODO(lukeshu): In v3alpha2, change all of the `{foo}_ms`/`MillisecondDuration`
+                  fields to `{foo}`/`metav1.Duration`.'
+                type: integer
+              cluster_tag:
+                type: string
+              connect_timeout_ms:
+                description: 'TODO(lukeshu): In v3alpha2, change all of the `{foo}_ms`/`MillisecondDuration`
+                  fields to `{foo}`/`metav1.Duration`.'
+                type: integer
+              cors:
+                properties:
+                  credentials:
+                    type: boolean
+                  exposed_headers:
+                    items:
+                      type: string
+                    type: array
+                  headers:
+                    items:
+                      type: string
+                    type: array
+                  max_age:
+                    type: string
+                  methods:
+                    items:
+                      type: string
+                    type: array
+                  origins:
+                    items:
+                      type: string
+                    type: array
+                  v2CommaSeparatedOrigins:
+                    type: boolean
+                type: object
+              dns_type:
+                type: string
+              docs:
+                description: DocsInfo provides some extra information about the docs
+                  for the Mapping. Docs is used by both the agent and the DevPortal.
+                properties:
+                  display_name:
+                    type: string
+                  ignored:
+                    type: boolean
+                  path:
+                    type: string
+                  timeout_ms:
+                    description: 'TODO(lukeshu): In v3alpha2, change all of the `{foo}_ms`/`MillisecondDuration`
+                      fields to `{foo}`/`metav1.Duration`.'
+                    type: integer
+                  url:
+                    type: string
+                type: object
+              enable_ipv4:
+                type: boolean
+              enable_ipv6:
+                type: boolean
+              envoy_override:
+                description: UntypedDict is relatively opaque as a Go type, but it
+                  preserves its contents in a roundtrippable way.
+                type: object
+                x-kubernetes-preserve-unknown-fields: true
+              error_response_overrides:
+                description: Error response overrides for this Mapping. Replaces all
+                  of the `error_response_overrides` set on the Ambassador module,
+                  if any.
+                items:
+                  description: A response rewrite for an HTTP error response
+                  properties:
+                    body:
+                      description: The new response body
+                      properties:
+                        content_type:
+                          description: The content type to set on the error response
+                            body when using text_format or text_format_source. Defaults
+                            to 'text/plain'.
+                          type: string
+                        json_format:
+                          additionalProperties:
+                            type: string
+                          description: 'A JSON response with content-type: application/json.
+                            The values can contain format text like in text_format.'
+                          type: object
+                        text_format:
+                          description: A format string representing a text response
+                            body. Content-Type can be set using the `content_type`
+                            field below.
+                          type: string
+                        text_format_source:
+                          description: A format string sourced from a file on the
+                            Ambassador container. Useful for larger response bodies
+                            that should not be placed inline in configuration.
+                          properties:
+                            filename:
+                              description: The name of a file on the Ambassador pod
+                                that contains a format text string.
+                              type: string
+                          type: object
+                      type: object
+                    on_status_code:
+                      description: The status code to match on -- not a pointer because
+                        it's required.
+                      maximum: 599
+                      minimum: 400
+                      type: integer
+                  required:
+                  - body
+                  - on_status_code
+                  type: object
+                minItems: 1
+                type: array
+              grpc:
+                type: boolean
+              headers:
+                additionalProperties:
+                  type: string
+                type: object
+              host:
+                description: "Exact match for the hostname of a request if HostRegex
+                  is false; regex match for the hostname if HostRegex is true. \n
+                  Host specifies both a match for the ':authority' header of a request,
+                  as well as a match criterion for Host CRDs: a Mapping that specifies
+                  Host will not associate with a Host that doesn't have a matching
+                  Hostname. \n If both Host and Hostname are set, an error is logged,
+                  Host is ignored, and Hostname is used. \n DEPRECATED: Host is either
+                  an exact match or a regex, depending on HostRegex. Use HostName
+                  instead. \n TODO(lukeshu): In v3alpha2, get rid of MappingSpec.host
+                  and MappingSpec.host_regex in favor of a MappingSpec.deprecated_hostname_regex."
+                type: string
+              host_redirect:
+                type: boolean
+              host_regex:
+                description: "DEPRECATED: Host is either an exact match or a regex,
+                  depending on HostRegex. Use HostName instead. \n TODO(lukeshu):
+                  In v3alpha2, get rid of MappingSpec.host and MappingSpec.host_regex
+                  in favor of a MappingSpec.deprecated_hostname_regex."
+                type: boolean
+              host_rewrite:
+                type: string
+              hostname:
+                description: "Hostname is a DNS glob specifying the hosts to which
+                  this Mapping applies. \n Hostname specifies both a match for the
+                  ':authority' header of a request, as well as a match criterion for
+                  Host CRDs: a Mapping that specifies Hostname will not associate
+                  with a Host that doesn't have a matching Hostname. \n If both Host
+                  and Hostname are set, an error is logged, Host is ignored, and Hostname
+                  is used."
+                type: string
+              idle_timeout_ms:
+                description: 'TODO(lukeshu): In v3alpha2, change all of the `{foo}_ms`/`MillisecondDuration`
+                  fields to `{foo}`/`metav1.Duration`.'
+                type: integer
+              keepalive:
+                properties:
+                  idle_time:
+                    type: integer
+                  interval:
+                    type: integer
+                  probes:
+                    type: integer
+                type: object
+              labels:
+                additionalProperties:
+                  description: A MappingLabelGroupsArray is an array of MappingLabelGroups.
+                    I know, complex.
+                  items:
+                    additionalProperties:
+                      description: 'A MappingLabelsArray is the value in the MappingLabelGroup:
+                        an array of label specifiers.'
+                      items:
+                        description: "A MappingLabelSpecifier (finally!) defines a
+                          single label. \n This mimics envoy/config/route/v3/route_components.proto:RateLimit:Action:action_specifier."
+                        maxProperties: 1
+                        minProperties: 1
+                        properties:
+                          destination_cluster:
+                            description: Sets the label "destination_cluster=«Envoy
+                              destination cluster name»".
+                            properties:
+                              key:
+                                enum:
+                                - destination_cluster
+                                type: string
+                            required:
+                            - key
+                            type: object
+                          generic_key:
+                            description: Sets the label "«key»=«value»" (where by
+                              default «key» is "generic_key").
+                            properties:
+                              key:
+                                description: The default is "generic_key".
+                                type: string
+                              v2Shorthand:
+                                type: boolean
+                              value:
+                                type: string
+                            required:
+                            - value
+                            type: object
+                          remote_address:
+                            description: Sets the label "remote_address=«IP address
+                              of the client»".
+                            properties:
+                              key:
+                                enum:
+                                - remote_address
+                                type: string
+                            required:
+                            - key
+                            type: object
+                          request_headers:
+                            description: If the «header_name» header is set, then
+                              set the label "«key»=«Value of the «header_name» header»";
+                              otherwise skip applying this label group.
+                            properties:
+                              header_name:
+                                type: string
+                              key:
+                                type: string
+                              omit_if_not_present:
+                                type: boolean
+                            required:
+                            - header_name
+                            - key
+                            type: object
+                          source_cluster:
+                            description: Sets the label "source_cluster=«Envoy source
+                              cluster name»".
+                            properties:
+                              key:
+                                enum:
+                                - source_cluster
+                                type: string
+                            required:
+                            - key
+                            type: object
+                        type: object
+                      type: array
+                    description: 'A MappingLabelGroup is a single element of a MappingLabelGroupsArray:
+                      a second map, where the key is a human-readable name that identifies
+                      the group.'
+                    maxProperties: 1
+                    minProperties: 1
+                    type: object
+                  type: array
+                description: A DomainMap is the overall Mapping.spec.Labels type.
+                  It maps domains (kind of like namespaces for Mapping labels) to
+                  arrays of label groups.
+                type: object
+              load_balancer:
+                properties:
+                  cookie:
+                    properties:
+                      name:
+                        type: string
+                      path:
+                        type: string
+                      ttl:
+                        type: string
+                    required:
+                    - name
+                    type: object
+                  header:
+                    type: string
+                  policy:
+                    enum:
+                    - round_robin
+                    - ring_hash
+                    - maglev
+                    - least_request
+                    type: string
+                  source_ip:
+                    type: boolean
+                required:
+                - policy
+                type: object
+              method:
+                type: string
+              method_regex:
+                type: boolean
+              modules:
+                items:
+                  description: UntypedDict is relatively opaque as a Go type, but
+                    it preserves its contents in a roundtrippable way.
+                  type: object
+                  x-kubernetes-preserve-unknown-fields: true
+                type: array
+              outlier_detection:
+                type: string
+              path_redirect:
+                description: Path replacement to use when generating an HTTP redirect.
+                  Used with `host_redirect`.
+                type: string
+              precedence:
+                type: integer
+              prefix:
+                type: string
+              prefix_exact:
+                type: boolean
+              prefix_redirect:
+                description: Prefix rewrite to use when generating an HTTP redirect.
+                  Used with `host_redirect`.
+                type: string
+              prefix_regex:
+                type: boolean
+              priority:
+                type: string
+              query_parameters:
+                additionalProperties:
+                  type: string
+                type: object
+              redirect_response_code:
+                description: The response code to use when generating an HTTP redirect.
+                  Defaults to 301. Used with `host_redirect`.
+                enum:
+                - 301
+                - 302
+                - 303
+                - 307
+                - 308
+                type: integer
+              regex_headers:
+                additionalProperties:
+                  type: string
+                type: object
+              regex_query_parameters:
+                additionalProperties:
+                  type: string
+                type: object
+              regex_redirect:
+                description: Prefix regex rewrite to use when generating an HTTP redirect.
+                  Used with `host_redirect`.
+                properties:
+                  pattern:
+                    type: string
+                  substitution:
+                    type: string
+                type: object
+              regex_rewrite:
+                properties:
+                  pattern:
+                    type: string
+                  substitution:
+                    type: string
+                type: object
+              remove_request_headers:
+                items:
+                  type: string
+                type: array
+              remove_response_headers:
+                items:
+                  type: string
+                type: array
+              resolver:
+                type: string
+              respect_dns_ttl:
+                type: boolean
+              retry_policy:
+                properties:
+                  num_retries:
+                    type: integer
+                  per_try_timeout:
+                    type: string
+                  retry_on:
+                    enum:
+                    - 5xx
+                    - gateway-error
+                    - connect-failure
+                    - retriable-4xx
+                    - refused-stream
+                    - retriable-status-codes
+                    type: string
+                type: object
+              rewrite:
+                type: string
+              service:
+                type: string
+              shadow:
+                type: boolean
+              stats_name:
+                type: string
+              timeout_ms:
+                description: The timeout for requests that use this Mapping. Overrides
+                  `cluster_request_timeout_ms` set on the Ambassador Module, if it
+                  exists.
+                type: integer
+              tls:
+                type: string
+              use_websocket:
+                description: "use_websocket is deprecated, and is equivlaent to setting
+                  `allow_upgrade: [\"websocket\"]` \n TODO(lukeshu): In v3alpha2,
+                  get rid of MappingSpec.DeprecatedUseWebsocket."
+                type: boolean
+              v2BoolHeaders:
+                items:
+                  type: string
+                type: array
+              v2BoolQueryParameters:
+                items:
+                  type: string
+                type: array
+              v2ExplicitTLS:
+                description: V2ExplicitTLS controls some vanity/stylistic elements
+                  when converting from v3alpha1 to v2.  The values in an V2ExplicitTLS
+                  should not in any way affect the runtime operation of Emissary;
+                  except that it may affect internal names in the Envoy config, which
+                  may in turn affect stats names.  But it should not affect any end-user
+                  observable behavior.
+                properties:
+                  serviceScheme:
+                    description: "ServiceScheme specifies how to spell and capitalize
+                      the scheme-part of the service URL. \n Acceptable values are
+                      \"http://\" (case-insensitive), \"https://\" (case-insensitive),
+                      or \"\".  The value is used if it agrees with whether or not
+                      this resource enables TLS origination, or if something else
+                      in the resource overrides the scheme."
+                    pattern: ^([hH][tT][tT][pP][sS]?://)?$
+                    type: string
+                  tls:
+                    description: "TLS controls whether and how to represent the \"tls\"
+                      field when its value could be implied by the \"service\" field.
+                      \ In v2, there were a lot of different ways to spell an \"empty\"
+                      value, and this field specifies which way to spell it (and will
+                      therefore only be used if the value will indeed be empty). \n
+                      \ | Value        | Representation                        | Meaning
+                      of representation          |  |--------------+---------------------------------------+------------------------------------|
+                      \ | \"\"           | omit the field                        |
+                      defer to service (no TLSContext)   |  | \"null\"       | store
+                      an explicit \"null\" in the field | defer to service (no TLSContext)
+                      \  |  | \"string\"     | store an empty string in the field
+                      \   | defer to service (no TLSContext)   |  | \"bool:false\"
+                      | store a Boolean \"false\" in the field  | defer to service
+                      (no TLSContext)   |  | \"bool:true\"  | store a Boolean \"true\"
+                      in the field   | originate TLS (no TLSContext)      | \n If
+                      the meaning of the representation contradicts anything else
+                      (if a TLSContext is to be used, or in the case of \"bool:true\"
+                      if TLS is not to be originated), then this field is ignored."
+                    enum:
+                    - ""
+                    - "null"
+                    - bool:true
+                    - bool:false
+                    - string
+                    type: string
+                type: object
+              weight:
+                type: integer
+            required:
+            - prefix
+            - service
+            type: object
+          status:
+            description: MappingStatus defines the observed state of Mapping
+            properties:
+              reason:
+                type: string
+              state:
+                enum:
+                - ""
+                - Inactive
+                - Running
+                type: string
+            type: object
+        type: object
+    served: true
+    storage: false
+    subresources:
+      status: {}
+  - name: v1
+    schema:
+      openAPIV3Schema:
+        description: Mapping is the Schema for the mappings API
+        type: object
+        x-kubernetes-preserve-unknown-fields: true
+    served: false
+    storage: false
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    controller-gen.kubebuilder.io/version: 3.0.0-cbf68a7dd53dda13c681af3e19660a5605050839
+  labels:
+    app.kubernetes.io/instance: emissary-apiext
+    app.kubernetes.io/managed-by: kubectl_apply_-f_emissary-apiext.yaml
+    app.kubernetes.io/name: emissary-apiext
+    app.kubernetes.io/part-of: emissary-apiext
+  name: modules.getambassador.io
+spec:
+  conversion:
+    strategy: Webhook
+    webhook:
+      clientConfig:
+        service:
+          name: emissary-apiext
+          namespace: emissary-system
+      conversionReviewVersions:
+      - v1beta1
+  group: getambassador.io
+  names:
+    categories:
+    - ambassador-crds
+    kind: Module
+    listKind: ModuleList
+    plural: modules
+    singular: module
+  preserveUnknownFields: false
+  scope: Namespaced
+  versions:
+  - name: v2
+    schema:
+      openAPIV3Schema:
+        description: "A Module defines system-wide configuration.  The type of module
+          is controlled by the .metadata.name; valid names are \"ambassador\" or \"tls\".
+          \n https://www.getambassador.io/docs/edge-stack/latest/topics/running/ambassador/#the-ambassador-module
+          https://www.getambassador.io/docs/edge-stack/latest/topics/running/tls/#tls-module-deprecated"
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            properties:
+              config:
+                description: UntypedDict is relatively opaque as a Go type, but it
+                  preserves its contents in a roundtrippable way.
+                type: object
+                x-kubernetes-preserve-unknown-fields: true
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+  - name: v3alpha1
+    schema:
+      openAPIV3Schema:
+        description: "A Module defines system-wide configuration.  The type of module
+          is controlled by the .metadata.name; valid names are \"ambassador\" or \"tls\".
+          \n https://www.getambassador.io/docs/edge-stack/latest/topics/running/ambassador/#the-ambassador-module
+          https://www.getambassador.io/docs/edge-stack/latest/topics/running/tls/#tls-module-deprecated"
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: 'TODO(lukeshu): In v3alpha2, get rid of unnecessary nesting
+              and move `ModuleSpec.config.*` to `ModuleSpec.*`.'
+            properties:
+              ambassador_id:
+                description: "AmbassadorID declares which Ambassador instances should
+                  pay attention to this resource. If no value is provided, the default
+                  is: \n    ambassador_id:    - \"default\" \n TODO(lukeshu): In v3alpha2,
+                  consider renaming all of the `ambassador_id` (singular) fields to
+                  `ambassador_ids` (plural)."
+                items:
+                  type: string
+                type: array
+              config:
+                description: "TODO(lukeshu): In v3alpha2, change the default from
+                  `diagnostics.enabled=true` to `diagnostics.enabled=false`.  This
+                  needs conversion support in apiext.  See the related comment in
+                  irambassador.py. \n TODO(lukeshu): Structurally type ModuleSpec.Config."
+                type: object
+                x-kubernetes-preserve-unknown-fields: true
+            required:
+            - config
+            type: object
+        type: object
+    served: true
+    storage: false
+  - name: v1
+    schema:
+      openAPIV3Schema:
+        description: A Module defines system-wide configuration.  The type of module
+          is controlled by the .metadata.name; valid names are "ambassador" or "tls".
+        type: object
+        x-kubernetes-preserve-unknown-fields: true
+    served: false
+    storage: false
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    controller-gen.kubebuilder.io/version: 3.0.0-cbf68a7dd53dda13c681af3e19660a5605050839
+  labels:
+    app.kubernetes.io/instance: emissary-apiext
+    app.kubernetes.io/managed-by: kubectl_apply_-f_emissary-apiext.yaml
+    app.kubernetes.io/name: emissary-apiext
+    app.kubernetes.io/part-of: emissary-apiext
+  name: ratelimitservices.getambassador.io
+spec:
+  conversion:
+    strategy: Webhook
+    webhook:
+      clientConfig:
+        service:
+          name: emissary-apiext
+          namespace: emissary-system
+      conversionReviewVersions:
+      - v1beta1
+  group: getambassador.io
+  names:
+    categories:
+    - ambassador-crds
+    kind: RateLimitService
+    listKind: RateLimitServiceList
+    plural: ratelimitservices
+    singular: ratelimitservice
+  preserveUnknownFields: false
+  scope: Namespaced
+  versions:
+  - name: v2
+    schema:
+      openAPIV3Schema:
+        description: RateLimitService is the Schema for the ratelimitservices API
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: RateLimitServiceSpec defines the desired state of RateLimitService
+            properties:
+              domain:
+                type: string
+              protocol_version:
+                enum:
+                - v2
+                - v3
+                type: string
+              service:
+                type: string
+              timeout_ms:
+                type: integer
+              v3StatsName:
+                type: string
+            required:
+            - service
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+  - name: v3alpha1
+    schema:
+      openAPIV3Schema:
+        description: RateLimitService is the Schema for the ratelimitservices API
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: RateLimitServiceSpec defines the desired state of RateLimitService
+            properties:
+              ambassador_id:
+                description: Common to all Ambassador objects.
+                items:
+                  type: string
+                type: array
+              domain:
+                type: string
+              protocol_version:
+                description: ProtocolVersion is the envoy api transport protocol version
+                enum:
+                - v2
+                - v3
+                type: string
+              service:
+                type: string
+              stats_name:
+                type: string
+              timeout_ms:
+                description: 'TODO(lukeshu): In v3alpha2, change all of the `{foo}_ms`/`MillisecondDuration`
+                  fields to `{foo}`/`metav1.Duration`.'
+                type: integer
+              tls:
+                type: string
+              v2ExplicitTLS:
+                description: V2ExplicitTLS controls some vanity/stylistic elements
+                  when converting from v3alpha1 to v2.  The values in an V2ExplicitTLS
+                  should not in any way affect the runtime operation of Emissary;
+                  except that it may affect internal names in the Envoy config, which
+                  may in turn affect stats names.  But it should not affect any end-user
+                  observable behavior.
+                properties:
+                  serviceScheme:
+                    description: "ServiceScheme specifies how to spell and capitalize
+                      the scheme-part of the service URL. \n Acceptable values are
+                      \"http://\" (case-insensitive), \"https://\" (case-insensitive),
+                      or \"\".  The value is used if it agrees with whether or not
+                      this resource enables TLS origination, or if something else
+                      in the resource overrides the scheme."
+                    pattern: ^([hH][tT][tT][pP][sS]?://)?$
+                    type: string
+                  tls:
+                    description: "TLS controls whether and how to represent the \"tls\"
+                      field when its value could be implied by the \"service\" field.
+                      \ In v2, there were a lot of different ways to spell an \"empty\"
+                      value, and this field specifies which way to spell it (and will
+                      therefore only be used if the value will indeed be empty). \n
+                      \ | Value        | Representation                        | Meaning
+                      of representation          |  |--------------+---------------------------------------+------------------------------------|
+                      \ | \"\"           | omit the field                        |
+                      defer to service (no TLSContext)   |  | \"null\"       | store
+                      an explicit \"null\" in the field | defer to service (no TLSContext)
+                      \  |  | \"string\"     | store an empty string in the field
+                      \   | defer to service (no TLSContext)   |  | \"bool:false\"
+                      | store a Boolean \"false\" in the field  | defer to service
+                      (no TLSContext)   |  | \"bool:true\"  | store a Boolean \"true\"
+                      in the field   | originate TLS (no TLSContext)      | \n If
+                      the meaning of the representation contradicts anything else
+                      (if a TLSContext is to be used, or in the case of \"bool:true\"
+                      if TLS is not to be originated), then this field is ignored."
+                    enum:
+                    - ""
+                    - "null"
+                    - bool:true
+                    - bool:false
+                    - string
+                    type: string
+                type: object
+            required:
+            - service
+            type: object
+        type: object
+    served: true
+    storage: false
+  - name: v1
+    schema:
+      openAPIV3Schema:
+        description: RateLimitService is the Schema for the ratelimitservices API
+        type: object
+        x-kubernetes-preserve-unknown-fields: true
+    served: false
+    storage: false
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    controller-gen.kubebuilder.io/version: 3.0.0-cbf68a7dd53dda13c681af3e19660a5605050839
+  labels:
+    app.kubernetes.io/instance: emissary-apiext
+    app.kubernetes.io/managed-by: kubectl_apply_-f_emissary-apiext.yaml
+    app.kubernetes.io/name: emissary-apiext
+    app.kubernetes.io/part-of: emissary-apiext
+  name: tcpmappings.getambassador.io
+spec:
+  conversion:
+    strategy: Webhook
+    webhook:
+      clientConfig:
+        service:
+          name: emissary-apiext
+          namespace: emissary-system
+      conversionReviewVersions:
+      - v1beta1
+  group: getambassador.io
+  names:
+    categories:
+    - ambassador-crds
+    kind: TCPMapping
+    listKind: TCPMappingList
+    plural: tcpmappings
+    singular: tcpmapping
+  preserveUnknownFields: false
+  scope: Namespaced
+  versions:
+  - name: v2
+    schema:
+      openAPIV3Schema:
+        description: TCPMapping is the Schema for the tcpmappings API
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: TCPMappingSpec defines the desired state of TCPMapping
+            properties:
+              address:
+                type: string
+              circuit_breakers:
+                items:
+                  properties:
+                    max_connections:
+                      type: integer
+                    max_pending_requests:
+                      type: integer
+                    max_requests:
+                      type: integer
+                    max_retries:
+                      type: integer
+                    priority:
+                      enum:
+                      - default
+                      - high
+                      type: string
+                  type: object
+                type: array
+              cluster_tag:
+                type: string
+              enable_ipv4:
+                type: boolean
+              enable_ipv6:
+                type: boolean
+              host:
+                type: string
+              idle_timeout_ms:
+                description: 'FIXME(lukeshu): Surely this should be an ''int''?'
+                type: string
+              port:
+                description: Port isn't a pointer because it's required.
+                type: integer
+              resolver:
+                type: string
+              service:
+                type: string
+              v3StatsName:
+                type: string
+              weight:
+                type: integer
+            required:
+            - port
+            - service
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+  - name: v3alpha1
+    schema:
+      openAPIV3Schema:
+        description: TCPMapping is the Schema for the tcpmappings API
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: TCPMappingSpec defines the desired state of TCPMapping
+            properties:
+              address:
+                type: string
+              ambassador_id:
+                description: "AmbassadorID declares which Ambassador instances should
+                  pay attention to this resource. If no value is provided, the default
+                  is: \n    ambassador_id:    - \"default\" \n TODO(lukeshu): In v3alpha2,
+                  consider renaming all of the `ambassador_id` (singular) fields to
+                  `ambassador_ids` (plural)."
+                items:
+                  type: string
+                type: array
+              circuit_breakers:
+                items:
+                  properties:
+                    max_connections:
+                      type: integer
+                    max_pending_requests:
+                      type: integer
+                    max_requests:
+                      type: integer
+                    max_retries:
+                      type: integer
+                    priority:
+                      enum:
+                      - default
+                      - high
+                      type: string
+                  type: object
+                type: array
+              cluster_tag:
+                type: string
+              enable_ipv4:
+                type: boolean
+              enable_ipv6:
+                type: boolean
+              host:
+                type: string
+              idle_timeout_ms:
+                description: 'FIXME(lukeshu): Surely this should be an ''int''?'
+                type: string
+              port:
+                description: Port isn't a pointer because it's required.
+                type: integer
+              resolver:
+                type: string
+              service:
+                type: string
+              stats_name:
+                type: string
+              tls:
+                type: string
+              v2ExplicitTLS:
+                description: V2ExplicitTLS controls some vanity/stylistic elements
+                  when converting from v3alpha1 to v2.  The values in an V2ExplicitTLS
+                  should not in any way affect the runtime operation of Emissary;
+                  except that it may affect internal names in the Envoy config, which
+                  may in turn affect stats names.  But it should not affect any end-user
+                  observable behavior.
+                properties:
+                  serviceScheme:
+                    description: "ServiceScheme specifies how to spell and capitalize
+                      the scheme-part of the service URL. \n Acceptable values are
+                      \"http://\" (case-insensitive), \"https://\" (case-insensitive),
+                      or \"\".  The value is used if it agrees with whether or not
+                      this resource enables TLS origination, or if something else
+                      in the resource overrides the scheme."
+                    pattern: ^([hH][tT][tT][pP][sS]?://)?$
+                    type: string
+                  tls:
+                    description: "TLS controls whether and how to represent the \"tls\"
+                      field when its value could be implied by the \"service\" field.
+                      \ In v2, there were a lot of different ways to spell an \"empty\"
+                      value, and this field specifies which way to spell it (and will
+                      therefore only be used if the value will indeed be empty). \n
+                      \ | Value        | Representation                        | Meaning
+                      of representation          |  |--------------+---------------------------------------+------------------------------------|
+                      \ | \"\"           | omit the field                        |
+                      defer to service (no TLSContext)   |  | \"null\"       | store
+                      an explicit \"null\" in the field | defer to service (no TLSContext)
+                      \  |  | \"string\"     | store an empty string in the field
+                      \   | defer to service (no TLSContext)   |  | \"bool:false\"
+                      | store a Boolean \"false\" in the field  | defer to service
+                      (no TLSContext)   |  | \"bool:true\"  | store a Boolean \"true\"
+                      in the field   | originate TLS (no TLSContext)      | \n If
+                      the meaning of the representation contradicts anything else
+                      (if a TLSContext is to be used, or in the case of \"bool:true\"
+                      if TLS is not to be originated), then this field is ignored."
+                    enum:
+                    - ""
+                    - "null"
+                    - bool:true
+                    - bool:false
+                    - string
+                    type: string
+                type: object
+              weight:
+                type: integer
+            required:
+            - port
+            - service
+            type: object
+        type: object
+    served: true
+    storage: false
+  - name: v1
+    schema:
+      openAPIV3Schema:
+        description: TCPMapping is the Schema for the tcpmappings API
+        type: object
+        x-kubernetes-preserve-unknown-fields: true
+    served: false
+    storage: false
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    controller-gen.kubebuilder.io/version: 3.0.0-cbf68a7dd53dda13c681af3e19660a5605050839
+  labels:
+    app.kubernetes.io/instance: emissary-apiext
+    app.kubernetes.io/managed-by: kubectl_apply_-f_emissary-apiext.yaml
+    app.kubernetes.io/name: emissary-apiext
+    app.kubernetes.io/part-of: emissary-apiext
+  name: tlscontexts.getambassador.io
+spec:
+  conversion:
+    strategy: Webhook
+    webhook:
+      clientConfig:
+        service:
+          name: emissary-apiext
+          namespace: emissary-system
+      conversionReviewVersions:
+      - v1beta1
+  group: getambassador.io
+  names:
+    categories:
+    - ambassador-crds
+    kind: TLSContext
+    listKind: TLSContextList
+    plural: tlscontexts
+    singular: tlscontext
+  preserveUnknownFields: false
+  scope: Namespaced
+  versions:
+  - name: v2
+    schema:
+      openAPIV3Schema:
+        description: TLSContext is the Schema for the tlscontexts API
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: TLSContextSpec defines the desired state of TLSContext
+            properties:
+              alpn_protocols:
+                type: string
+              ca_secret:
+                type: string
+              cacert_chain_file:
+                type: string
+              cert_chain_file:
+                type: string
+              cert_required:
+                type: boolean
+              cipher_suites:
+                items:
+                  type: string
+                type: array
+              ecdh_curves:
+                items:
+                  type: string
+                type: array
+              hosts:
+                items:
+                  type: string
+                type: array
+              max_tls_version:
+                enum:
+                - v1.0
+                - v1.1
+                - v1.2
+                - v1.3
+                type: string
+              min_tls_version:
+                enum:
+                - v1.0
+                - v1.1
+                - v1.2
+                - v1.3
+                type: string
+              private_key_file:
+                type: string
+              redirect_cleartext_from:
+                type: integer
+              secret:
+                type: string
+              secret_namespacing:
+                type: boolean
+              sni:
+                type: string
+              v3CRLSecret:
+                type: string
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+  - name: v3alpha1
+    schema:
+      openAPIV3Schema:
+        description: TLSContext is the Schema for the tlscontexts API
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: TLSContextSpec defines the desired state of TLSContext
+            properties:
+              alpn_protocols:
+                type: string
+              ambassador_id:
+                description: "AmbassadorID declares which Ambassador instances should
+                  pay attention to this resource. If no value is provided, the default
+                  is: \n    ambassador_id:    - \"default\" \n TODO(lukeshu): In v3alpha2,
+                  consider renaming all of the `ambassador_id` (singular) fields to
+                  `ambassador_ids` (plural)."
+                items:
+                  type: string
+                type: array
+              ca_secret:
+                type: string
+              cacert_chain_file:
+                type: string
+              cert_chain_file:
+                type: string
+              cert_required:
+                type: boolean
+              cipher_suites:
+                items:
+                  type: string
+                type: array
+              crl_secret:
+                type: string
+              ecdh_curves:
+                items:
+                  type: string
+                type: array
+              hosts:
+                items:
+                  type: string
+                type: array
+              max_tls_version:
+                enum:
+                - v1.0
+                - v1.1
+                - v1.2
+                - v1.3
+                type: string
+              min_tls_version:
+                enum:
+                - v1.0
+                - v1.1
+                - v1.2
+                - v1.3
+                type: string
+              private_key_file:
+                type: string
+              redirect_cleartext_from:
+                type: integer
+              secret:
+                type: string
+              secret_namespacing:
+                type: boolean
+              sni:
+                type: string
+            type: object
+        type: object
+    served: true
+    storage: false
+  - name: v1
+    schema:
+      openAPIV3Schema:
+        description: TLSContext is the Schema for the tlscontexts API
+        type: object
+        x-kubernetes-preserve-unknown-fields: true
+    served: false
+    storage: false
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    controller-gen.kubebuilder.io/version: 3.0.0-cbf68a7dd53dda13c681af3e19660a5605050839
+  labels:
+    app.kubernetes.io/instance: emissary-apiext
+    app.kubernetes.io/managed-by: kubectl_apply_-f_emissary-apiext.yaml
+    app.kubernetes.io/name: emissary-apiext
+    app.kubernetes.io/part-of: emissary-apiext
+  name: tracingservices.getambassador.io
+spec:
+  conversion:
+    strategy: Webhook
+    webhook:
+      clientConfig:
+        service:
+          name: emissary-apiext
+          namespace: emissary-system
+      conversionReviewVersions:
+      - v1beta1
+  group: getambassador.io
+  names:
+    categories:
+    - ambassador-crds
+    kind: TracingService
+    listKind: TracingServiceList
+    plural: tracingservices
+    singular: tracingservice
+  preserveUnknownFields: false
+  scope: Namespaced
+  versions:
+  - name: v2
+    schema:
+      openAPIV3Schema:
+        description: TracingService is the Schema for the tracingservices API
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: TracingServiceSpec defines the desired state of TracingService
+            properties:
+              config:
+                properties:
+                  access_token_file:
+                    type: string
+                  collector_cluster:
+                    type: string
+                  collector_endpoint:
+                    type: string
+                  collector_endpoint_version:
+                    enum:
+                    - HTTP_JSON_V1
+                    - HTTP_JSON
+                    - HTTP_PROTO
+                    type: string
+                  collector_hostname:
+                    type: string
+                  service_name:
+                    type: string
+                  shared_span_context:
+                    type: boolean
+                  trace_id_128bit:
+                    type: boolean
+                  v3PropagationModes:
+                    items:
+                      enum:
+                      - ENVOY
+                      - LIGHTSTEP
+                      - B3
+                      - TRACE_CONTEXT
+                      type: string
+                    type: array
+                type: object
+              driver:
+                enum:
+                - lightstep
+                - zipkin
+                - datadog
+                type: string
+              sampling:
+                properties:
+                  client:
+                    type: integer
+                  overall:
+                    type: integer
+                  random:
+                    type: integer
+                type: object
+              service:
+                type: string
+              tag_headers:
+                items:
+                  type: string
+                type: array
+              v3StatsName:
+                type: string
+            required:
+            - driver
+            - service
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+  - name: v3alpha1
+    schema:
+      openAPIV3Schema:
+        description: TracingService is the Schema for the tracingservices API
+        properties:
+          apiVersion:
+            description: 'APIVersion defines the versioned schema of this representation
+              of an object. Servers should convert recognized schemas to the latest
+              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+            type: string
+          kind:
+            description: 'Kind is a string value representing the REST resource this
+              object represents. Servers may infer this from the endpoint the client
+              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+            type: string
+          metadata:
+            type: object
+          spec:
+            description: TracingServiceSpec defines the desired state of TracingService
+            properties:
+              ambassador_id:
+                description: "AmbassadorID declares which Ambassador instances should
+                  pay attention to this resource. If no value is provided, the default
+                  is: \n    ambassador_id:    - \"default\" \n TODO(lukeshu): In v3alpha2,
+                  consider renaming all of the `ambassador_id` (singular) fields to
+                  `ambassador_ids` (plural)."
+                items:
+                  type: string
+                type: array
+              config:
+                properties:
+                  access_token_file:
+                    type: string
+                  collector_cluster:
+                    type: string
+                  collector_endpoint:
+                    type: string
+                  collector_endpoint_version:
+                    enum:
+                    - HTTP_JSON_V1
+                    - HTTP_JSON
+                    - HTTP_PROTO
+                    type: string
+                  collector_hostname:
+                    type: string
+                  propagation_modes:
+                    items:
+                      enum:
+                      - ENVOY
+                      - LIGHTSTEP
+                      - B3
+                      - TRACE_CONTEXT
+                      type: string
+                    type: array
+                  service_name:
+                    type: string
+                  shared_span_context:
+                    type: boolean
+                  trace_id_128bit:
+                    type: boolean
+                type: object
+              driver:
+                enum:
+                - lightstep
+                - zipkin
+                - datadog
+                type: string
+              sampling:
+                properties:
+                  client:
+                    type: integer
+                  overall:
+                    type: integer
+                  random:
+                    type: integer
+                type: object
+              service:
+                type: string
+              stats_name:
+                type: string
+              tag_headers:
+                items:
+                  type: string
+                type: array
+            required:
+            - driver
+            - service
+            type: object
+        type: object
+    served: true
+    storage: false
+  - name: v1
+    schema:
+      openAPIV3Schema:
+        description: TracingService is the Schema for the tracingservices API
+        type: object
+        x-kubernetes-preserve-unknown-fields: true
+    served: false
+    storage: false
+---
+################################################################################
+# Namespace                                                                    #
+################################################################################
+---
+apiVersion: v1
+kind: Namespace
+metadata:
+  name: emissary-system
+---
+################################################################################
+# ServiceAccount                                                               #
+################################################################################
+---
+apiVersion: v1
+kind: ServiceAccount
+metadata:
+  name: emissary-apiext
+  namespace: emissary-system
+  labels:
+    app.kubernetes.io/instance: emissary-apiext
+    app.kubernetes.io/managed-by: kubectl_apply_-f_emissary-apiext.yaml
+    app.kubernetes.io/name: emissary-apiext
+    app.kubernetes.io/part-of: emissary-apiext
+---
+################################################################################
+# Cluster permissions                                                          #
+################################################################################
+---
+apiVersion: rbac.authorization.k8s.io/v1
+kind: ClusterRole
+metadata:
+  name: emissary-apiext
+  labels:
+    app.kubernetes.io/instance: emissary-apiext
+    app.kubernetes.io/managed-by: kubectl_apply_-f_emissary-apiext.yaml
+    app.kubernetes.io/name: emissary-apiext
+    app.kubernetes.io/part-of: emissary-apiext
+rules:
+  - apiGroups: [ "apiextensions.k8s.io" ]
+    resources: [ "customresourcedefinitions" ]
+    verbs: [ "list", "watch" ]
+  - apiGroups: [ "apiextensions.k8s.io" ]
+    resources: [ "customresourcedefinitions" ]
+    resourceNames:
+      - authservices.getambassador.io
+      - consulresolvers.getambassador.io
+      - devportals.getambassador.io
+      - hosts.getambassador.io
+      - kubernetesendpointresolvers.getambassador.io
+      - kubernetesserviceresolvers.getambassador.io
+      - listeners.getambassador.io
+      - logservices.getambassador.io
+      - mappings.getambassador.io
+      - modules.getambassador.io
+      - ratelimitservices.getambassador.io
+      - tcpmappings.getambassador.io
+      - tlscontexts.getambassador.io
+      - tracingservices.getambassador.io
+    verbs: [ "update" ]
+---
+apiVersion: rbac.authorization.k8s.io/v1
+kind: ClusterRoleBinding
+metadata:
+  name: emissary-apiext
+  labels:
+    app.kubernetes.io/instance: emissary-apiext
+    app.kubernetes.io/managed-by: kubectl_apply_-f_emissary-apiext.yaml
+    app.kubernetes.io/name: emissary-apiext
+    app.kubernetes.io/part-of: emissary-apiext
+roleRef:
+  apiGroup: rbac.authorization.k8s.io
+  kind: ClusterRole
+  name: emissary-apiext
+subjects:
+  - kind: ServiceAccount
+    namespace: emissary-system
+    name: emissary-apiext
+---
+################################################################################
+# Namespaced permissions                                                       #
+################################################################################
+---
+apiVersion: rbac.authorization.k8s.io/v1
+kind: Role
+metadata:
+  name: emissary-apiext
+  namespace: emissary-system
+  labels:
+    app.kubernetes.io/instance: emissary-apiext
+    app.kubernetes.io/managed-by: kubectl_apply_-f_emissary-apiext.yaml
+    app.kubernetes.io/name: emissary-apiext
+    app.kubernetes.io/part-of: emissary-apiext
+rules:
+  - apiGroups: [""]
+    resources: ["secrets"]
+    verbs: ["create"]
+  - apiGroups: [""]
+    resources: ["secrets"]
+    resourceNames: ["emissary-ingress-webhook-ca"]
+    verbs: ["get", "update"]
+---
+apiVersion: rbac.authorization.k8s.io/v1
+kind: RoleBinding
+metadata:
+  name: emissary-apiext
+  namespace: emissary-system
+  labels:
+    app.kubernetes.io/instance: emissary-apiext
+    app.kubernetes.io/managed-by: kubectl_apply_-f_emissary-apiext.yaml
+    app.kubernetes.io/name: emissary-apiext
+    app.kubernetes.io/part-of: emissary-apiext
+roleRef:
+  apiGroup: rbac.authorization.k8s.io
+  kind: Role
+  name: emissary-apiext
+subjects:
+- kind: ServiceAccount
+  namespace: emissary-system
+  name: emissary-apiext
+---
+################################################################################
+# Main                                                                         #
+################################################################################
\ No newline at end of file
diff --git a/charts/emissary-ingress/readme.tpl b/charts/emissary-ingress/readme.tpl
index cf5e60609..cc8b0abef 100644
--- a/charts/emissary-ingress/readme.tpl
+++ b/charts/emissary-ingress/readme.tpl
@@ -7,7 +7,7 @@
 ```console
 $ helm repo add {{ .Repository.Name }} {{ .Repository.URL }}
 $ helm repo update
-$ helm install {{ .Release.Name }} --devel {{ .Repository.Name }}/{{ .Chart.Name }} -n {{ .Release.Namespace }}{{ with .Chart.Version }} --version={{.}}{{ end }}
+$ helm install {{ .Release.Name }} --devel {{ .Repository.Name }}/{{ .Chart.Name }} -n {{ .Release.Namespace | default .Values.defaultNamespace | quote| default .Values.defaultNamespace | quote| default .Values.defaultNamespace | quote}}{{ with .Chart.Version }} --version={{.}}{{ end }}
 ```
 
 ## Introduction
@@ -44,7 +44,7 @@ Ingress and Ambassador Edge Stack.
 To install the chart with the release name `{{ .Release.Name }}`:
 
 ```console
-$ helm install {{ .Release.Name }} --devel {{ .Repository.Name }}/{{ .Chart.Name }} -n {{ .Release.Namespace }}{{ with .Chart.Version }} --version={{.}}{{ end }}
+$ helm install {{ .Release.Name }} --devel {{ .Repository.Name }}/{{ .Chart.Name }} -n {{ .Release.Namespace | default .Values.defaultNamespace | quote}}{{ with .Chart.Version }} --version={{.}}{{ end }}
 ```
 
 The command deploys {{ .Project.App }} on the Kubernetes cluster in the default configuration. The [configuration](#configuration) section lists the parameters that can be configured during installation.
@@ -56,7 +56,7 @@ The command deploys {{ .Project.App }} on the Kubernetes cluster in the default
 To uninstall/delete the `{{ .Release.Name }}`:
 
 ```console
-$ helm delete {{ .Release.Name }} -n {{ .Release.Namespace }}
+$ helm delete {{ .Release.Name }} -n {{ .Release.Namespace | default .Values.defaultNamespace | quote}}
 ```
 
 The command removes all the Kubernetes components associated with the chart and deletes the release.
@@ -75,13 +75,13 @@ The following table lists the configurable parameters of the `{{ .Chart.Name }}`
 Specify each parameter using the `--set key=value[,key=value]` argument to `helm install`. For example:
 
 ```console
-$ helm install {{ .Release.Name }} --devel {{ .Repository.Name }}/{{ .Chart.Name }} -n {{ .Release.Namespace }}{{ with .Chart.Version }} --version={{.}}{{ end }} --set {{ .Chart.ValuesExample }}
+$ helm install {{ .Release.Name }} --devel {{ .Repository.Name }}/{{ .Chart.Name }} -n {{ .Release.Namespace | default .Values.defaultNamespace | quote}}{{ with .Chart.Version }} --version={{.}}{{ end }} --set {{ .Chart.ValuesExample }}
 ```
 
 Alternatively, a YAML file that specifies the values for the parameters can be provided while
 installing the chart. For example:
 
 ```console
-$ helm install {{ .Release.Name }} --devel {{ .Repository.Name }}/{{ .Chart.Name }} -n {{ .Release.Namespace }}{{ with .Chart.Version }} --version={{.}}{{ end }} --values values.yaml
+$ helm install {{ .Release.Name }} --devel {{ .Repository.Name }}/{{ .Chart.Name }} -n {{ .Release.Namespace | default .Values.defaultNamespace | quote}}{{ with .Chart.Version }} --version={{.}}{{ end }} --values values.yaml
 ```
 {{- end }}
diff --git a/charts/emissary-ingress/templates/NOTES.txt b/charts/emissary-ingress/templates/NOTES.txt
index dbcfc7c93..b8ecadd70 100644
--- a/charts/emissary-ingress/templates/NOTES.txt
+++ b/charts/emissary-ingress/templates/NOTES.txt
@@ -5,22 +5,16 @@
 To get the IP address of Emissary, run the following commands:
 
 {{- if contains "NodePort" .Values.service.type }}
-  export NODE_PORT=$(kubectl get --namespace {{ include "ambassador.namespace" .}} -o jsonpath="{.spec.ports[0].nodePort}" services {{ include "ambassador.fullname" . }})
-  export NODE_IP=$(kubectl get nodes --namespace {{ include "ambassador.namespace" .}} -o jsonpath="{.items[0].status.addresses[0].address}")
+  export NODE_PORT=$(kubectl get --namespace {{ .Release.Namespace | default .Values.defaultNamespace | quote }} -o jsonpath="{.spec.ports[0].nodePort}" services {{ include "ambassador.fullname" . }})
+  export NODE_IP=$(kubectl get nodes --namespace {{ .Release.Namespace | default .Values.defaultNamespace | quote }} -o jsonpath="{.items[0].status.addresses[0].address}")
   echo http://$NODE_IP:$NODE_PORT
 {{- else if contains "LoadBalancer" .Values.service.type }}
 NOTE: It may take a few minutes for the LoadBalancer IP to be available.
-     You can watch the status of by running 'kubectl get svc -w  --namespace {{ include "ambassador.namespace" .}} {{ include "ambassador.fullname" . }}'
-
-  On GKE/Azure:
-  export SERVICE_IP=$(kubectl get svc --namespace {{ include "ambassador.namespace" .}} {{ include "ambassador.fullname" . }} -o jsonpath='{.status.loadBalancer.ingress[0].ip}')
-
-  On AWS:
-  export SERVICE_IP=$(kubectl get svc --namespace {{ include "ambassador.namespace" .}} {{ include "ambassador.fullname" . }} -o jsonpath='{.status.loadBalancer.ingress[0].hostname}')
+     You can watch the status of by running 'kubectl get svc -w  --namespace {{ .Release.Namespace | default .Values.defaultNamespace | quote }} {{ include "ambassador.fullname" . }}'
 
   echo http://$SERVICE_IP:{{ .Values.service.port }}
 {{- else if contains "ClusterIP" .Values.service.type }}
-  export POD_NAME=$(kubectl get pods --namespace {{ include "ambassador.namespace" .}} -l "app={{ include "ambassador.name" . }},release={{ .Release.Name }}" -o jsonpath="{.items[0].metadata.name}")
+  export POD_NAME=$(kubectl get pods --namespace {{ .Release.Namespace | default .Values.defaultNamespace | quote }} -l "app={{ include "ambassador.name" . }},release={{ .Release.Name }}" -o jsonpath="{.items[0].metadata.name}")
   echo "Visit http://127.0.0.1:8080 to use your application"
   kubectl port-forward $POD_NAME 8080:80
 {{- end }}
diff --git a/charts/emissary-ingress/templates/_helpers.tpl b/charts/emissary-ingress/templates/_helpers.tpl
index 35bb75791..a017c4ce1 100644
--- a/charts/emissary-ingress/templates/_helpers.tpl
+++ b/charts/emissary-ingress/templates/_helpers.tpl
@@ -78,18 +78,6 @@ disabled if fullImageOverride is present
 {{- end -}}
 {{- end -}}
 
-
-{{/*
-Create chart namespace based on override value.
-*/}}
-{{- define "ambassador.namespace" -}}
-{{- if .Values.namespaceOverride -}}
-{{- .Values.namespaceOverride -}}
-{{- else -}}
-{{- .Release.Namespace -}}
-{{- end -}}
-{{- end -}}
-
 {{/*
 Create chart name and version as used by the chart label.
 */}}
@@ -125,3 +113,9 @@ Define the http port of the Ambassador service
 {{- end -}}
 {{- end -}}
 {{- end -}}
+
+
+{{/* Generate image repository path. */}}
+{{- define "image.repository.path" -}}
+{{- .repository }}@{{ .digest -}}
+{{- end -}}
diff --git a/charts/emissary-ingress/templates/admin-service.yaml b/charts/emissary-ingress/templates/admin-service.yaml
index 77f628459..a1c48b7ac 100644
--- a/charts/emissary-ingress/templates/admin-service.yaml
+++ b/charts/emissary-ingress/templates/admin-service.yaml
@@ -3,7 +3,7 @@ apiVersion: v1
 kind: Service
 metadata:
   name: {{ include "ambassador.fullname" . }}-admin
-  namespace: {{ include "ambassador.namespace" . }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
     app.kubernetes.io/name: {{ include "ambassador.name" . }}
     {{- include "ambassador.labels" . | nindent 4 }}
@@ -45,7 +45,7 @@ spec:
     {{- end }}
   {{- if eq .Values.adminService.type "LoadBalancer" }}
   {{- if not (empty .Values.adminService.loadBalancerIP) }}
-  loadBalancerIP: {{ .Values.adminService.loadBalancerIP | quote }}
+  loadBalancerIP: {{ .Values.adminService.loadBalancerIP | .Release.Namespace | default .Values.defaultNamespace | quote }}
   {{- end }}
   {{- if not (empty .Values.adminService.loadBalancerSourceRanges) }}
   loadBalancerSourceRanges:
diff --git a/charts/emissary-ingress/templates/ambassador-agent.yaml b/charts/emissary-ingress/templates/ambassador-agent.yaml
deleted file mode 100644
index d94f4b6cb..000000000
--- a/charts/emissary-ingress/templates/ambassador-agent.yaml
+++ /dev/null
@@ -1,277 +0,0 @@
-{{- if .Values.agent.enabled }}
-{{- $allowAgent := false -}}
-
-  {{- /* This next bit is ugly. */ -}}
-  {{- /* Case 1: "fullImageOverride" means don't bother checking the tag. */ -}}
-  {{- /* Case 2: Otherwise, if it's not a semver-style version number,    */ -}}
-  {{- /*         assume we have a power user and turn the agent on.       */ -}}
-  {{- /* Case 3: Otherwise, it's OSS and we need at least 1.13.0.         */ -}}
-
-{{- if .Values.image.fullImageOverride }}
-  {{- /* Case 1 */ -}}
-  {{- $allowAgent = true }}
-{{- else if not (regexMatch "^\\d+\\.\\d+\\.\\d+$" .Values.image.tag ) }}
-  {{- /* Case 2 above: power user */ -}}
-  {{- $allowAgent = true }}
-{{- else if ne (semver "1.13.0" | (semver .Values.image.tag).Compare) -1 }}
-  {{- /* Case 3 above: OSS 1.13.0+ */ -}}
-  {{- $allowAgent = true }}
-{{- end }}
-
-{{- if $allowAgent }}
----
-apiVersion: v1
-kind: ServiceAccount
-metadata:
-  name: {{ include "ambassador.fullname" . }}-agent
-  namespace: {{ include "ambassador.namespace" . }}
-  labels:
-    app.kubernetes.io/name: {{ include "ambassador.name" . }}-agent
-    {{- include "ambassador.labels" . | nindent 4 }}
-    product: aes
-{{- if .Values.docker.useImagePullSecret }}
-imagePullSecrets:
-- name: {{ .Values.docker.imagePullSecretName }}
-{{- end }}
----
-apiVersion: rbac.authorization.k8s.io/v1
-kind: RoleBinding
-metadata:
-  name: {{ include "ambassador.fullname" . }}-agent-config
-  namespace: {{ include "ambassador.namespace" . }}
-  labels:
-    app.kubernetes.io/name: {{ include "ambassador.name" . }}-agent
-    {{- include "ambassador.labels" . | nindent 4 }}
-    product: aes
-roleRef:
-  apiGroup: rbac.authorization.k8s.io
-  kind: Role
-  name: {{ include "ambassador.fullname" . }}-agent-config
-subjects:
-- kind: ServiceAccount
-  name: {{ include "ambassador.fullname" . }}-agent
-  namespace: {{ include "ambassador.namespace" . }}
----
-apiVersion: rbac.authorization.k8s.io/v1
-kind: Role
-metadata:
-  name: {{ include "ambassador.fullname" . }}-agent-config
-  namespace: {{ include "ambassador.namespace" . }}
-  labels:
-    app.kubernetes.io/name: {{ include "ambassador.name" . }}-agent
-    {{- include "ambassador.labels" . | nindent 4 }}
-    product: aes
-rules:
-- apiGroups: [""]
-  resources: [ "configmaps" ]
-  verbs: [ "get", "list", "watch" ]
----
-apiVersion: rbac.authorization.k8s.io/v1
-kind: ClusterRoleBinding
-metadata:
-  name: {{ include "ambassador.fullname" . }}-agent
-  labels:
-    app.kubernetes.io/name: {{ include "ambassador.name" . }}-agent
-    {{- include "ambassador.labels" . | nindent 4 }}
-    product: aes
-roleRef:
-  apiGroup: rbac.authorization.k8s.io
-  kind: ClusterRole
-  name: {{ include "ambassador.fullname" . }}-agent
-subjects:
-- kind: ServiceAccount
-  name: {{ include "ambassador.fullname" . }}-agent
-  namespace: {{ include "ambassador.namespace" . }}
----
-apiVersion: rbac.authorization.k8s.io/v1
-kind: ClusterRole
-metadata:
-  name: {{ include "ambassador.fullname" . }}-agent
-  labels:
-    app.kubernetes.io/name: {{ include "ambassador.name" . }}-agent
-    {{- include "ambassador.labels" . | nindent 4 }}
-    product: aes
-aggregationRule:
-  clusterRoleSelectors:
-  - matchLabels:
-      rbac.getambassador.io/role-group: {{ include "ambassador.rbacName" . }}-agent
-rules: []
----
-apiVersion: rbac.authorization.k8s.io/v1
-kind: ClusterRole
-metadata:
-  name: {{ include "ambassador.fullname" . }}-agent-pods
-  labels:
-    rbac.getambassador.io/role-group: {{ include "ambassador.rbacName" . }}-agent
-    app.kubernetes.io/name: {{ include "ambassador.name" . }}-agent
-    {{- include "ambassador.labels" . | nindent 4 }}
-    product: aes
-rules:
-- apiGroups: [""]
-  resources: [ "pods"]
-  verbs: [ "get", "list", "watch" ]
----
-apiVersion: rbac.authorization.k8s.io/v1
-kind: ClusterRole
-metadata:
-  name: {{ include "ambassador.fullname" . }}-agent-deployments
-  labels:
-    rbac.getambassador.io/role-group: {{ include "ambassador.rbacName" . }}-agent
-    app.kubernetes.io/name: {{ include "ambassador.name" . }}-agent
-    {{- include "ambassador.labels" . | nindent 4 }}
-    product: aes
-rules:
-- apiGroups: ["apps", "extensions"]
-  resources: [ "deployments" ]
-  verbs: [ "get", "list", "watch" ]
----
-apiVersion: rbac.authorization.k8s.io/v1
-kind: ClusterRole
-metadata:
-  name: {{ include "ambassador.fullname" . }}-agent-endpoints
-  labels:
-    rbac.getambassador.io/role-group: {{ include "ambassador.rbacName" . }}-agent
-    app.kubernetes.io/name: {{ include "ambassador.name" . }}-agent
-    {{- include "ambassador.labels" . | nindent 4 }}
-    product: aes
-rules:
-- apiGroups: [""]
-  resources: [ "endpoints" ]
-  verbs: [ "get", "list", "watch" ]
----
-apiVersion: rbac.authorization.k8s.io/v1
-kind: ClusterRole
-metadata:
-  name: {{ include "ambassador.fullname" . }}-agent-configmaps
-  labels:
-    rbac.getambassador.io/role-group: {{ include "ambassador.rbacName" . }}-agent
-    app.kubernetes.io/name: {{ include "ambassador.name" . }}-agent
-    {{- include "ambassador.labels" . | nindent 4 }}
-    product: aes
-rules:
-- apiGroups: [""]
-  resources: [ "configmaps" ]
-  verbs: [ "get", "list", "watch" ]
----
-{{- if .Values.agent.createArgoRBAC }}
-apiVersion: rbac.authorization.k8s.io/v1
-kind: ClusterRole
-metadata:
-  name: {{ include "ambassador.fullname" . }}-agent-rollouts
-  labels:
-    rbac.getambassador.io/role-group: {{ include "ambassador.rbacName" . }}-agent
-    app.kubernetes.io/name: {{ include "ambassador.name" . }}-agent
-    {{- include "ambassador.labels" . | nindent 4 }}
-    product: aes
-rules:
-- apiGroups: ["argoproj.io"]
-  resources: [ "rollouts", "rollouts/status" ]
-  verbs: [ "get", "list", "watch", "patch" ]
----
-apiVersion: rbac.authorization.k8s.io/v1
-kind: ClusterRole
-metadata:
-  name: {{ include "ambassador.fullname" . }}-agent-applications
-  labels:
-    rbac.getambassador.io/role-group: {{ include "ambassador.rbacName" . }}-agent
-    app.kubernetes.io/name: {{ include "ambassador.name" . }}-agent
-    {{- include "ambassador.labels" . | nindent 4 }}
-    product: aes
-rules:
-- apiGroups: ["argoproj.io"]
-  resources: [ "applications" ]
-  verbs: [ "get", "list", "watch" ]
-{{- end }}
-{{ if ne .Values.agent.cloudConnectToken "" }}
----
-apiVersion: v1
-kind: ConfigMap
-metadata:
-  name: {{ include "ambassador.fullname" . }}-agent-cloud-token
-  namespace: {{ include "ambassador.namespace" . }}
-  labels:
-    app.kubernetes.io/name: {{ include "ambassador.name" . }}-agent-cloud-token
-    {{- include "ambassador.labels" . | nindent 4 }}
-    product: aes
-data:
-  CLOUD_CONNECT_TOKEN: {{ .Values.agent.cloudConnectToken }}
-{{ end }}
-
----
-apiVersion: apps/v1
-kind: Deployment
-metadata:
-  name: {{ include "ambassador.fullname" . }}-agent
-  namespace: {{ include "ambassador.namespace" . }}
-  labels:
-    app.kubernetes.io/name: {{ include "ambassador.fullname" . }}-agent
-    {{- include "ambassador.labels" . | nindent 4 }}
-    product: aes
-spec:
-  replicas: 1
-  selector:
-    matchLabels:
-      app.kubernetes.io/name: {{ include "ambassador.fullname" . }}-agent
-      app.kubernetes.io/instance: {{ .Release.Name }}
-  template:
-    metadata:
-      labels:
-        app.kubernetes.io/name: {{ include "ambassador.fullname" . }}-agent
-        {{- include "ambassador.labels" . | nindent 8 }}
-        product: aes
-    spec:
-      serviceAccountName: {{ include "ambassador.fullname" . }}-agent
-      containers:
-      - name: agent
-        image: {{ include "ambassador.image" . }}
-        imagePullPolicy: {{ .Values.image.pullPolicy }}
-        command: [ "agent" ]
-        ports:
-          - containerPort: 8080
-            name: http
-        env:
-        - name: AGENT_NAMESPACE
-          valueFrom:
-            fieldRef:
-              fieldPath: metadata.namespace
-        - name: AGENT_CONFIG_RESOURCE_NAME
-          value: {{ include "ambassador.fullname" . }}-agent-cloud-token
-        - name: RPC_CONNECTION_ADDRESS
-          value: {{ .Values.agent.rpcAddress }}
-        - name: AES_SNAPSHOT_URL
-          value: "http://{{ include "ambassador.fullname" . }}-admin.{{ include "ambassador.namespace" . }}:{{ .Values.adminService.snapshotPort }}/snapshot-external"
-  {{ if .Values.progressDeadlines }}
-  {{ if hasKey .Values.progressDeadlines "agent" }}
-  progressDeadlineSeconds: {{ .Values.progressDeadlines.agent }}
-  {{- end }}
-  {{- end }}
----
-apiVersion: v1
-kind: Service
-metadata:
-  name: {{ include "ambassador.fullname" . }}-agent
-  namespace: {{ include "ambassador.namespace" . }}
-  labels:
-    {{- if ne .Values.deploymentTool "getambassador.io" }}
-    app.kubernetes.io/name: {{ include "ambassador.name" . }}-agent
-    app.kubernetes.io/part-of: {{ .Release.Name }}
-    helm.sh/chart: {{ include "ambassador.chart" . }}
-    app.kubernetes.io/instance: {{ .Release.Name }}
-    {{- if .Values.deploymentTool }}
-    app.kubernetes.io/managed-by: {{ .Values.deploymentTool }}
-    {{- else }}
-    app.kubernetes.io/managed-by: {{ .Release.Service }}
-    {{- end }}
-    {{- end }}
-    product: aes
-spec:
-  ports:
-    - port: 80
-      targetPort: http
-      protocol: TCP
-      name: http
-  selector:
-    app.kubernetes.io/name: {{ include "ambassador.fullname" . }}-agent
-    app.kubernetes.io/instance: {{ .Release.Name }}
-{{- end }}
-{{- end }}
diff --git a/charts/emissary-ingress/templates/config.yaml b/charts/emissary-ingress/templates/config.yaml
index cd6184dde..4ba1c911a 100644
--- a/charts/emissary-ingress/templates/config.yaml
+++ b/charts/emissary-ingress/templates/config.yaml
@@ -3,7 +3,7 @@ apiVersion: v1
 kind: ConfigMap
 metadata:
   name: '{{ include "ambassador.fullname" . }}-file-config'
-  namespace: {{ include "ambassador.namespace" . }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
     app.kubernetes.io/name: {{ include "ambassador.name" . }}
     {{- include "ambassador.labels" . | nindent 4 }}
diff --git a/charts/emissary-ingress/templates/deployment-apiext.yaml b/charts/emissary-ingress/templates/deployment-apiext.yaml
new file mode 100644
index 000000000..07b9ec3ed
--- /dev/null
+++ b/charts/emissary-ingress/templates/deployment-apiext.yaml
@@ -0,0 +1,66 @@
+---
+apiVersion: v1
+kind: Service
+metadata:
+  name: emissary-apiext
+  namespace: emissary-system
+  labels:
+    app.kubernetes.io/instance: emissary-apiext
+    app.kubernetes.io/managed-by: kubectl_apply_-f_emissary-apiext.yaml
+    app.kubernetes.io/name: emissary-apiext
+    app.kubernetes.io/part-of: emissary-apiext
+spec:
+  type: ClusterIP
+  ports:
+    - name: https
+      port: 443
+      targetPort: https
+  selector:
+    app.kubernetes.io/instance: emissary-apiext
+    app.kubernetes.io/name: emissary-apiext
+    app.kubernetes.io/part-of: emissary-apiext
+---
+apiVersion: apps/v1
+kind: Deployment
+metadata:
+  name: emissary-apiext
+  namespace: emissary-system
+  labels:
+    app.kubernetes.io/instance: emissary-apiext
+    app.kubernetes.io/managed-by: kubectl_apply_-f_emissary-apiext.yaml
+    app.kubernetes.io/name: emissary-apiext
+    app.kubernetes.io/part-of: emissary-apiext
+spec:
+  selector:
+    matchLabels:
+      app.kubernetes.io/instance: emissary-apiext
+      app.kubernetes.io/name: emissary-apiext
+      app.kubernetes.io/part-of: emissary-apiext
+  replicas: 2
+  template:
+    metadata:
+      labels:
+        app.kubernetes.io/instance: emissary-apiext
+        app.kubernetes.io/managed-by: kubectl_apply_-f_emissary-apiext.yaml
+        app.kubernetes.io/name: emissary-apiext
+        app.kubernetes.io/part-of: emissary-apiext
+    spec:
+      serviceAccountName: emissary-apiext
+      containers:
+        - name: emissary-apiext
+          image: {{ .Values.sourceRegistry }}/{{ include "image.repository.path" .Values.image }}
+          imagePullPolicy: Always
+          command: [ "apiext", "emissary-apiext" ]
+          ports:
+            - name: http
+              containerPort: 8080
+            - name: https
+              containerPort: 8443
+          livenessProbe:
+            httpGet:
+              scheme: HTTP
+              path: /probes/live
+              port: 8080
+            initialDelaySeconds: 5
+            periodSeconds: 3
+            failureThreshold: 3
\ No newline at end of file
diff --git a/charts/emissary-ingress/templates/deployment-canary.yaml b/charts/emissary-ingress/templates/deployment-canary.yaml
index c166d4fb0..604f47d24 100644
--- a/charts/emissary-ingress/templates/deployment-canary.yaml
+++ b/charts/emissary-ingress/templates/deployment-canary.yaml
@@ -8,7 +8,7 @@ metadata:
   {{- else }}
   name: {{ include "ambassador.fullname" . }}-canary
   {{- end }}
-  namespace: {{ include "ambassador.namespace" . }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
     app.kubernetes.io/name: {{ include "ambassador.name" . }}
     {{- include "ambassador.labels" . | nindent 4 }}
@@ -138,7 +138,7 @@ spec:
           {{- if ne (include "ambassador.canaryImage" .)  "" }}
           image: {{ include "ambassador.canaryImage" . }}
           {{- else }}
-          image: {{ include "ambassador.image" . }}
+          image: {{ .Values.sourceRegistry }}/{{ include "image.repository.path" .Values.image }}
           {{- end }}
           imagePullPolicy: {{ .Values.image.pullPolicy }}
           ports:
diff --git a/charts/emissary-ingress/templates/deployment.yaml b/charts/emissary-ingress/templates/deployment.yaml
index 2d06c8127..65b7ecc9f 100644
--- a/charts/emissary-ingress/templates/deployment.yaml
+++ b/charts/emissary-ingress/templates/deployment.yaml
@@ -3,7 +3,7 @@ apiVersion: v1
 kind: Pod
 metadata:
       name: {{ include "ambassador.fullname" . }}
-      namespace: {{ include "ambassador.namespace" . }}
+      namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
 {{- else }}
 {{- if .Values.daemonSet }}
 apiVersion: apps/v1
@@ -18,7 +18,7 @@ metadata:
   {{- else }}
   name: {{ include "ambassador.fullname" . }}
   {{- end }}
-  namespace: {{ include "ambassador.namespace" . }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
     app.kubernetes.io/name: {{ include "ambassador.name" . }}
     {{- include "ambassador.labels" . | nindent 4 }}
@@ -99,7 +99,7 @@ spec:
       {{- end }}
       serviceAccountName: {{ include "ambassador.serviceAccountName" . }}
       {{- if .Values.priorityClassName }}
-      priorityClassName: {{ .Values.priorityClassName | quote }}
+      priorityClassName: {{ .Values.priorityClassName | .Release.Namespace | default .Values.defaultNamespace | quote }}
       {{- end }}
       volumes:
         - name: ambassador-pod-info
@@ -156,7 +156,7 @@ spec:
             {{- toYaml .Values.prometheusExporter.resources | nindent 12 }}
         {{- end }}
         - name: {{ if .Values.containerNameOverride }}{{ .Values.containerNameOverride }}{{ else }}{{ .Chart.Name }}{{ end }}
-          image: {{ include "ambassador.image" . }}
+          image: {{ .Values.sourceRegistry }}/{{ include "image.repository.path" .Values.image }}
           imagePullPolicy: {{ .Values.image.pullPolicy }}
           ports:
             {{- range .Values.service.ports }}
@@ -190,7 +190,7 @@ spec:
             {{- end }}
             - name: AMBASSADOR_NAMESPACE
               {{- if .Values.namespace.name }}
-              value: {{ .Values.namespace.name | quote }}
+              value: {{ .Values.namespace.name |.Release.Namespace | default .Values.defaultNamespace | quote }}
               {{ else }}
               valueFrom:
                 fieldRef:
@@ -200,8 +200,8 @@ spec:
               value: {{ include "ambassador.fullname" . }}-agent-cloud-token
             {{- if .Values.env }}
             {{- range $key,$value := .Values.env }}
-            - name: {{ $key | upper | quote}}
-              value: {{ $value | quote}}
+            - name: {{ $key | upper | .Release.Namespace | default .Values.defaultNamespace | quote}}
+              value: {{ $value | .Release.Namespace | default .Values.defaultNamespace | quote}}
             {{- end }}
             {{- end }}
             {{- if .Values.envRaw }}
diff --git a/charts/emissary-ingress/templates/exporter-config.yaml b/charts/emissary-ingress/templates/exporter-config.yaml
index c15802767..633a607ce 100644
--- a/charts/emissary-ingress/templates/exporter-config.yaml
+++ b/charts/emissary-ingress/templates/exporter-config.yaml
@@ -3,7 +3,7 @@ apiVersion: v1
 kind: ConfigMap
 metadata:
   name: '{{ include "ambassador.fullname" . }}-exporter-config'
-  namespace: {{ include "ambassador.namespace" . }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
     app.kubernetes.io/name: {{ include "ambassador.name" . }}
     {{- include "ambassador.labels" . | nindent 4 }}
diff --git a/charts/emissary-ingress/templates/hpa.yaml b/charts/emissary-ingress/templates/hpa.yaml
index f72ccc002..bd1a07e7a 100644
--- a/charts/emissary-ingress/templates/hpa.yaml
+++ b/charts/emissary-ingress/templates/hpa.yaml
@@ -3,7 +3,7 @@ apiVersion: autoscaling/v2beta2
 kind: HorizontalPodAutoscaler
 metadata:
   name: {{ include "ambassador.fullname" . }}
-  namespace: {{ include "ambassador.namespace" . }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
     app.kubernetes.io/name: {{ include "ambassador.name" . }}
     {{- include "ambassador.labels" . | nindent 4 }}
diff --git a/charts/emissary-ingress/templates/listener.yaml b/charts/emissary-ingress/templates/listener.yaml
index 033051cc8..0a8d60e13 100644
--- a/charts/emissary-ingress/templates/listener.yaml
+++ b/charts/emissary-ingress/templates/listener.yaml
@@ -4,7 +4,7 @@ apiVersion: getambassador.io/v3alpha1
 kind: Listener
 metadata:
   name: {{ include "ambassador.fullname" . }}-https-listener
-  namespace: {{ include "ambassador.namespace" . }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
 spec:
   port: 8443
   protocol: HTTPS
@@ -14,14 +14,14 @@ spec:
       from: ALL
   {{- if hasKey .Values.env "AMBASSADOR_ID" }}
   ambassador_id:
-  - {{ .Values.env.AMBASSADOR_ID | quote }}
+  - {{ .Values.env.AMBASSADOR_ID |.Release.Namespace | default .Values.defaultNamespace | quote }}
   {{- end }}
 ---
 apiVersion: getambassador.io/v3alpha1
 kind: Listener
 metadata:
   name: {{ include "ambassador.fullname" . }}-http-listener
-  namespace: {{ include "ambassador.namespace" . }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
 spec:
   port: 8080
   protocol: HTTP
@@ -31,6 +31,6 @@ spec:
       from: ALL
   {{- if hasKey .Values.env "AMBASSADOR_ID" }}
   ambassador_id:
-  - {{ .Values.env.AMBASSADOR_ID | quote }}
+  - {{ .Values.env.AMBASSADOR_ID |.Release.Namespace | default .Values.defaultNamespace | quote }}
   {{- end }}
 {{ end }}
diff --git a/charts/emissary-ingress/templates/module.yaml b/charts/emissary-ingress/templates/module.yaml
index a13d45996..e9287ac4a 100644
--- a/charts/emissary-ingress/templates/module.yaml
+++ b/charts/emissary-ingress/templates/module.yaml
@@ -3,7 +3,7 @@ apiVersion: getambassador.io/v2
 kind: Module
 metadata:
   name: ambassador
-  namespace: {{ include "ambassador.namespace" . }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
     app.kubernetes.io/name: {{ include "ambassador.name" . }}
     {{- include "ambassador.labels" . | nindent 4 }}
@@ -12,7 +12,7 @@ metadata:
 spec:
   {{- if .Values.env }}
   {{- if hasKey .Values.env "AMBASSADOR_ID" }}
-  ambassador_id: {{ .Values.env.AMBASSADOR_ID | quote }}
+  ambassador_id: {{ .Values.env.AMBASSADOR_ID |.Release.Namespace | default .Values.defaultNamespace | quote }}
   {{- end }}
   {{- end }}
   config:
diff --git a/charts/emissary-ingress/templates/namespace.yaml b/charts/emissary-ingress/templates/namespace.yaml
index 4535c74f2..c3cde61b4 100644
--- a/charts/emissary-ingress/templates/namespace.yaml
+++ b/charts/emissary-ingress/templates/namespace.yaml
@@ -4,5 +4,5 @@ kind: Namespace
 metadata:
   labels:
     product: aes
-  name: {{ include "ambassador.namespace" . }}
+  name: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
 {{- end }}
diff --git a/charts/emissary-ingress/templates/pdb.yaml b/charts/emissary-ingress/templates/pdb.yaml
index 549a66fd6..2c5a124c9 100644
--- a/charts/emissary-ingress/templates/pdb.yaml
+++ b/charts/emissary-ingress/templates/pdb.yaml
@@ -3,7 +3,7 @@ apiVersion: policy/v1
 kind: PodDisruptionBudget
 metadata:
   name: {{ include "ambassador.fullname" . }}
-  namespace: {{ include "ambassador.namespace" . }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
     app.kubernetes.io/name: {{ include "ambassador.name" . }}
     {{- include "ambassador.labels" . | nindent 4 }}
diff --git a/charts/emissary-ingress/templates/podsecuritypolicy.yaml b/charts/emissary-ingress/templates/podsecuritypolicy.yaml
index 7c0a7489f..455fe9d33 100644
--- a/charts/emissary-ingress/templates/podsecuritypolicy.yaml
+++ b/charts/emissary-ingress/templates/podsecuritypolicy.yaml
@@ -3,7 +3,7 @@ apiVersion: policy/v1beta1
 kind: PodSecurityPolicy
 metadata:
   name: {{ include "ambassador.fullname" . }}
-  namespace: {{ include "ambassador.namespace" . }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
     app.kubernetes.io/name: {{ include "ambassador.name" . }}
     {{- include "ambassador.labels" . | nindent 4 }}
diff --git a/charts/emissary-ingress/templates/rbac.yaml b/charts/emissary-ingress/templates/rbac.yaml
index b177db0d7..cdcf282ca 100644
--- a/charts/emissary-ingress/templates/rbac.yaml
+++ b/charts/emissary-ingress/templates/rbac.yaml
@@ -35,7 +35,7 @@ roleRef:
   name: {{ include "ambassador.rbacName" . }}
 subjects:
   - name: {{ include "ambassador.serviceAccountName" . }}
-    namespace: {{ include "ambassador.namespace" . }}
+    namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
     kind: ServiceAccount
 
 ---
@@ -68,7 +68,7 @@ apiVersion: rbac.authorization.k8s.io/v1
 kind: Role
 metadata:
   name: {{ include "ambassador.rbacName" . }}
-  namespace: {{ include "ambassador.namespace" . }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
 {{- else }}
 kind: ClusterRole
 metadata:
@@ -139,7 +139,7 @@ apiVersion: rbac.authorization.k8s.io/v1
 kind: RoleBinding
 metadata:
   name: {{ include "ambassador.rbacName" . }}
-  namespace: {{ include "ambassador.namespace" . }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
     app.kubernetes.io/name: {{ include "ambassador.name" . }}
     {{- include "ambassador.labels" . | nindent 4 }}
@@ -150,7 +150,7 @@ roleRef:
   name: {{ include "ambassador.rbacName" . }}
 subjects:
   - name: {{ include "ambassador.serviceAccountName" . }}
-    namespace: {{ include "ambassador.namespace" . }}
+    namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
     kind: ServiceAccount
 {{- end }}
 
diff --git a/charts/emissary-ingress/templates/resolvers.yaml b/charts/emissary-ingress/templates/resolvers.yaml
index 349fe51a3..c724dbe5b 100644
--- a/charts/emissary-ingress/templates/resolvers.yaml
+++ b/charts/emissary-ingress/templates/resolvers.yaml
@@ -4,13 +4,13 @@ apiVersion: getambassador.io/v2
 kind: KubernetesEndpointResolver
 metadata:
   name: {{ .Values.resolvers.endpoint.name }}
-  namespace: {{ include "ambassador.namespace" . }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
     app.kubernetes.io/name: {{ include "ambassador.name" . }}
     {{- include "ambassador.labels" . | nindent 4 }}
 {{- if hasKey .Values.env "AMBASSADOR_ID" }}
 spec:
-  ambassador_id: {{ .Values.env.AMBASSADOR_ID | quote }}
+  ambassador_id: {{ .Values.env.AMBASSADOR_ID |.Release.Namespace | default .Values.defaultNamespace | quote }}
 {{- end }}
 {{- end }}
 {{- if .Values.resolvers.consul.create }}
@@ -19,13 +19,13 @@ apiVersion: getambassador.io/v2
 kind: ConsulResolver
 metadata:
   name: {{ .Values.resolvers.consul.name }}
-  namespace: {{ include "ambassador.namespace" . }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
     app.kubernetes.io/name: {{ include "ambassador.name" . }}
     {{- include "ambassador.labels" . | nindent 4 }}
 spec:
   {{- if hasKey .Values.env "AMBASSADOR_ID" }}
-  ambassador_id: {{ .Values.env.AMBASSADOR_ID | quote }}
+  ambassador_id: {{ .Values.env.AMBASSADOR_ID |.Release.Namespace | default .Values.defaultNamespace | quote }}
   {{- end }}
   {{- toYaml .Values.resolvers.consul.spec | nindent 2 }}
 {{- end }}
diff --git a/charts/emissary-ingress/templates/service-canary.yaml b/charts/emissary-ingress/templates/service-canary.yaml
index 742473cd1..e1304ee82 100644
--- a/charts/emissary-ingress/templates/service-canary.yaml
+++ b/charts/emissary-ingress/templates/service-canary.yaml
@@ -8,7 +8,7 @@ metadata:
   {{- else }}
   name: {{ include "ambassador.fullname" . }}-canary
   {{- end }}
-  namespace: {{ include "ambassador.namespace" . }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
     app.kubernetes.io/name: {{ include "ambassador.name" . }}
     {{- include "ambassador.labels" . | nindent 4 }}
@@ -22,10 +22,10 @@ metadata:
     a8r.io/chat: http://a8r.io/Slack
     a8r.io/bugs: https://github.com/datawire/ambassador/issues
     a8r.io/support: https://www.getambassador.io/about-us/support/
-    a8r.io/dependencies: {{ include "ambassador.fullname" . }}-redis.{{ include "ambassador.namespace" . }}
+    a8r.io/dependencies: {{ include "ambassador.fullname" . }}-redis.{{ .Release.Namespace | default .Values.defaultNamespace | quote|.Release.Namespace | default .Values.defaultNamespace | quote }}
 {{- if .Values.service.annotations }}
   {{- range $key, $value := .Values.service.annotations }}
-    {{ $key }}: {{ $value | quote }}
+    {{ $key }}: {{ $value |.Release.Namespace | default .Values.defaultNamespace | quote }}
   {{- end }}
 {{- end }}
 spec:
diff --git a/charts/emissary-ingress/templates/service.yaml b/charts/emissary-ingress/templates/service.yaml
index 1f3a6706c..5d17aba24 100644
--- a/charts/emissary-ingress/templates/service.yaml
+++ b/charts/emissary-ingress/templates/service.yaml
@@ -6,7 +6,7 @@ metadata:
   {{- else }}
   name: {{ include "ambassador.fullname" . }}
   {{- end }}
-  namespace: {{ include "ambassador.namespace" . }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
     app.kubernetes.io/name: {{ include "ambassador.name" . }}
     {{- include "ambassador.labels" . | nindent 4 }}
@@ -20,10 +20,10 @@ metadata:
     a8r.io/chat: http://a8r.io/Slack
     a8r.io/bugs: https://github.com/datawire/ambassador/issues
     a8r.io/support: https://www.getambassador.io/about-us/support/
-    a8r.io/dependencies: {{ include "ambassador.fullname" . }}-redis.{{ include "ambassador.namespace" . }}
+    a8r.io/dependencies: {{ include "ambassador.fullname" . }}-redis.{{ .Release.Namespace | default .Values.defaultNamespace | quote }}
 {{- if .Values.service.annotations }}
   {{- range $key, $value := .Values.service.annotations }}
-    {{ $key }}: {{ $value | quote }}
+    {{ $key }}: {{ $value |.Release.Namespace | default .Values.defaultNamespace | quote }}
   {{- end }}
 {{- end }}
 spec:
diff --git a/charts/emissary-ingress/templates/serviceaccount.yaml b/charts/emissary-ingress/templates/serviceaccount.yaml
index ef30c7659..a20596210 100644
--- a/charts/emissary-ingress/templates/serviceaccount.yaml
+++ b/charts/emissary-ingress/templates/serviceaccount.yaml
@@ -3,7 +3,7 @@ apiVersion: v1
 kind: ServiceAccount
 metadata:
   name: {{ include "ambassador.serviceAccountName" . }}
-  namespace: {{ include "ambassador.namespace" . }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
     app.kubernetes.io/name: {{ include "ambassador.name" . }}
     {{- include "ambassador.labels" . | nindent 4 }}
diff --git a/charts/emissary-ingress/templates/servicemonitor.yaml b/charts/emissary-ingress/templates/servicemonitor.yaml
index b2c8122a1..2360b9031 100644
--- a/charts/emissary-ingress/templates/servicemonitor.yaml
+++ b/charts/emissary-ingress/templates/servicemonitor.yaml
@@ -3,7 +3,7 @@ apiVersion: monitoring.coreos.com/v1
 kind: ServiceMonitor
 metadata:
   name: {{ include "ambassador.fullname" . }}
-  namespace: {{ include "ambassador.namespace" . }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote|.Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
     app: {{ include "ambassador.name" . }}
     {{- if .Values.metrics.serviceMonitor.selector }}
@@ -21,7 +21,7 @@ spec:
       {{- end }}
   namespaceSelector:
     matchNames:
-      - {{ include "ambassador.namespace" . }}
+      - {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   selector:
     matchLabels:
       service: ambassador-admin
diff --git a/charts/emissary-ingress/values.yaml.in b/charts/emissary-ingress/values.yaml
similarity index 93%
rename from charts/emissary-ingress/values.yaml.in
rename to charts/emissary-ingress/values.yaml
index c2767e002..f7e1c3b32 100644
--- a/charts/emissary-ingress/values.yaml.in
+++ b/charts/emissary-ingress/values.yaml
@@ -2,11 +2,11 @@
 nameOverride: ''
 # Override the generated release name. Defaults to .Release.Name.
 fullnameOverride: ''
-# Override the generated release namespace. Defaults to .Release.Namespace.
-namespaceOverride: ''
+
+defaultNamespace: emissary-system
 
 # Number of Ambassador replicas
-replicaCount: 3
+replicaCount: 2
 # If true, Create a DaemonSet. By default Deployment controller will be created
 daemonSet: false
 # If true, Create a bare Pod instead of a Deployment or DaemonSet; for
@@ -142,11 +142,13 @@ security:
     #   runAsUser:
     #     rule: MustRunAsNonRoot
 
+sourceRegistry: "public.ecr.aws/eks-anywhere"
+
 image:
-  # Emissary Ingress docker repo
-  repository: @imageRepo@
-  # Emissary Ingress docker tag
-  tag: @version@
+  # Emissary Ingress ecr repo
+  repository: emissary-ingress/emissary
+  digest: {{emissary-ingress/emissary}}
+  tag:
   # Pod container image pull policy
   pullPolicy: IfNotPresent
 
@@ -382,22 +384,6 @@ prometheusExporter: # +doc-gen:break
 # securityContext:
 #   runAsUser: 8888
 
-
-# Configure the ambassador agent
-agent:
-  # If `true`, installs the ambassador-agent Deployment, ServiceAccount and ClusterRole in the ambassador namespace, enabling the Service Catalog
-  enabled: true
-  # API token for reporting snapshots to the [Service Catalog](https://app.getambassador.io/cloud/catalog/);
-  # If empty, agent will not report snapshots
-  cloudConnectToken: ''
-  # Address of the ambassador Service Catalog rpc server.
-  rpcAddress: https://app.getambassador.io/
-  createArgoRBAC: true
-  image:
-    # Leave blank to use image.repository and image.tag
-    tag:
-    repository:
-
 deploymentTool: ''
 
 # configure docker to pull from private registry
-- 
2.34.1

