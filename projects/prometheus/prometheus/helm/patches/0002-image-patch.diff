From 9a00035a01b22efd07809f5a2392c3742e985ac4 Mon Sep 17 00:00:00 2001
From: "Ostosh, Ivy" <ivyjin215@gmail.com>
Date: Mon, 14 Nov 2022 10:09:11 -0600
Subject: [PATCH] Update image repo

---
 charts/prometheus-server/templates/server/deploy.yaml | 2 +-
 charts/prometheus-server/templates/server/sts.yaml    | 2 +-
 charts/prometheus-server/values.yaml                  | 5 +++--
 3 files changed, 5 insertions(+), 4 deletions(-)

diff --git a/charts/prometheus-server/templates/server/deploy.yaml b/charts/prometheus-server/templates/server/deploy.yaml
index 3f327376..bbf8ce29 100644
--- a/charts/prometheus-server/templates/server/deploy.yaml
+++ b/charts/prometheus-server/templates/server/deploy.yaml
@@ -53,7 +53,7 @@ spec:
       {{- end }}
       containers:
         - name: {{ template "prometheus.name" . }}-{{ .Values.server.name }}
-          image: "{{ .Values.server.image.repository }}:{{ .Values.server.image.tag }}"
+          image: "{{ .Values.sourceRegistry }}/{{ .Values.server.image.repository }}@{{ .Values.server.image.digest }}"
           imagePullPolicy: "{{ .Values.server.image.pullPolicy }}"
           {{- if .Values.server.env }}
           env:
diff --git a/charts/prometheus-server/templates/server/sts.yaml b/charts/prometheus-server/templates/server/sts.yaml
index cecb9681..6b27df9b 100644
--- a/charts/prometheus-server/templates/server/sts.yaml
+++ b/charts/prometheus-server/templates/server/sts.yaml
@@ -53,7 +53,7 @@ spec:
       {{- end }}
       containers:
         - name: {{ template "prometheus.name" . }}-{{ .Values.server.name }}
-          image: "{{ .Values.server.image.repository }}:{{ .Values.server.image.tag }}"
+          image: "{{ .Values.sourceRegistry }}/{{ .Values.server.image.repository }}@{{ .Values.server.image.digest }}"
           imagePullPolicy: "{{ .Values.server.image.pullPolicy }}"
           {{- if .Values.server.env }}
           env:
diff --git a/charts/prometheus-server/values.yaml b/charts/prometheus-server/values.yaml
index c3e5617a..104658d3 100644
--- a/charts/prometheus-server/values.yaml
+++ b/charts/prometheus-server/values.yaml
@@ -4,6 +4,7 @@ rbac:
 podSecurityPolicy:
   enabled: false
 
+sourceRegistry: "783794618700.dkr.ecr.us-west-2.amazonaws.com"
 imagePullSecrets:
 # - name: "image-pull-secret"
 
@@ -59,8 +60,8 @@ server:
   ## Prometheus server container image
   ##
   image:
-    repository: quay.io/prometheus/prometheus
-    tag: v2.39.1
+    repository: prometheus/prometheus
+    digest: {{prometheus/prometheus}}
     pullPolicy: IfNotPresent
 
   ## prometheus server priorityClassName
-- 
2.31.0

