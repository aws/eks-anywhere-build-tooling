From 995ac5f0300621667c22ea18ee6c524397e9a220 Mon Sep 17 00:00:00 2001
From: Prow Bot <prow@amazonaws.com>
Date: Wed, 17 Dec 2025 21:59:03 -0800
Subject: [PATCH 6/6] Update values.yaml and add values.schema.json

---
 charts/prometheus/values.schema.json | 354 ++++++++++++++-------------
 charts/prometheus/values.yaml        |  26 +-
 2 files changed, 200 insertions(+), 180 deletions(-)

diff --git a/charts/prometheus/values.schema.json b/charts/prometheus/values.schema.json
index 3e987921..0a166123 100644
--- a/charts/prometheus/values.schema.json
+++ b/charts/prometheus/values.schema.json
@@ -1,25 +1,134 @@
 {
     "$schema": "http://json-schema.org/schema#",
     "type": "object",
+    "additionalProperties": false,
     "properties": {
         "alertRelabelConfigs": {
             "type": "object"
         },
-        "alertmanager": {
+        "defaultNamespace": {
+            "type": "string"
+        },
+        "extraManifests": {
+            "type": "array"
+        },
+        "extraScrapeConfigs": {
+            "type": "string"
+        },
+        "forceNamespace": {
+            "type": "string"
+        },
+        "imagePullSecrets": {
+            "type": "array"
+        },
+        "networkPolicy": {
             "type": "object",
             "properties": {
+                "enabled": {
+                    "type": "boolean"
+                }
+            }
+        },
+        "nodeExporter": {
+            "type": "object",
+            "properties": {
+                "container": {
+                    "type": "object",
+                    "properties": {
+                        "securityContext": {
+                            "type": "object",
+                            "properties": {
+                                "allowPrivilegeEscalation": {
+                                    "type": "boolean"
+                                }
+                            }
+                        }
+                    }
+                },
+                "dnsConfig": {
+                    "type": "object"
+                },
                 "enabled": {
                     "type": "boolean"
                 },
-                "persistence": {
+                "extraArgs": {
+                    "type": "object"
+                },
+                "extraConfigmapMounts": {
+                    "type": "array"
+                },
+                "extraHostPathMounts": {
+                    "type": "array"
+                },
+                "extraInitContainers": {
+                    "type": "array"
+                },
+                "hostNetwork": {
+                    "type": "boolean"
+                },
+                "hostPID": {
+                    "type": "boolean"
+                },
+                "hostRootfs": {
+                    "type": "boolean"
+                },
+                "image": {
                     "type": "object",
                     "properties": {
-                        "size": {
+                        "digest": {
+                            "type": "string"
+                        },
+                        "pullPolicy": {
+                            "type": "string"
+                        },
+                        "repository": {
                             "type": "string"
                         }
                     }
                 },
-                "podSecurityContext": {
+                "name": {
+                    "type": "string"
+                },
+                "nodeSelector": {
+                    "type": "object"
+                },
+                "pod": {
+                    "type": "object",
+                    "properties": {
+                        "labels": {
+                            "type": "object"
+                        }
+                    }
+                },
+                "podAnnotations": {
+                    "type": "object"
+                },
+                "podDisruptionBudget": {
+                    "type": "object",
+                    "properties": {
+                        "enabled": {
+                            "type": "boolean"
+                        },
+                        "maxUnavailable": {
+                            "type": "integer"
+                        }
+                    }
+                },
+                "podSecurityPolicy": {
+                    "type": "object",
+                    "properties": {
+                        "annotations": {
+                            "type": "object"
+                        }
+                    }
+                },
+                "priorityClassName": {
+                    "type": "string"
+                },
+                "resources": {
+                    "type": "object"
+                },
+                "securityContext": {
                     "type": "object",
                     "properties": {
                         "fsGroup": {
@@ -35,131 +144,76 @@
                             "type": "integer"
                         }
                     }
-                }
-            }
-        },
-        "configmapReload": {
-            "type": "object",
-            "properties": {
-                "env": {
-                    "type": "array"
                 },
-                "prometheus": {
+                "service": {
                     "type": "object",
                     "properties": {
-                        "containerSecurityContext": {
-                            "type": "object"
-                        },
-                        "enabled": {
-                            "type": "boolean"
-                        },
-                        "extraArgs": {
-                            "type": "object"
-                        },
-                        "extraConfigmapMounts": {
-                            "type": "array"
-                        },
-                        "extraVolumeDirs": {
-                            "type": "array"
-                        },
-                        "extraVolumeMounts": {
-                            "type": "array"
-                        },
-                        "image": {
+                        "annotations": {
                             "type": "object",
                             "properties": {
-                                "digest": {
-                                    "type": "string"
-                                },
-                                "pullPolicy": {
-                                    "type": "string"
-                                },
-                                "repository": {
-                                    "type": "string"
-                                },
-                                "tag": {
+                                "prometheus.io/scrape": {
                                     "type": "string"
                                 }
                             }
                         },
-                        "name": {
+                        "clusterIP": {
                             "type": "string"
                         },
-                        "resources": {
+                        "externalIPs": {
+                            "type": "array"
+                        },
+                        "hostPort": {
+                            "type": "integer"
+                        },
+                        "labels": {
                             "type": "object"
+                        },
+                        "loadBalancerIP": {
+                            "type": "string"
+                        },
+                        "loadBalancerSourceRanges": {
+                            "type": "array"
+                        },
+                        "servicePort": {
+                            "type": "integer"
+                        },
+                        "type": {
+                            "type": "string"
                         }
                     }
                 },
-                "reloadUrl": {
-                    "type": "string"
-                }
-            }
-        },
-        "extraManifests": {
-            "type": "array"
-        },
-        "extraScrapeConfigs": {
-            "type": "string"
-        },
-        "forceNamespace": {
-            "type": "string"
-        },
-        "imagePullSecrets": {
-            "type": "array"
-        },
-        "kube-state-metrics": {
-            "type": "object",
-            "properties": {
-                "enabled": {
-                    "type": "boolean"
-                }
-            }
-        },
-        "networkPolicy": {
-            "type": "object",
-            "properties": {
-                "enabled": {
-                    "type": "boolean"
-                }
-            }
-        },
-        "prometheus-node-exporter": {
-            "type": "object",
-            "properties": {
-                "containerSecurityContext": {
-                    "type": "object",
-                    "properties": {
-                        "allowPrivilegeEscalation": {
-                            "type": "boolean"
+                "tolerations": {
+                    "type": "array",
+                    "items": {
+                        "type": "object",
+                        "properties": {
+                            "effect": {
+                                "type": "string"
+                            },
+                            "key": {
+                                "type": "string"
+                            },
+                            "operator": {
+                                "type": "string"
+                            }
                         }
                     }
                 },
-                "enabled": {
-                    "type": "boolean"
-                },
-                "rbac": {
+                "updateStrategy": {
                     "type": "object",
                     "properties": {
-                        "pspEnabled": {
-                            "type": "boolean"
+                        "type": {
+                            "type": "string"
                         }
                     }
                 }
             }
         },
-        "prometheus-pushgateway": {
+        "podSecurityPolicy": {
             "type": "object",
             "properties": {
                 "enabled": {
                     "type": "boolean"
-                },
-                "serviceAnnotations": {
-                    "type": "object",
-                    "properties": {
-                        "prometheus.io/probe": {
-                            "type": "string"
-                        }
-                    }
                 }
             }
         },
@@ -186,15 +240,6 @@
                 "baseURL": {
                     "type": "string"
                 },
-                "clusterRoleNameOverride": {
-                    "type": "string"
-                },
-                "command": {
-                    "type": "array"
-                },
-                "configMapAnnotations": {
-                    "type": "object"
-                },
                 "configMapOverrideName": {
                     "type": "string"
                 },
@@ -227,12 +272,12 @@
                 "enableServiceLinks": {
                     "type": "boolean"
                 },
+                "enabled": {
+                    "type": "boolean"
+                },
                 "env": {
                     "type": "array"
                 },
-                "exemplars": {
-                    "type": "object"
-                },
                 "extraArgs": {
                     "type": "object"
                 },
@@ -254,9 +299,15 @@
                 "extraInitContainers": {
                     "type": "array"
                 },
+                "extraObjects": {
+                    "type": "array"
+                },
                 "extraSecretMounts": {
                     "type": "array"
                 },
+                "extraTemplates": {
+                    "type": "array"
+                },
                 "extraVolumeMounts": {
                     "type": "array"
                 },
@@ -297,9 +348,6 @@
                         },
                         "repository": {
                             "type": "string"
-                        },
-                        "tag": {
-                            "type": "string"
                         }
                     }
                 },
@@ -380,9 +428,6 @@
                         "size": {
                             "type": "string"
                         },
-                        "statefulSetNameOverride": {
-                            "type": "string"
-                        },
                         "subPath": {
                             "type": "string"
                         }
@@ -391,14 +436,6 @@
                 "podAnnotations": {
                     "type": "object"
                 },
-                "podAntiAffinity": {
-                    "type": "string",
-                    "enum": ["", "soft", "hard"],
-                    "default": ""
-                },
-                "podAntiAffinityTopologyKey": {
-                    "type": "string"
-                },
                 "podDisruptionBudget": {
                     "type": "object",
                     "properties": {
@@ -406,18 +443,20 @@
                             "type": "boolean"
                         },
                         "maxUnavailable": {
-                            "type": [
-                                "string",
-                                "integer"
-                            ]
+                            "type": "integer"
                         }
                     }
                 },
                 "podLabels": {
                     "type": "object"
                 },
-                "portName": {
-                    "type": "string"
+                "podSecurityPolicy": {
+                    "type": "object",
+                    "properties": {
+                        "annotations": {
+                            "type": "object"
+                        }
+                    }
                 },
                 "prefixURL": {
                     "type": "string"
@@ -425,9 +464,6 @@
                 "priorityClassName": {
                     "type": "string"
                 },
-                "runtimeClassName": {
-                    "type": "string"
-                },
                 "probeHeaders": {
                     "type": "array"
                 },
@@ -449,9 +485,6 @@
                 "readinessProbeTimeout": {
                     "type": "integer"
                 },
-                "releaseNamespace": {
-                    "type": "boolean"
-                },
                 "remoteRead": {
                     "type": "array"
                 },
@@ -467,12 +500,6 @@
                 "retention": {
                     "type": "string"
                 },
-                "retentionSize": {
-                    "type": "string"
-                },
-                "revisionHistoryLimit": {
-                    "type": "integer"
-                },
                 "securityContext": {
                     "type": "object",
                     "properties": {
@@ -493,9 +520,6 @@
                 "service": {
                     "type": "object",
                     "properties": {
-                        "additionalPorts": {
-                            "type": "array"
-                        },
                         "annotations": {
                             "type": "object"
                         },
@@ -612,12 +636,6 @@
                         },
                         "podManagementPolicy": {
                             "type": "string"
-                        },
-                        "pvcDeleteOnStsDelete": {
-                            "type": "boolean"
-                        },
-                        "pvcDeleteOnStsScale": {
-                            "type": "boolean"
                         }
                     }
                 },
@@ -641,12 +659,6 @@
                 "tolerations": {
                     "type": "array"
                 },
-                "topologySpreadConstraints": {
-                    "type": "array"
-                },
-                "tsdb": {
-                    "type": "object"
-                },
                 "verticalAutoscaler": {
                     "type": "object",
                     "properties": {
@@ -657,11 +669,9 @@
                 }
             }
         },
-        "scrapeConfigFiles": {
-            "type": "array"
-        },
         "serverFiles": {
             "type": "object",
+            "additionalProperties": false,
             "properties": {
                 "alerting_rules.yml": {
                     "type": "object"
@@ -716,7 +726,7 @@
         "serviceAccounts": {
             "type": "object",
             "properties": {
-                "server": {
+                "nodeExporter": {
                     "type": "object",
                     "properties": {
                         "annotations": {
@@ -727,13 +737,27 @@
                         },
                         "name": {
                             "type": "string"
+                        }
+                    }
+                },
+                "server": {
+                    "type": "object",
+                    "properties": {
+                        "annotations": {
+                            "type": "object"
                         },
-                        "automountServiceAccountToken": {
+                        "create": {
                             "type": "boolean"
+                        },
+                        "name": {
+                            "type": "string"
                         }
                     }
                 }
             }
+        },
+        "sourceRegistry": {
+            "type": "string"
         }
     }
-}
\ No newline at end of file
+}
diff --git a/charts/prometheus/values.yaml b/charts/prometheus/values.yaml
index 6e1f2248..0797f647 100644
--- a/charts/prometheus/values.yaml
+++ b/charts/prometheus/values.yaml
@@ -20,7 +20,7 @@ imagePullSecrets: []
 serviceAccounts:
   nodeExporter:
     create: true
-    name:
+    name: ""
     annotations: {}
   server:
     create: true
@@ -31,9 +31,6 @@ serviceAccounts:
     ## It will be overriden by server.automountServiceAccountToken value, if set.
     # automountServiceAccountToken: false
 
-## Additional labels to attach to all resources
-commonMetaLabels: {}
-
 
 nodeExporter:
   ## If false, node-exporter will not be installed
@@ -112,11 +109,15 @@ nodeExporter:
   ## Node tolerations for node-exporter scheduling to nodes with taints
   ## Ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/
   ##
-  tolerations: []
-    # - key: "key"
-    #   operator: "Equal|Exists"
-    #   value: "value"
-    #   effect: "NoSchedule|PreferNoSchedule|NoExecute(1.6 only)"
+  tolerations:
+    # For K8 version prior to 1.24
+    - key: "node-role.kubernetes.io/master"
+      operator: "Exists"
+      effect: "NoSchedule"
+    # For K8 version 1.24+
+    - key: "node-role.kubernetes.io/control-plane"
+      operator: "Exists"
+      effect: "NoSchedule"
 
   ## Node labels for node-exporter pod assignment
   ## Ref: https://kubernetes.io/docs/user-guide/node-selection/
@@ -829,7 +830,7 @@ server:
     loadBalancerIP: ""
     loadBalancerSourceRanges: []
     loadBalancerClass: ""
-    servicePort: 80
+    servicePort: 9090
     sessionAffinity: None
     type: ClusterIP
     ## externalTrafficPolicy is applicable to service with externally-facing addresses (NodePorts, ExternalIPs, and LoadBalancer IPs)
@@ -870,11 +871,6 @@ server:
 ## Prometheus server ConfigMap entries for rule files (allow prometheus labels interpolation)
 ruleFiles: {}
 
-## Prometheus server ConfigMap entries for scrape_config_files
-## (allows scrape configs defined in additional files)
-##
-scrapeConfigFiles: []
-
 ## Prometheus server ConfigMap entries
 ##
 serverFiles:
-- 
2.50.1 (Apple Git-155)

