From 62034b895dc0d4c3f8fc19e1baad6e93759d91b8 Mon Sep 17 00:00:00 2001
From: Jun Shun Zhang <junshun@amazon.com>
Date: Wed, 3 Aug 2022 14:52:01 -0400
Subject: [PATCH 2/2] Adding imagePullSecret and default Namespace

---
 templates/_helpers.tpl                        | 11 ++++++++++-
 templates/chartmuseum/chartmuseum-cm.yaml     |  2 +-
 templates/chartmuseum/chartmuseum-dpl.yaml    |  4 ++--
 templates/chartmuseum/chartmuseum-pvc.yaml    |  2 +-
 templates/chartmuseum/chartmuseum-secret.yaml |  2 +-
 templates/chartmuseum/chartmuseum-svc.yaml    |  2 +-
 templates/chartmuseum/chartmuseum-tls.yaml    |  2 +-
 templates/core/core-cm.yaml                   |  2 +-
 templates/core/core-dpl.yaml                  |  4 ++--
 templates/core/core-pre-upgrade-job.yaml      |  4 ++--
 templates/core/core-secret.yaml               |  2 +-
 templates/core/core-svc.yaml                  |  2 +-
 templates/core/core-tls.yaml                  |  2 +-
 templates/core/secret.yaml                    | 16 ++++++++++++++++
 templates/database/database-secret.yaml       |  2 +-
 templates/database/database-ss.yaml           |  6 +++---
 templates/database/database-svc.yaml          |  2 +-
 templates/exporter/exporter-cm-env.yaml       |  2 +-
 templates/exporter/exporter-dpl.yaml          |  4 ++--
 templates/exporter/exporter-secret.yaml       |  2 +-
 templates/exporter/exporter-svc.yaml          |  2 +-
 templates/ingress/ingress.yaml                |  4 ++--
 templates/ingress/secret.yaml                 |  2 +-
 templates/internal/auto-tls.yaml              | 12 ++++++------
 templates/jobservice/jobservice-cm-env.yaml   |  2 +-
 templates/jobservice/jobservice-cm.yaml       |  2 +-
 templates/jobservice/jobservice-dpl.yaml      |  4 ++--
 templates/jobservice/jobservice-pvc.yaml      |  2 +-
 templates/jobservice/jobservice-secrets.yaml  |  2 +-
 templates/jobservice/jobservice-svc.yaml      |  2 +-
 templates/jobservice/jobservice-tls.yaml      |  2 +-
 templates/metrics/metrics-svcmon.yaml         |  2 +-
 templates/nginx/configmap-http.yaml           |  2 +-
 templates/nginx/configmap-https.yaml          |  2 +-
 templates/nginx/deployment.yaml               |  4 ++--
 templates/nginx/secret.yaml                   |  2 +-
 templates/nginx/service.yaml                  |  2 +-
 templates/notary/notary-secret.yaml           |  2 +-
 templates/notary/notary-server.yaml           |  4 ++--
 templates/notary/notary-signer.yaml           |  4 ++--
 templates/notary/notary-svc.yaml              |  4 ++--
 templates/portal/configmap.yaml               |  2 +-
 templates/portal/deployment.yaml              |  4 ++--
 templates/portal/service.yaml                 |  2 +-
 templates/portal/tls.yaml                     |  2 +-
 templates/redis/service.yaml                  |  2 +-
 templates/redis/statefulset.yaml              |  6 +++---
 templates/registry/registry-cm.yaml           |  2 +-
 templates/registry/registry-dpl.yaml          |  4 ++--
 templates/registry/registry-pvc.yaml          |  2 +-
 templates/registry/registry-secret.yaml       |  4 ++--
 templates/registry/registry-svc.yaml          |  2 +-
 templates/registry/registry-tls.yaml          |  2 +-
 templates/registry/registryctl-cm.yaml        |  2 +-
 templates/registry/registryctl-secret.yaml    |  2 +-
 templates/trivy/trivy-secret.yaml             |  2 +-
 templates/trivy/trivy-sts.yaml                |  6 +++---
 templates/trivy/trivy-svc.yaml                |  2 +-
 templates/trivy/trivy-tls.yaml                |  2 +-
 values.yaml                                   | 10 ++++++++++
 60 files changed, 117 insertions(+), 82 deletions(-)
 create mode 100644 templates/core/secret.yaml

diff --git a/templates/_helpers.tpl b/templates/_helpers.tpl
index 5706b1f..fb6e289 100644
--- a/templates/_helpers.tpl
+++ b/templates/_helpers.tpl
@@ -608,4 +608,13 @@ postgres://{{ template "harbor.database.username" . }}:{{ template "harbor.datab
 {{/* Generate image repository path. */}}
 {{- define "harbor.image.repository.path" -}}
   {{- .repository }}@{{ .digest -}}
-{{- end -}}
\ No newline at end of file
+{{- end -}}
+
+{{/*
+Create imagePullSecret
+*/}}
+{{- define "imagePullSecret" }}
+{{- with .Values.imageCredentials }}
+{{- printf "{\"auths\":{\"%s\":{\"username\":\"%s\",\"password\":\"%s\",\"email\":\"%s\",\"auth\":\"%s\"}}}" .registry .username .password .email (printf "%s:%s" .username .password | b64enc) | b64enc }}
+{{- end }}
+{{- end }}
\ No newline at end of file
diff --git a/templates/chartmuseum/chartmuseum-cm.yaml b/templates/chartmuseum/chartmuseum-cm.yaml
index 66279a3..cda9114 100644
--- a/templates/chartmuseum/chartmuseum-cm.yaml
+++ b/templates/chartmuseum/chartmuseum-cm.yaml
@@ -3,7 +3,7 @@ apiVersion: v1
 kind: ConfigMap
 metadata:
   name: "{{ template "harbor.chartmuseum" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 data:
diff --git a/templates/chartmuseum/chartmuseum-dpl.yaml b/templates/chartmuseum/chartmuseum-dpl.yaml
index ef667c8..979ab17 100644
--- a/templates/chartmuseum/chartmuseum-dpl.yaml
+++ b/templates/chartmuseum/chartmuseum-dpl.yaml
@@ -3,7 +3,7 @@ apiVersion: apps/v1
 kind: Deployment
 metadata:
   name: "{{ template "harbor.chartmuseum" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
     component: chartmuseum
@@ -21,7 +21,7 @@ spec:
       component: chartmuseum
   template:
     metadata:
-      namespace: {{ .Release.Namespace | quote }}
+      namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
       labels:
 {{ include "harbor.labels" . | indent 8 }}
         component: chartmuseum
diff --git a/templates/chartmuseum/chartmuseum-pvc.yaml b/templates/chartmuseum/chartmuseum-pvc.yaml
index a019040..4bff3f3 100644
--- a/templates/chartmuseum/chartmuseum-pvc.yaml
+++ b/templates/chartmuseum/chartmuseum-pvc.yaml
@@ -7,7 +7,7 @@ kind: PersistentVolumeClaim
 apiVersion: v1
 metadata:
   name: {{ template "harbor.chartmuseum" . }}
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   annotations:
   {{- range $key, $value := $chartmuseum.annotations }}
     {{ $key }}: {{ $value | quote }}
diff --git a/templates/chartmuseum/chartmuseum-secret.yaml b/templates/chartmuseum/chartmuseum-secret.yaml
index a8a8f3f..04d3dcd 100644
--- a/templates/chartmuseum/chartmuseum-secret.yaml
+++ b/templates/chartmuseum/chartmuseum-secret.yaml
@@ -3,7 +3,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: "{{ template "harbor.chartmuseum" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 type: Opaque
diff --git a/templates/chartmuseum/chartmuseum-svc.yaml b/templates/chartmuseum/chartmuseum-svc.yaml
index 0406f98..6b6580d 100644
--- a/templates/chartmuseum/chartmuseum-svc.yaml
+++ b/templates/chartmuseum/chartmuseum-svc.yaml
@@ -3,7 +3,7 @@ apiVersion: v1
 kind: Service
 metadata:
   name: "{{ template "harbor.chartmuseum" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 spec:
diff --git a/templates/chartmuseum/chartmuseum-tls.yaml b/templates/chartmuseum/chartmuseum-tls.yaml
index f0e1212..5f9e540 100644
--- a/templates/chartmuseum/chartmuseum-tls.yaml
+++ b/templates/chartmuseum/chartmuseum-tls.yaml
@@ -4,7 +4,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: "{{ template "harbor.internalTLS.chartmuseum.secretName" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 type: kubernetes.io/tls
diff --git a/templates/core/core-cm.yaml b/templates/core/core-cm.yaml
index ac7eedc..6c484a0 100644
--- a/templates/core/core-cm.yaml
+++ b/templates/core/core-cm.yaml
@@ -2,7 +2,7 @@ apiVersion: v1
 kind: ConfigMap
 metadata:
   name: {{ template "harbor.core" . }}
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 data:
diff --git a/templates/core/core-dpl.yaml b/templates/core/core-dpl.yaml
index 2ef7556..9ebe3b5 100644
--- a/templates/core/core-dpl.yaml
+++ b/templates/core/core-dpl.yaml
@@ -2,7 +2,7 @@ apiVersion: apps/v1
 kind: Deployment
 metadata:
   name: {{ template "harbor.core" . }}
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
     component: core
@@ -15,7 +15,7 @@ spec:
       component: core
   template:
     metadata:
-      namespace: {{ .Release.Namespace | quote }}
+      namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
       labels:
 {{ include "harbor.matchLabels" . | indent 8 }}
         component: core
diff --git a/templates/core/core-pre-upgrade-job.yaml b/templates/core/core-pre-upgrade-job.yaml
index 6c8e895..733ec7d 100644
--- a/templates/core/core-pre-upgrade-job.yaml
+++ b/templates/core/core-pre-upgrade-job.yaml
@@ -3,7 +3,7 @@ apiVersion: batch/v1
 kind: Job
 metadata:
   name: migration-job
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
     component: migrator
@@ -15,7 +15,7 @@ metadata:
 spec:
   template:
     metadata:
-      namespace: {{ .Release.Namespace | quote }}
+      namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
       labels:
 {{ include "harbor.matchLabels" . | indent 8 }}
         component: migrator
diff --git a/templates/core/core-secret.yaml b/templates/core/core-secret.yaml
index e8fd07c..c440b94 100644
--- a/templates/core/core-secret.yaml
+++ b/templates/core/core-secret.yaml
@@ -2,7 +2,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: {{ template "harbor.core" . }}
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 type: Opaque
diff --git a/templates/core/core-svc.yaml b/templates/core/core-svc.yaml
index b945830..2b2d56a 100644
--- a/templates/core/core-svc.yaml
+++ b/templates/core/core-svc.yaml
@@ -2,7 +2,7 @@ apiVersion: v1
 kind: Service
 metadata:
   name: {{ template "harbor.core" . }}
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 spec:
diff --git a/templates/core/core-tls.yaml b/templates/core/core-tls.yaml
index fff0730..4c26890 100644
--- a/templates/core/core-tls.yaml
+++ b/templates/core/core-tls.yaml
@@ -4,7 +4,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: "{{ template "harbor.internalTLS.core.secretName" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 type: kubernetes.io/tls
diff --git a/templates/core/secret.yaml b/templates/core/secret.yaml
new file mode 100644
index 0000000..efdc7fc
--- /dev/null
+++ b/templates/core/secret.yaml
@@ -0,0 +1,16 @@
+{{ if .Values.imagePullSecrets }}
+{{ if .Values.pullSecretName }}
+apiVersion: v1
+kind: Secret
+metadata:
+  name: {{.Values.pullSecretName}}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
+type: kubernetes.io/dockerconfigjson
+data:
+  {{ if .Values.pullSecretData }}
+  .dockerconfigjson: {{.Values.pullSecretData}}
+  {{ else }}
+  .dockerconfigjson: {{ template "imagePullSecret" . }}
+  {{ end }}
+{{ end }}
+{{ end }}
\ No newline at end of file
diff --git a/templates/database/database-secret.yaml b/templates/database/database-secret.yaml
index 0d07ec2..07c0d7b 100644
--- a/templates/database/database-secret.yaml
+++ b/templates/database/database-secret.yaml
@@ -3,7 +3,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: "{{ template "harbor.database" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 type: Opaque
diff --git a/templates/database/database-ss.yaml b/templates/database/database-ss.yaml
index 5962b87..9d951c7 100644
--- a/templates/database/database-ss.yaml
+++ b/templates/database/database-ss.yaml
@@ -4,7 +4,7 @@ apiVersion: apps/v1
 kind: StatefulSet
 metadata:
   name: "{{ template "harbor.database" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
     component: database
@@ -17,7 +17,7 @@ spec:
       component: database
   template:
     metadata:
-      namespace: {{ .Release.Namespace | quote }}
+      namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
       labels:
 {{ include "harbor.labels" . | indent 8 }}
         component: database
@@ -140,7 +140,7 @@ spec:
   volumeClaimTemplates:
   - metadata:
       name: "database-data"
-      namespace: {{ .Release.Namespace | quote }}
+      namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
       labels:
 {{ include "harbor.labels" . | indent 8 }}
       annotations:
diff --git a/templates/database/database-svc.yaml b/templates/database/database-svc.yaml
index 84623d2..3528cc9 100644
--- a/templates/database/database-svc.yaml
+++ b/templates/database/database-svc.yaml
@@ -3,7 +3,7 @@ apiVersion: v1
 kind: Service
 metadata:
   name: "{{ template "harbor.database" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 spec:
diff --git a/templates/exporter/exporter-cm-env.yaml b/templates/exporter/exporter-cm-env.yaml
index 4d82ca8..63d7690 100644
--- a/templates/exporter/exporter-cm-env.yaml
+++ b/templates/exporter/exporter-cm-env.yaml
@@ -3,7 +3,7 @@ apiVersion: v1
 kind: ConfigMap
 metadata:
   name: "{{ template "harbor.exporter" . }}-env"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 data:
diff --git a/templates/exporter/exporter-dpl.yaml b/templates/exporter/exporter-dpl.yaml
index 53c9c87..923cb01 100644
--- a/templates/exporter/exporter-dpl.yaml
+++ b/templates/exporter/exporter-dpl.yaml
@@ -3,7 +3,7 @@ apiVersion: apps/v1
 kind: Deployment
 metadata:
   name: {{ template "harbor.exporter" . }}
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
     component: exporter
@@ -16,7 +16,7 @@ spec:
       component: exporter
   template:
     metadata:
-      namespace: {{ .Release.Namespace | quote }}
+      namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
       labels:
 {{ include "harbor.labels" . | indent 8 }}
         component: exporter
diff --git a/templates/exporter/exporter-secret.yaml b/templates/exporter/exporter-secret.yaml
index 317c87d..b6dba04 100644
--- a/templates/exporter/exporter-secret.yaml
+++ b/templates/exporter/exporter-secret.yaml
@@ -3,7 +3,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: {{ template "harbor.exporter" . }}
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 type: Opaque
diff --git a/templates/exporter/exporter-svc.yaml b/templates/exporter/exporter-svc.yaml
index 6d0d831..de69ef3 100644
--- a/templates/exporter/exporter-svc.yaml
+++ b/templates/exporter/exporter-svc.yaml
@@ -3,7 +3,7 @@ apiVersion: v1
 kind: Service
 metadata:
   name: "{{ template "harbor.exporter" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 spec:
diff --git a/templates/ingress/ingress.yaml b/templates/ingress/ingress.yaml
index 3ca23d1..fc3ee6f 100644
--- a/templates/ingress/ingress.yaml
+++ b/templates/ingress/ingress.yaml
@@ -38,7 +38,7 @@ apiVersion: networking.k8s.io/v1
 kind: Ingress
 metadata:
   name: "{{ template "harbor.ingress" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 {{- if $ingress.harbor.labels }}
@@ -158,7 +158,7 @@ apiVersion: networking.k8s.io/v1
 kind: Ingress
 metadata:
   name: "{{ template "harbor.ingress-notary" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 {{- if $ingress.notary.labels }}
diff --git a/templates/ingress/secret.yaml b/templates/ingress/secret.yaml
index 678ec69..0072905 100644
--- a/templates/ingress/secret.yaml
+++ b/templates/ingress/secret.yaml
@@ -5,7 +5,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: "{{ template "harbor.ingress" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 type: kubernetes.io/tls
diff --git a/templates/internal/auto-tls.yaml b/templates/internal/auto-tls.yaml
index 3b64c56..6bc9548 100644
--- a/templates/internal/auto-tls.yaml
+++ b/templates/internal/auto-tls.yaml
@@ -14,7 +14,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: "{{ template "harbor.internalTLS.core.secretName" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 type: kubernetes.io/tls
@@ -28,7 +28,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: "{{ template "harbor.internalTLS.jobservice.secretName" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 type: kubernetes.io/tls
@@ -42,7 +42,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: "{{ template "harbor.internalTLS.registry.secretName" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 type: kubernetes.io/tls
@@ -56,7 +56,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: "{{ template "harbor.internalTLS.portal.secretName" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 type: kubernetes.io/tls
@@ -73,7 +73,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: "{{ template "harbor.internalTLS.chartmuseum.secretName" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 type: kubernetes.io/tls
@@ -91,7 +91,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: "{{ template "harbor.internalTLS.trivy.secretName" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 type: kubernetes.io/tls
diff --git a/templates/jobservice/jobservice-cm-env.yaml b/templates/jobservice/jobservice-cm-env.yaml
index 40e4e20..7dcb22d 100644
--- a/templates/jobservice/jobservice-cm-env.yaml
+++ b/templates/jobservice/jobservice-cm-env.yaml
@@ -2,7 +2,7 @@ apiVersion: v1
 kind: ConfigMap
 metadata:
   name: "{{ template "harbor.jobservice" . }}-env"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 data:
diff --git a/templates/jobservice/jobservice-cm.yaml b/templates/jobservice/jobservice-cm.yaml
index 85f95dd..5c0675a 100644
--- a/templates/jobservice/jobservice-cm.yaml
+++ b/templates/jobservice/jobservice-cm.yaml
@@ -2,7 +2,7 @@ apiVersion: v1
 kind: ConfigMap
 metadata:
   name: "{{ template "harbor.jobservice" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 data:
diff --git a/templates/jobservice/jobservice-dpl.yaml b/templates/jobservice/jobservice-dpl.yaml
index 9ed970b..6a614a6 100644
--- a/templates/jobservice/jobservice-dpl.yaml
+++ b/templates/jobservice/jobservice-dpl.yaml
@@ -2,7 +2,7 @@ apiVersion: apps/v1
 kind: Deployment
 metadata:
   name: "{{ template "harbor.jobservice" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
     component: jobservice
@@ -20,7 +20,7 @@ spec:
       component: jobservice
   template:
     metadata:
-      namespace: {{ .Release.Namespace | quote }}
+      namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
       labels:
 {{ include "harbor.labels" . | indent 8 }}
         component: jobservice
diff --git a/templates/jobservice/jobservice-pvc.yaml b/templates/jobservice/jobservice-pvc.yaml
index 97543ea..d7213f8 100644
--- a/templates/jobservice/jobservice-pvc.yaml
+++ b/templates/jobservice/jobservice-pvc.yaml
@@ -4,7 +4,7 @@ kind: PersistentVolumeClaim
 apiVersion: v1
 metadata:
   name: {{ template "harbor.jobservice" . }}
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   annotations:
   {{- range $key, $value := $jobservice.annotations }}
     {{ $key }}: {{ $value | quote }}
diff --git a/templates/jobservice/jobservice-secrets.yaml b/templates/jobservice/jobservice-secrets.yaml
index fcaa311..1ebf594 100644
--- a/templates/jobservice/jobservice-secrets.yaml
+++ b/templates/jobservice/jobservice-secrets.yaml
@@ -2,7 +2,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: "{{ template "harbor.jobservice" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 type: Opaque
diff --git a/templates/jobservice/jobservice-svc.yaml b/templates/jobservice/jobservice-svc.yaml
index 483b40e..13a9401 100644
--- a/templates/jobservice/jobservice-svc.yaml
+++ b/templates/jobservice/jobservice-svc.yaml
@@ -2,7 +2,7 @@ apiVersion: v1
 kind: Service
 metadata:
   name: "{{ template "harbor.jobservice" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 spec:
diff --git a/templates/jobservice/jobservice-tls.yaml b/templates/jobservice/jobservice-tls.yaml
index 511d9c8..3946104 100644
--- a/templates/jobservice/jobservice-tls.yaml
+++ b/templates/jobservice/jobservice-tls.yaml
@@ -4,7 +4,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: "{{ template "harbor.internalTLS.jobservice.secretName" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 type: kubernetes.io/tls
diff --git a/templates/metrics/metrics-svcmon.yaml b/templates/metrics/metrics-svcmon.yaml
index 21fbcbd..061478c 100644
--- a/templates/metrics/metrics-svcmon.yaml
+++ b/templates/metrics/metrics-svcmon.yaml
@@ -3,7 +3,7 @@ apiVersion: monitoring.coreos.com/v1
 kind: ServiceMonitor
 metadata:
   name: {{ template "harbor.fullname" . }}
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels: {{ include "harbor.labels" . | nindent 4 }}
 {{- if .Values.metrics.serviceMonitor.additionalLabels }}
 {{ toYaml .Values.metrics.serviceMonitor.additionalLabels | indent 4 }}
diff --git a/templates/nginx/configmap-http.yaml b/templates/nginx/configmap-http.yaml
index a8621d2..828b7e5 100644
--- a/templates/nginx/configmap-http.yaml
+++ b/templates/nginx/configmap-http.yaml
@@ -4,7 +4,7 @@ apiVersion: v1
 kind: ConfigMap
 metadata:
   name: {{ template "harbor.nginx" . }}
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 data:
diff --git a/templates/nginx/configmap-https.yaml b/templates/nginx/configmap-https.yaml
index 6ed11f6..49982b0 100644
--- a/templates/nginx/configmap-https.yaml
+++ b/templates/nginx/configmap-https.yaml
@@ -4,7 +4,7 @@ apiVersion: v1
 kind: ConfigMap
 metadata:
   name: {{ template "harbor.nginx" . }}
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 data:
diff --git a/templates/nginx/deployment.yaml b/templates/nginx/deployment.yaml
index 67f11fc..414512d 100644
--- a/templates/nginx/deployment.yaml
+++ b/templates/nginx/deployment.yaml
@@ -3,7 +3,7 @@ apiVersion: apps/v1
 kind: Deployment
 metadata:
   name: {{ template "harbor.nginx" . }}
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
     component: nginx
@@ -16,7 +16,7 @@ spec:
       component: nginx
   template:
     metadata:
-      namespace: {{ .Release.Namespace | quote }}
+      namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
       labels:
 {{ include "harbor.labels" . | indent 8 }}
         component: nginx
diff --git a/templates/nginx/secret.yaml b/templates/nginx/secret.yaml
index 2dfc1c4..6012913 100644
--- a/templates/nginx/secret.yaml
+++ b/templates/nginx/secret.yaml
@@ -5,7 +5,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: {{ template "harbor.nginx" . }}
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 type: Opaque
diff --git a/templates/nginx/service.yaml b/templates/nginx/service.yaml
index 892f858..2ff22c1 100644
--- a/templates/nginx/service.yaml
+++ b/templates/nginx/service.yaml
@@ -2,7 +2,7 @@
 apiVersion: v1
 kind: Service
 metadata:
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
 {{- if eq .Values.expose.type "clusterIP" }}
 {{- $clusterIP := .Values.expose.clusterIP }}
   name: {{ $clusterIP.name }}
diff --git a/templates/notary/notary-secret.yaml b/templates/notary/notary-secret.yaml
index f01a606..6ae30c2 100644
--- a/templates/notary/notary-secret.yaml
+++ b/templates/notary/notary-secret.yaml
@@ -3,7 +3,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: {{ template "harbor.notary-server" . }}
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
     component: notary
diff --git a/templates/notary/notary-server.yaml b/templates/notary/notary-server.yaml
index d986132..6452f88 100644
--- a/templates/notary/notary-server.yaml
+++ b/templates/notary/notary-server.yaml
@@ -3,7 +3,7 @@ apiVersion: apps/v1
 kind: Deployment
 metadata:
   name: {{ template "harbor.notary-server" . }}
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
     component: notary-server
@@ -15,7 +15,7 @@ spec:
       component: notary-server
   template:
     metadata:
-      namespace: {{ .Release.Namespace | quote }}
+      namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
       labels:
 {{ include "harbor.labels" . | indent 8 }}
         component: notary-server
diff --git a/templates/notary/notary-signer.yaml b/templates/notary/notary-signer.yaml
index 9d6fa2b..2f4dfcc 100644
--- a/templates/notary/notary-signer.yaml
+++ b/templates/notary/notary-signer.yaml
@@ -3,7 +3,7 @@ apiVersion: apps/v1
 kind: Deployment
 metadata:
   name: {{ template "harbor.notary-signer" . }}
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
     component: notary-signer
@@ -15,7 +15,7 @@ spec:
       component: notary-signer
   template:
     metadata:
-      namespace: {{ .Release.Namespace | quote }}
+      namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
       labels:
 {{ include "harbor.labels" . | indent 8 }}
         component: notary-signer
diff --git a/templates/notary/notary-svc.yaml b/templates/notary/notary-svc.yaml
index b23318b..3548492 100644
--- a/templates/notary/notary-svc.yaml
+++ b/templates/notary/notary-svc.yaml
@@ -3,7 +3,7 @@ apiVersion: v1
 kind: Service
 metadata:
   name: {{ template "harbor.notary-server" . }}
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 spec:
@@ -21,7 +21,7 @@ apiVersion: v1
 kind: Service
 metadata:
   name: {{ template "harbor.notary-signer" . }}
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 spec:
diff --git a/templates/portal/configmap.yaml b/templates/portal/configmap.yaml
index e7bfd85..f2afabd 100644
--- a/templates/portal/configmap.yaml
+++ b/templates/portal/configmap.yaml
@@ -2,7 +2,7 @@ apiVersion: v1
 kind: ConfigMap
 metadata:
   name: "{{ template "harbor.portal" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 data:
diff --git a/templates/portal/deployment.yaml b/templates/portal/deployment.yaml
index b58f5ac..b1b4260 100644
--- a/templates/portal/deployment.yaml
+++ b/templates/portal/deployment.yaml
@@ -2,7 +2,7 @@ apiVersion: apps/v1
 kind: Deployment
 metadata:
   name: "{{ template "harbor.portal" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
     component: portal
@@ -15,7 +15,7 @@ spec:
       component: portal
   template:
     metadata:
-      namespace: {{ .Release.Namespace | quote }}
+      namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
       labels:
 {{ include "harbor.matchLabels" . | indent 8 }}
         component: portal
diff --git a/templates/portal/service.yaml b/templates/portal/service.yaml
index 1b29229..d5b56ea 100644
--- a/templates/portal/service.yaml
+++ b/templates/portal/service.yaml
@@ -2,7 +2,7 @@ apiVersion: v1
 kind: Service
 metadata:
   name: "{{ template "harbor.portal" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 spec:
diff --git a/templates/portal/tls.yaml b/templates/portal/tls.yaml
index e61a7d3..75b0be1 100644
--- a/templates/portal/tls.yaml
+++ b/templates/portal/tls.yaml
@@ -4,7 +4,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: "{{ template "harbor.internalTLS.portal.secretName" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 type: kubernetes.io/tls
diff --git a/templates/redis/service.yaml b/templates/redis/service.yaml
index d774706..24fafd9 100644
--- a/templates/redis/service.yaml
+++ b/templates/redis/service.yaml
@@ -3,7 +3,7 @@ apiVersion: v1
 kind: Service
 metadata:
   name: {{ template "harbor.redis" . }}
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 spec:
diff --git a/templates/redis/statefulset.yaml b/templates/redis/statefulset.yaml
index 40070dd..e6d3d08 100644
--- a/templates/redis/statefulset.yaml
+++ b/templates/redis/statefulset.yaml
@@ -4,7 +4,7 @@ apiVersion: apps/v1
 kind: StatefulSet
 metadata:
   name: {{ template "harbor.redis" . }}
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
     component: redis
@@ -17,7 +17,7 @@ spec:
       component: redis
   template:
     metadata:
-      namespace: {{ .Release.Namespace | quote }}
+      namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
       labels:
 {{ include "harbor.labels" . | indent 8 }}
         component: redis
@@ -89,7 +89,7 @@ spec:
   volumeClaimTemplates:
   - metadata:
       name: data
-      namespace: {{ .Release.Namespace | quote }}
+      namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
       labels:
 {{ include "harbor.labels" . | indent 8 }}
       annotations:
diff --git a/templates/registry/registry-cm.yaml b/templates/registry/registry-cm.yaml
index df5932c..eb3e351 100644
--- a/templates/registry/registry-cm.yaml
+++ b/templates/registry/registry-cm.yaml
@@ -2,7 +2,7 @@ apiVersion: v1
 kind: ConfigMap
 metadata:
   name: "{{ template "harbor.registry" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 data:
diff --git a/templates/registry/registry-dpl.yaml b/templates/registry/registry-dpl.yaml
index 49cd1f0..ccb762d 100644
--- a/templates/registry/registry-dpl.yaml
+++ b/templates/registry/registry-dpl.yaml
@@ -2,7 +2,7 @@ apiVersion: apps/v1
 kind: Deployment
 metadata:
   name: "{{ template "harbor.registry" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
     component: registry
@@ -20,7 +20,7 @@ spec:
       component: registry
   template:
     metadata:
-      namespace: {{ .Release.Namespace | quote }}
+      namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
       labels:
 {{ include "harbor.labels" . | indent 8 }}
         component: registry
diff --git a/templates/registry/registry-pvc.yaml b/templates/registry/registry-pvc.yaml
index 8b73ba2..3e092d0 100644
--- a/templates/registry/registry-pvc.yaml
+++ b/templates/registry/registry-pvc.yaml
@@ -5,7 +5,7 @@ kind: PersistentVolumeClaim
 apiVersion: v1
 metadata:
   name: {{ template "harbor.registry" . }}
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   annotations:
   {{- range $key, $value := $registry.annotations }}
     {{ $key }}: {{ $value | quote }}
diff --git a/templates/registry/registry-secret.yaml b/templates/registry/registry-secret.yaml
index c1b73cc..99e3fe2 100644
--- a/templates/registry/registry-secret.yaml
+++ b/templates/registry/registry-secret.yaml
@@ -2,7 +2,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: "{{ template "harbor.registry" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 type: Opaque
@@ -38,7 +38,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: "{{ template "harbor.registry" . }}-htpasswd"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 type: Opaque
diff --git a/templates/registry/registry-svc.yaml b/templates/registry/registry-svc.yaml
index c7e3d1d..c582af4 100644
--- a/templates/registry/registry-svc.yaml
+++ b/templates/registry/registry-svc.yaml
@@ -2,7 +2,7 @@ apiVersion: v1
 kind: Service
 metadata:
   name: "{{ template "harbor.registry" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 spec:
diff --git a/templates/registry/registry-tls.yaml b/templates/registry/registry-tls.yaml
index 214b8a1..c1dc73a 100644
--- a/templates/registry/registry-tls.yaml
+++ b/templates/registry/registry-tls.yaml
@@ -4,7 +4,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: "{{ template "harbor.internalTLS.registry.secretName" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 type: kubernetes.io/tls
diff --git a/templates/registry/registryctl-cm.yaml b/templates/registry/registryctl-cm.yaml
index 61b2c5e..d8f5669 100644
--- a/templates/registry/registryctl-cm.yaml
+++ b/templates/registry/registryctl-cm.yaml
@@ -2,7 +2,7 @@ apiVersion: v1
 kind: ConfigMap
 metadata:
   name: "{{ template "harbor.registryCtl" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 data:
diff --git a/templates/registry/registryctl-secret.yaml b/templates/registry/registryctl-secret.yaml
index db9425b..ce96a14 100644
--- a/templates/registry/registryctl-secret.yaml
+++ b/templates/registry/registryctl-secret.yaml
@@ -2,7 +2,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: "{{ template "harbor.registryCtl" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 type: Opaque
diff --git a/templates/trivy/trivy-secret.yaml b/templates/trivy/trivy-secret.yaml
index b13f880..91fe39a 100644
--- a/templates/trivy/trivy-secret.yaml
+++ b/templates/trivy/trivy-secret.yaml
@@ -3,7 +3,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: {{ template "harbor.trivy" . }}
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 type: Opaque
diff --git a/templates/trivy/trivy-sts.yaml b/templates/trivy/trivy-sts.yaml
index 48b327d..74c5557 100644
--- a/templates/trivy/trivy-sts.yaml
+++ b/templates/trivy/trivy-sts.yaml
@@ -4,7 +4,7 @@ apiVersion: apps/v1
 kind: StatefulSet
 metadata:
   name: {{ template "harbor.trivy" . }}
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
     component: trivy
@@ -17,7 +17,7 @@ spec:
       component: trivy
   template:
     metadata:
-      namespace: {{ .Release.Namespace | quote }}
+      namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
       labels:
 {{ include "harbor.labels" . | indent 8 }}
         component: trivy
@@ -184,7 +184,7 @@ spec:
   volumeClaimTemplates:
   - metadata:
       name: data
-      namespace: {{ .Release.Namespace | quote }}
+      namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
       labels:
 {{ include "harbor.labels" . | indent 8 }}
       annotations:
diff --git a/templates/trivy/trivy-svc.yaml b/templates/trivy/trivy-svc.yaml
index e0ae320..91c8a88 100644
--- a/templates/trivy/trivy-svc.yaml
+++ b/templates/trivy/trivy-svc.yaml
@@ -3,7 +3,7 @@ apiVersion: v1
 kind: Service
 metadata:
   name: "{{ template "harbor.trivy" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 spec:
diff --git a/templates/trivy/trivy-tls.yaml b/templates/trivy/trivy-tls.yaml
index 58bce4e..d19e7ce 100644
--- a/templates/trivy/trivy-tls.yaml
+++ b/templates/trivy/trivy-tls.yaml
@@ -4,7 +4,7 @@ apiVersion: v1
 kind: Secret
 metadata:
   name: "{{ template "harbor.internalTLS.trivy.secretName" . }}"
-  namespace: {{ .Release.Namespace | quote }}
+  namespace: {{ .Release.Namespace | default .Values.defaultNamespace | quote }}
   labels:
 {{ include "harbor.labels" . | indent 4 }}
 type: kubernetes.io/tls
diff --git a/values.yaml b/values.yaml
index cf886c3..49f8e71 100644
--- a/values.yaml
+++ b/values.yaml
@@ -1,4 +1,14 @@
 sourceRegistry: "public.ecr.aws/eks-anywhere"
+defaultNamespace: "harbor"
+# Values for configuring pull secrets through charts
+pullSecretName : 
+pullSecretData : 
+imageCredentials:
+  registry: ""
+  username: ""
+  password: ""
+  email: ""
+
 expose:
   # Set how to expose the service. Set the type as "ingress", "clusterIP", "nodePort" or "loadBalancer"
   # and fill the information in the corresponding section
-- 
2.36.0

