From 9171416e0b081004d5278ae66677e27d2c9b47fd Mon Sep 17 00:00:00 2001
From: Abdullahi Abdinur <acool@amazon.com>
Date: Wed, 19 Oct 2022 10:58:28 -0700
Subject: [PATCH 4/4] Update cert manager namespace config

---
 deploy/charts/cert-manager/templates/_helpers.tpl      |  2 +-
 .../templates/cainjector-serviceaccount.yaml           |  4 ++--
 .../charts/cert-manager/templates/serviceaccount.yaml  |  4 ++--
 .../templates/startupapicheck-serviceaccount.yaml      |  4 ++--
 .../cert-manager/templates/webhook-serviceaccount.yaml |  4 ++--
 deploy/charts/cert-manager/values.yaml                 | 10 +++++-----
 6 files changed, 14 insertions(+), 14 deletions(-)

diff --git a/deploy/charts/cert-manager/templates/_helpers.tpl b/deploy/charts/cert-manager/templates/_helpers.tpl
index 067fe6a05..902142094 100644
--- a/deploy/charts/cert-manager/templates/_helpers.tpl
+++ b/deploy/charts/cert-manager/templates/_helpers.tpl
@@ -170,7 +170,7 @@ This gets around an problem within helm discussed here
 https://github.com/helm/helm/issues/5358
 */}}
 {{- define "cert-manager.namespace" -}}
-    {{ .Values.namespace | default .Release.Namespace }}
+    {{ .Release.Namespace | default .Values.defaultNamespace}}
 {{- end -}}
 
 {{/*
diff --git a/deploy/charts/cert-manager/templates/cainjector-serviceaccount.yaml b/deploy/charts/cert-manager/templates/cainjector-serviceaccount.yaml
index fedc731f8..6f2723a80 100644
--- a/deploy/charts/cert-manager/templates/cainjector-serviceaccount.yaml
+++ b/deploy/charts/cert-manager/templates/cainjector-serviceaccount.yaml
@@ -19,9 +19,9 @@ metadata:
     {{- with .Values.cainjector.serviceAccount.labels }}
       {{ toYaml . | nindent 4 }}
     {{- end }}
-{{- with .Values.global.imagePullSecrets }}
+{{- with .Values.imagePullSecrets }}
 imagePullSecrets:
-  {{- toYaml . | nindent 2 }}
+  {{- toYaml . | nindent 8 }}
 {{- end }}
 {{- end }}
 {{- end }}
diff --git a/deploy/charts/cert-manager/templates/serviceaccount.yaml b/deploy/charts/cert-manager/templates/serviceaccount.yaml
index 87fc00ea7..b90ec30c3 100644
--- a/deploy/charts/cert-manager/templates/serviceaccount.yaml
+++ b/deploy/charts/cert-manager/templates/serviceaccount.yaml
@@ -1,9 +1,9 @@
 {{- if .Values.serviceAccount.create }}
 apiVersion: v1
 kind: ServiceAccount
-{{- with .Values.global.imagePullSecrets }}
+{{- with .Values.imagePullSecrets }}
 imagePullSecrets:
-  {{- toYaml . | nindent 2 }}
+  {{- toYaml . | nindent 8 }}
 {{- end }}
 automountServiceAccountToken: {{ .Values.serviceAccount.automountServiceAccountToken }}
 metadata:
diff --git a/deploy/charts/cert-manager/templates/startupapicheck-serviceaccount.yaml b/deploy/charts/cert-manager/templates/startupapicheck-serviceaccount.yaml
index 8c417604a..7d204a838 100644
--- a/deploy/charts/cert-manager/templates/startupapicheck-serviceaccount.yaml
+++ b/deploy/charts/cert-manager/templates/startupapicheck-serviceaccount.yaml
@@ -19,9 +19,9 @@ metadata:
     {{- with .Values.startupapicheck.serviceAccount.labels }}
       {{ toYaml . | nindent 4 }}
     {{- end }}
-{{- with .Values.global.imagePullSecrets }}
+{{- with .Values.imagePullSecrets }}
 imagePullSecrets:
-  {{- toYaml . | nindent 2 }}
+  {{- toYaml . | nindent 8 }}
 {{- end }}
 {{- end }}
 {{- end }}
diff --git a/deploy/charts/cert-manager/templates/webhook-serviceaccount.yaml b/deploy/charts/cert-manager/templates/webhook-serviceaccount.yaml
index dff5c0672..eec438f38 100644
--- a/deploy/charts/cert-manager/templates/webhook-serviceaccount.yaml
+++ b/deploy/charts/cert-manager/templates/webhook-serviceaccount.yaml
@@ -18,8 +18,8 @@ metadata:
     {{- with .Values.webhook.serviceAccount.labels }}
       {{ toYaml . | nindent 4 }}
     {{- end }}
-{{- with .Values.global.imagePullSecrets }}
+{{- with .Values.imagePullSecrets }}
 imagePullSecrets:
-  {{- toYaml . | nindent 2 }}
+  {{- toYaml . | nindent 8 }}
 {{- end }}
 {{- end }}
diff --git a/deploy/charts/cert-manager/values.yaml b/deploy/charts/cert-manager/values.yaml
index 2e2af002d..5d72cf4e2 100644
--- a/deploy/charts/cert-manager/values.yaml
+++ b/deploy/charts/cert-manager/values.yaml
@@ -5,14 +5,14 @@
 # Declare variables to be passed into your templates.
 namespace: "cert-manager"
 sourceRegistry: "public.ecr.aws/eks-anywhere"
+imagePullPolicy: "IfNotPresent"
+imagePullSecrets: []
+defaultNamespace: "cert-manager"
 global:
   # Reference to one or more secrets to be used when pulling images
   # ref: https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/
-  #
-  # For example:
-  #  imagePullSecrets:
-  #    - name: "image-pull-secret"
-  imagePullSecrets: []
+  #imagePullSecrets: []
+  # - name: "image-pull-secret"
 
   # Labels to apply to all resources
   # Please note that this does not add labels to the resources created dynamically by the controllers.
-- 
2.39.3 (Apple Git-145)

