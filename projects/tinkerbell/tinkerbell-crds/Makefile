BASE_DIRECTORY:=$(abspath ../../../)
GIT_TAG=$(shell cat GIT_TAG)

REPO_OWNER=tinkerbell
REPO=tinkerbell

# Override COMPONENT so MAKE_ROOT points to this project, not the cloned repo
COMPONENT=tinkerbell/tinkerbell-crds

IMAGE_NAMES=
BUILD_TARGETS=helm/build
RELEASE_TARGETS=helm/push

HAS_HELM_CHART=true
# Chart is generated by build script into _output/helm-chart
HELM_DIRECTORY=_output/helm-chart
HELM_SOURCE_REPOSITORY=tinkerbell
HELM_IMAGE_LIST=
HELM_CHART_NAMES=tinkerbell/tinkerbell-crds

EXCLUDE_FROM_UPGRADE_BUILDSPEC=true
EXCLUDE_FROM_CHECKSUMS_BUILDSPEC=true

include $(BASE_DIRECTORY)/Common.mk

# Generate the CRDs helm chart before helm/copy (which is the first step in helm/build chain)
# Depends on checkout-repo to ensure mono-repo is cloned and checked out first
# Output to $(REPO)/_output/helm-chart so helm_copy.sh can find it
.PHONY: pre-helm/build
pre-helm/build: checkout-repo
	scripts/generate-crds-chart.sh $(MAKE_ROOT)/$(REPO) $(MAKE_ROOT)/$(REPO)/_output/helm-chart

# Make helm/copy depend on pre-helm/build to generate chart first
tinkerbell/tinkerbell-crds/helm/copy: pre-helm/build

.PHONY: verify
verify: checkout-repo pre-helm/build
	scripts/verify.sh $(MAKE_ROOT)/$(REPO)/_output/helm-chart $(GIT_TAG)


########### DO NOT EDIT #############################
# To update call: make add-generated-help-block
# This is added to help document dynamic targets and support shell autocompletion
# Run make help for a formatted help block with all targets
include Help.mk
########### END GENERATED ###########################
