From c6a4c615d04c88c4e03c9ec58a4f51391ecb05ff Mon Sep 17 00:00:00 2001
From: rajeshvenkata <rajesh.venkat.p@gmail.com>
Date: Thu, 30 Oct 2025 14:51:59 -0700
Subject: [PATCH 38/38] Fix KubeadmControlPlane webhook to properly default
 rollout strategy

---
 .../kubeadm/internal/webhooks/kubeadm_control_plane.go    | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/controlplane/kubeadm/internal/webhooks/kubeadm_control_plane.go b/controlplane/kubeadm/internal/webhooks/kubeadm_control_plane.go
index 083dab58d..1a9bd73e1 100644
--- a/controlplane/kubeadm/internal/webhooks/kubeadm_control_plane.go
+++ b/controlplane/kubeadm/internal/webhooks/kubeadm_control_plane.go
@@ -85,8 +85,12 @@ func defaultKubeadmControlPlaneSpec(s *controlplanev1.KubeadmControlPlaneSpec) {
 	}
 
 	// Enforce RollingUpdate strategy and default MaxSurge if not set.
-	s.Rollout.Strategy.Type = controlplanev1.RollingUpdateStrategyType
-	s.Rollout.Strategy.RollingUpdate.MaxSurge = intstr.ValueOrDefault(s.Rollout.Strategy.RollingUpdate.MaxSurge, intstr.FromInt32(1))
+	if s.Rollout.Strategy.Type == "" {
+    	s.Rollout.Strategy.Type = controlplanev1.RollingUpdateStrategyType
+	}
+	if s.Rollout.Strategy.Type == controlplanev1.RollingUpdateStrategyType {
+		s.Rollout.Strategy.RollingUpdate.MaxSurge = intstr.ValueOrDefault(s.Rollout.Strategy.RollingUpdate.MaxSurge, intstr.FromInt32(1))
+	}
 }
 
 // ValidateCreate implements webhook.Validator so a webhook will be registered for the type.
-- 
2.49.0

