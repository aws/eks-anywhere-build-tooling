From 3b894353bd052b36d4fc6afe61888ddd4eba67e2 Mon Sep 17 00:00:00 2001
From: Abhay Krishna Arunachalam <arnchlm@amazon.com>
Date: Thu, 2 Feb 2023 01:39:15 -0800
Subject: [PATCH 10/26] Add instance metadata options to Packer config

Signed-off-by: Abhay Krishna Arunachalam <arnchlm@amazon.com>
---
 images/capi/packer/ami/packer.json | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/images/capi/packer/ami/packer.json b/images/capi/packer/ami/packer.json
index 3117354cd..175ca11d6 100644
--- a/images/capi/packer/ami/packer.json
+++ b/images/capi/packer/ami/packer.json
@@ -22,6 +22,11 @@
           "volume_type": "{{ user `volume_type` }}"
         }
       ],
+      "metadata_options": {
+        "http_endpoint": "{{ user `http_endpoint` }}",
+        "http_tokens": "{{ user `http_tokens` }}",
+        "http_put_response_hop_limit": "{{ user `http_put_response_hop_limit` }}"
+      },
       "name": "{{user `build_name`}}",
       "profile": "{{ user `aws_profile`}}",
       "region": "{{ user `aws_region` }}",
@@ -163,6 +168,9 @@
     "crictl_version": null,
     "encrypted": "false",
     "existing_ansible_ssh_args": "{{env `ANSIBLE_SSH_ARGS`}}",
+    "http_endpoint": "enabled",
+    "http_tokens": "required",
+    "http_put_response_hop_limit": "2",
     "iam_instance_profile": "",
     "ib_version": "{{env `IB_VERSION`}}",
     "iops": "3000",
-- 
2.39.2

