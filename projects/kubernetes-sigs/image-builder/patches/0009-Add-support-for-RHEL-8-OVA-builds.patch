From 213fdd45f96292c49c29dd1db690a363ecc15998 Mon Sep 17 00:00:00 2001
From: Abhay Krishna Arunachalam <arnchlm@amazon.com>
Date: Fri, 1 Apr 2022 14:49:35 -0700
Subject: [PATCH] Add support for RHEL 8 OVA builds

---
 images/capi/Makefile               |  1 +
 images/capi/packer/ova/rhel-8.json | 19 +++++++++++++++++++
 2 files changed, 20 insertions(+)
 create mode 100644 images/capi/packer/ova/rhel-8.json

diff --git a/images/capi/Makefile b/images/capi/Makefile
index f04f93021..5e4c9d5bd 100644
--- a/images/capi/Makefile
+++ b/images/capi/Makefile
@@ -510,6 +510,7 @@ build-haproxy-ova-esx-photon-3: ## Builds Photon 3 HAProxy OVA w remote hypervis
 build-node-ova-vsphere-centos-7: ## Builds CentOS 7 Node OVA and template on vSphere
 build-node-ova-vsphere-photon-3: ## Builds Photon 3 Node OVA and template on vSphere
 build-node-ova-vsphere-rhel-7: ## Builds RHEL 7 Node OVA and template on vSphere
+build-node-ova-vsphere-rhel-8: ## Builds RHEL 8 Node OVA and template on vSphere
 build-node-ova-vsphere-rockylinux-8: ## Builds RockyLinux 8 Node OVA and template on vSphere
 build-node-ova-vsphere-ubuntu-1804: ## Builds Ubuntu 18.04 Node OVA and template on vSphere
 build-node-ova-vsphere-ubuntu-2004: ## Builds Ubuntu 20.04 Node OVA and template on vSphere
diff --git a/images/capi/packer/ova/rhel-8.json b/images/capi/packer/ova/rhel-8.json
new file mode 100644
index 000000000..f4f49dc91
--- /dev/null
+++ b/images/capi/packer/ova/rhel-8.json
@@ -0,0 +1,19 @@
+{
+  "boot_command_prefix": "<tab><wait><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs><bs>quiet text inst.ks=hd:fd0:",
+  "boot_command_suffix": "/8/ks.cfg<enter><wait>",
+  "boot_media_path": "/HTTP",
+  "build_name": "rhel-8",
+  "distro_arch": "amd64",
+  "distro_name": "rhel",
+  "distro_version": "8",
+  "floppy_dirs": "./packer/ova/linux/{{user `distro_name`}}/http/",
+  "guest_os_type": "rhel8-64",
+  "iso_checksum": "48f955712454c32718dcde858dea5aca574376a1d7a4b0ed6908ac0b85597811",
+  "iso_checksum_type": "sha256",
+  "iso_url": "rhel-8.4-x86_64-dvd.iso",
+  "os_display_name": "RHEL 8",
+  "redhat_epel_rpm": "https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm",
+  "epel_rpm_gpg_key": "https://dl.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-8",
+  "shutdown_command": "sys-unconfig",
+  "vsphere_guest_os_type": "rhel8_64Guest"
+}
-- 
2.34.1

